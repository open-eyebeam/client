import{S as Se,i as Re,s as De,E as Xe,T as Vi,e as U,k as ve,t as ze,c as V,a as G,m as ge,d as R,h as We,b as k,g as j,I as Y,O as tt,U as qi,V as Gi,W as zi,q as C,o as H,M as Oe,a2 as Ct,_ as Tt,Y as he,Z as xe,H as Ve,J as nt,K as je,v as gt,l as le,w as be,x as $e,y as Ie,B as Te,n as we,p as Ae,a3 as Gt,a4 as zt,a5 as Nr,L as gn,j as It,R as jr,Q as Br,F as Gn,G as zn,a6 as Wi,a7 as Wn}from"../chunks/index-9c3cfac4.js";import{_ as Xi,k as Hr,m as Ji,n as Ur,o as Yi,q as Ki,r as Zi,v as Qi,w as Vr,x as eo,y as lt,h as Ze,z as Ce,C as to,D as ut,E as qr,F as Xn,G as ct,f as Le,s as Pt,j as yn,H as dn,I as dt,J as Jn,K as Yn,l as Gr,B as wn,t as zr,L as Kn,M as Wr,N as no,g as Mt,O as ro,P as ft,Q as io,R as oo,T as qt,S as Zn,u as Qn,p as so,e as ao,i as er}from"../chunks/authentication-1f48caad.js";import{w as ot}from"../chunks/index-bd0e1164.js";var fo=Math.floor,lo=Math.random;function uo(f,n){return f+fo(lo()*(n-f+1))}var co=uo,ho=co;function _o(f){var n=f.length;return n?f[ho(0,n-1)]:void 0}var Xr=_o,po=Xi;function mo(f,n){return po(n,function(e){return f[e]})}var vo=mo;function go(f,n){for(var e=-1,t=Array(f);++e<f;)t[e]=n(e);return t}var yo=go,hn={exports:{}};function wo(){return!1}var Ao=wo;(function(f,n){var e=Hr,t=Ao,i=n&&!n.nodeType&&n,s=i&&!0&&f&&!f.nodeType&&f,c=s&&s.exports===i,d=c?e.Buffer:void 0,p=d?d.isBuffer:void 0,g=p||t;f.exports=g})(hn,hn.exports);var bo=Ji,$o=Ur,Io=Yi,To="[object Arguments]",Eo="[object Array]",xo="[object Boolean]",ko="[object Date]",Oo="[object Error]",So="[object Function]",Ro="[object Map]",Do="[object Number]",Mo="[object Object]",Po="[object RegExp]",Co="[object Set]",Lo="[object String]",Fo="[object WeakMap]",No="[object ArrayBuffer]",jo="[object DataView]",Bo="[object Float32Array]",Ho="[object Float64Array]",Uo="[object Int8Array]",Vo="[object Int16Array]",qo="[object Int32Array]",Go="[object Uint8Array]",zo="[object Uint8ClampedArray]",Wo="[object Uint16Array]",Xo="[object Uint32Array]",me={};me[Bo]=me[Ho]=me[Uo]=me[Vo]=me[qo]=me[Go]=me[zo]=me[Wo]=me[Xo]=!0;me[To]=me[Eo]=me[No]=me[xo]=me[jo]=me[ko]=me[Oo]=me[So]=me[Ro]=me[Do]=me[Mo]=me[Po]=me[Co]=me[Lo]=me[Fo]=!1;function Jo(f){return Io(f)&&$o(f.length)&&!!me[bo(f)]}var Yo=Jo;function Ko(f){return function(n){return f(n)}}var Zo=Ko,_n={exports:{}};(function(f,n){var e=Ki,t=n&&!n.nodeType&&n,i=t&&!0&&f&&!f.nodeType&&f,s=i&&i.exports===t,c=s&&e.process,d=function(){try{var p=i&&i.require&&i.require("util").types;return p||c&&c.binding&&c.binding("util")}catch{}}();f.exports=d})(_n,_n.exports);var Qo=Yo,es=Zo,tr=_n.exports,nr=tr&&tr.isTypedArray,ts=nr?es(nr):Qo,ns=ts,rs=yo,is=Zi,os=Vr,ss=hn.exports,as=Qi,fs=ns,ls=Object.prototype,us=ls.hasOwnProperty;function cs(f,n){var e=os(f),t=!e&&is(f),i=!e&&!t&&ss(f),s=!e&&!t&&!i&&fs(f),c=e||t||i||s,d=c?rs(f.length,String):[],p=d.length;for(var g in f)(n||us.call(f,g))&&!(c&&(g=="length"||i&&(g=="offset"||g=="parent")||s&&(g=="buffer"||g=="byteLength"||g=="byteOffset")||as(g,p)))&&d.push(g);return d}var ds=cs,hs=Object.prototype;function _s(f){var n=f&&f.constructor,e=typeof n=="function"&&n.prototype||hs;return f===e}var ps=_s;function ms(f,n){return function(e){return f(n(e))}}var vs=ms,gs=vs,ys=gs(Object.keys,Object),ws=ys,As=ps,bs=ws,$s=Object.prototype,Is=$s.hasOwnProperty;function Ts(f){if(!As(f))return bs(f);var n=[];for(var e in Object(f))Is.call(f,e)&&e!="constructor"&&n.push(e);return n}var Es=Ts,xs=eo,ks=Ur;function Os(f){return f!=null&&ks(f.length)&&!xs(f)}var Ss=Os,Rs=ds,Ds=Es,Ms=Ss;function Ps(f){return Ms(f)?Rs(f):Ds(f)}var Cs=Ps,Ls=vo,Fs=Cs;function Ns(f){return f==null?[]:Ls(f,Fs(f))}var js=Ns,Bs=Xr,Hs=js;function Us(f){return Bs(Hs(f))}var Vs=Us,qs=Xr,Gs=Vs,zs=Vr;function Ws(f){var n=zs(f)?qs:Gs;return n(f)}var pn=Ws;const Xs=ot({});let Jr=ot({});const ye=32,Js=()=>new Promise(async(f,n)=>{const e=await lt('*[_type == "room"]{..., "bgImageUrl": backgroundImage.asset->url}'),t=await lt('*[_type == "zone"]{..., "bgImageUrl": backgroundImage.asset->url}'),i=await lt('*[_type == "exob"]'),s=await lt('*[_type == "portal"]{..., targetArea->{...}, "bgImageUrl": backgroundImage.asset->url}'),c=await lt('*[_type == "event"]'),d=await lt('*[_id == "bulletin-board-settings"][0]');let p={};e.forEach(g=>p[g._id]=g);for(const[g,I]of Object.entries(p))p[g].objects=[],p[g].zones=[],p[g].portals=[],p[g].inlineStyles=Ks(I);i.forEach(g=>{Ze(g,"parentArea._ref")&&p[g.parentArea._ref].objects.push(g)}),d&&(d.isBulletinBoard=!0,d.title="Bulletin Board",d.events=c,p[d.parentArea._ref].objects.push(d)),t.forEach(g=>{Ze(g,"parentArea._ref")&&p[g.parentArea._ref].zones.push(g)}),s.forEach(g=>{Ze(g,"parentArea._ref")&&p[g.parentArea._ref].portals.push(g)}),Jr.set(p),f()}),Ys=()=>new Promise(async(f,n)=>{const e=await lt('*[_type == "avatar"]{..., "imageUrl": image.asset->url}');f(e)}),Ks=f=>{let n="width: "+Ce(f,"dimensions.width",0)*ye+"px;",e="height: "+Ce(f,"dimensions.height",0)*ye+"px;",t="background-image: url("+f.bgImageUrl+");";return n+e+t};lt('*[_id == "global-settings"]').then(f=>{Xs.set(f)}).catch(f=>{console.log(f)});function rr(f){return{c:Xe,l:Xe,m:Xe,d:Xe}}function Zs(f){let n,e,t,i,s,c,d,p,g=f[2]&&rr();const I=f[8].default,r=Vi(I,f,f[7],null);return{c(){n=U("div"),g&&g.c(),e=ve(),r&&r.c(),t=ve(),i=U("div"),s=ze("CENTER VIEW (DEBUG)"),this.h()},l(a){n=V(a,"DIV",{class:!0,id:!0,style:!0});var _=G(n);g&&g.l(_),e=ge(_),r&&r.l(_),_.forEach(R),t=ge(a),i=V(a,"DIV",{class:!0});var A=G(i);s=We(A,"CENTER VIEW (DEBUG)"),A.forEach(R),this.h()},h(){k(n,"class","room svelte-ib3ibm"),k(n,"id","room"),k(n,"style",f[1]),k(i,"class","center-view svelte-ib3ibm")},m(a,_){j(a,n,_),g&&g.m(n,null),Y(n,e),r&&r.m(n,null),f[9](n),j(a,t,_),j(a,i,_),Y(i,s),c=!0,d||(p=tt(i,"click",f[3]),d=!0)},p(a,[_]){a[2]?g||(g=rr(),g.c(),g.m(n,e)):g&&(g.d(1),g=null),r&&r.p&&(!c||_&128)&&qi(r,I,a,a[7],c?zi(I,a[7],_,null):Gi(a[7]),null),(!c||_&2)&&k(n,"style",a[1])},i(a){c||(C(r,a),c=!0)},o(a){H(r,a),c=!1},d(a){a&&R(n),g&&g.d(),r&&r.d(a),f[9](null),a&&R(t),a&&R(i),d=!1,p()}}}function Qs(f,n,e){let t;Oe(f,to,_=>e(2,t=_));let{$$slots:i={},$$scope:s}=n;Ct();let{room:c={}}=n,{x:d=0}=n,{y:p=0}=n,g={},I="";const r=(_,A)=>{e(1,I=`${c.inlineStyles} transform: translateX(-${_*ye}px) translateY(-${A*ye}px);`)};function a(_){Tt[_?"unshift":"push"](()=>{g=_,e(0,g)})}return f.$$set=_=>{"room"in _&&e(4,c=_.room),"x"in _&&e(5,d=_.x),"y"in _&&e(6,p=_.y),"$$scope"in _&&e(7,s=_.$$scope)},f.$$.update=()=>{f.$$.dirty&96&&r(d,p),f.$$.dirty&16&&e(1,I=`${c.inlineStyles} transform: translateX(-50%) translateY(-50%);`)},[g,I,t,r,c,d,p,s,i,a]}class ea extends Se{constructor(n){super(),Re(this,n,Qs,Zs,De,{room:4,x:5,y:6})}}var mn={exports:{}};(function(f,n){(function(e,t){t(n)})(ut,function(e){ArrayBuffer.isView||(ArrayBuffer.isView=function(v){return v!==null&&typeof v=="object"&&v.buffer instanceof ArrayBuffer}),typeof globalThis=="undefined"&&typeof window!="undefined"&&(window.globalThis=window);/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var t=function(v,y){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,b){h.__proto__=b}||function(h,b){for(var S in b)Object.prototype.hasOwnProperty.call(b,S)&&(h[S]=b[S])},t(v,y)};function i(v,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");t(v,y);function h(){this.constructor=v}v.prototype=y===null?Object.create(y):(h.prototype=y.prototype,new h)}function s(v,y,h,b){function S(D){return D instanceof h?D:new h(function(z){z(D)})}return new(h||(h=Promise))(function(D,z){function N(ae){try{L(b.next(ae))}catch(pe){z(pe)}}function F(ae){try{L(b.throw(ae))}catch(pe){z(pe)}}function L(ae){ae.done?D(ae.value):S(ae.value).then(N,F)}L((b=b.apply(v,y||[])).next())})}function c(v,y){var h={label:0,sent:function(){if(D[0]&1)throw D[1];return D[1]},trys:[],ops:[]},b,S,D,z;return z={next:N(0),throw:N(1),return:N(2)},typeof Symbol=="function"&&(z[Symbol.iterator]=function(){return this}),z;function N(L){return function(ae){return F([L,ae])}}function F(L){if(b)throw new TypeError("Generator is already executing.");for(;h;)try{if(b=1,S&&(D=L[0]&2?S.return:L[0]?S.throw||((D=S.return)&&D.call(S),0):S.next)&&!(D=D.call(S,L[1])).done)return D;switch(S=0,D&&(L=[L[0]&2,D.value]),L[0]){case 0:case 1:D=L;break;case 4:return h.label++,{value:L[1],done:!1};case 5:h.label++,S=L[1],L=[0];continue;case 7:L=h.ops.pop(),h.trys.pop();continue;default:if(D=h.trys,!(D=D.length>0&&D[D.length-1])&&(L[0]===6||L[0]===2)){h=0;continue}if(L[0]===3&&(!D||L[1]>D[0]&&L[1]<D[3])){h.label=L[1];break}if(L[0]===6&&h.label<D[1]){h.label=D[1],D=L;break}if(D&&h.label<D[2]){h.label=D[2],h.ops.push(L);break}D[2]&&h.ops.pop(),h.trys.pop();continue}L=y.call(v,h)}catch(ae){L=[6,ae],S=0}finally{b=D=0}if(L[0]&5)throw L[1];return{value:L[0]?L[1]:void 0,done:!0}}}function d(v,y){y.headers=v.headers||{},y.statusMessage=v.statusText,y.statusCode=v.status,y.data=v.response}function p(v,y,h){return new Promise(function(b,S){h=h||{};var D=new XMLHttpRequest,z,N,F,L=h.body,ae=h.headers||{};h.timeout&&(D.timeout=h.timeout),D.ontimeout=D.onerror=function(pe){pe.timeout=pe.type=="timeout",S(pe)},D.open(v,y.href||y),D.onload=function(){for(F=D.getAllResponseHeaders().trim().split(/[\r\n]+/),d(D,D);N=F.shift();)N=N.split(": "),D.headers[N.shift().toLowerCase()]=N.join(": ");if(N=D.headers["content-type"],N&&!!~N.indexOf("application/json"))try{D.data=JSON.parse(D.data,h.reviver)}catch(pe){return d(D,pe),S(pe)}(D.status>=400?S:b)(D)},typeof FormData<"u"&&L instanceof FormData||L&&typeof L=="object"&&(ae["content-type"]="application/json",L=JSON.stringify(L)),D.withCredentials=!!h.withCredentials;for(z in ae)D.setRequestHeader(z,ae[z]);D.send(L)})}var g=p.bind(p,"GET"),I=p.bind(p,"POST"),r=p.bind(p,"PATCH"),a=p.bind(p,"DELETE"),_=p.bind(p,"PUT"),A=a,T=g,$=r,w=I,x=_,O=p,P={del:A,get:T,patch:$,post:w,put:x,send:O},Z=Object.freeze(Object.assign(Object.create(null),P,{default:P,del:A,get:T,patch:$,post:w,put:x,send:O})),ne=function(v){i(y,v);function y(h,b){var S=v.call(this,b)||this;return S.name="ServerError",S.code=h,S}return y}(Error);function de(v,y){if(this._offset=y,v instanceof ArrayBuffer)this._buffer=v,this._view=new DataView(this._buffer);else if(ArrayBuffer.isView(v))this._buffer=v.buffer,this._view=new DataView(this._buffer,v.byteOffset,v.byteLength);else throw new Error("Invalid argument")}function Be(v,y,h){for(var b="",S=0,D=y,z=y+h;D<z;D++){var N=v.getUint8(D);if((N&128)===0){b+=String.fromCharCode(N);continue}if((N&224)===192){b+=String.fromCharCode((N&31)<<6|v.getUint8(++D)&63);continue}if((N&240)===224){b+=String.fromCharCode((N&15)<<12|(v.getUint8(++D)&63)<<6|(v.getUint8(++D)&63)<<0);continue}if((N&248)===240){S=(N&7)<<18|(v.getUint8(++D)&63)<<12|(v.getUint8(++D)&63)<<6|(v.getUint8(++D)&63)<<0,S>=65536?(S-=65536,b+=String.fromCharCode((S>>>10)+55296,(S&1023)+56320)):b+=String.fromCharCode(S);continue}throw new Error("Invalid byte "+N.toString(16))}return b}de.prototype._array=function(v){for(var y=new Array(v),h=0;h<v;h++)y[h]=this._parse();return y},de.prototype._map=function(v){for(var y="",h={},b=0;b<v;b++)y=this._parse(),h[y]=this._parse();return h},de.prototype._str=function(v){var y=Be(this._view,this._offset,v);return this._offset+=v,y},de.prototype._bin=function(v){var y=this._buffer.slice(this._offset,this._offset+v);return this._offset+=v,y},de.prototype._parse=function(){var v=this._view.getUint8(this._offset++),y,h=0,b=0,S=0,D=0;if(v<192)return v<128?v:v<144?this._map(v&15):v<160?this._array(v&15):this._str(v&31);if(v>223)return(255-v+1)*-1;switch(v){case 192:return null;case 194:return!1;case 195:return!0;case 196:return h=this._view.getUint8(this._offset),this._offset+=1,this._bin(h);case 197:return h=this._view.getUint16(this._offset),this._offset+=2,this._bin(h);case 198:return h=this._view.getUint32(this._offset),this._offset+=4,this._bin(h);case 199:return h=this._view.getUint8(this._offset),b=this._view.getInt8(this._offset+1),this._offset+=2,[b,this._bin(h)];case 200:return h=this._view.getUint16(this._offset),b=this._view.getInt8(this._offset+2),this._offset+=3,[b,this._bin(h)];case 201:return h=this._view.getUint32(this._offset),b=this._view.getInt8(this._offset+4),this._offset+=5,[b,this._bin(h)];case 202:return y=this._view.getFloat32(this._offset),this._offset+=4,y;case 203:return y=this._view.getFloat64(this._offset),this._offset+=8,y;case 204:return y=this._view.getUint8(this._offset),this._offset+=1,y;case 205:return y=this._view.getUint16(this._offset),this._offset+=2,y;case 206:return y=this._view.getUint32(this._offset),this._offset+=4,y;case 207:return S=this._view.getUint32(this._offset)*Math.pow(2,32),D=this._view.getUint32(this._offset+4),this._offset+=8,S+D;case 208:return y=this._view.getInt8(this._offset),this._offset+=1,y;case 209:return y=this._view.getInt16(this._offset),this._offset+=2,y;case 210:return y=this._view.getInt32(this._offset),this._offset+=4,y;case 211:return S=this._view.getInt32(this._offset)*Math.pow(2,32),D=this._view.getUint32(this._offset+4),this._offset+=8,S+D;case 212:if(b=this._view.getInt8(this._offset),this._offset+=1,b===0){this._offset+=1;return}return[b,this._bin(1)];case 213:return b=this._view.getInt8(this._offset),this._offset+=1,[b,this._bin(2)];case 214:return b=this._view.getInt8(this._offset),this._offset+=1,[b,this._bin(4)];case 215:return b=this._view.getInt8(this._offset),this._offset+=1,b===0?(S=this._view.getInt32(this._offset)*Math.pow(2,32),D=this._view.getUint32(this._offset+4),this._offset+=8,new Date(S+D)):[b,this._bin(8)];case 216:return b=this._view.getInt8(this._offset),this._offset+=1,[b,this._bin(16)];case 217:return h=this._view.getUint8(this._offset),this._offset+=1,this._str(h);case 218:return h=this._view.getUint16(this._offset),this._offset+=2,this._str(h);case 219:return h=this._view.getUint32(this._offset),this._offset+=4,this._str(h);case 220:return h=this._view.getUint16(this._offset),this._offset+=2,this._array(h);case 221:return h=this._view.getUint32(this._offset),this._offset+=4,this._array(h);case 222:return h=this._view.getUint16(this._offset),this._offset+=2,this._map(h);case 223:return h=this._view.getUint32(this._offset),this._offset+=4,this._map(h)}throw new Error("Could not parse")};function ue(v,y){y===void 0&&(y=0);var h=new de(v,y),b=h._parse();if(h._offset!==v.byteLength)throw new Error(v.byteLength-h._offset+" trailing bytes");return b}function yt(v,y,h){for(var b=0,S=0,D=h.length;S<D;S++)b=h.charCodeAt(S),b<128?v.setUint8(y++,b):b<2048?(v.setUint8(y++,192|b>>6),v.setUint8(y++,128|b&63)):b<55296||b>=57344?(v.setUint8(y++,224|b>>12),v.setUint8(y++,128|b>>6&63),v.setUint8(y++,128|b&63)):(S++,b=65536+((b&1023)<<10|h.charCodeAt(S)&1023),v.setUint8(y++,240|b>>18),v.setUint8(y++,128|b>>12&63),v.setUint8(y++,128|b>>6&63),v.setUint8(y++,128|b&63))}function wt(v){for(var y=0,h=0,b=0,S=v.length;b<S;b++)y=v.charCodeAt(b),y<128?h+=1:y<2048?h+=2:y<55296||y>=57344?h+=3:(b++,h+=4);return h}function st(v,y,h){var b=typeof h,S=0,D=0,z=0,N=0,F=0,L=0;if(b==="string"){if(F=wt(h),F<32)v.push(F|160),L=1;else if(F<256)v.push(217,F),L=2;else if(F<65536)v.push(218,F>>8,F),L=3;else if(F<4294967296)v.push(219,F>>24,F>>16,F>>8,F),L=5;else throw new Error("String too long");return y.push({_str:h,_length:F,_offset:v.length}),L+F}if(b==="number")return Math.floor(h)!==h||!isFinite(h)?(v.push(203),y.push({_float:h,_length:8,_offset:v.length}),9):h>=0?h<128?(v.push(h),1):h<256?(v.push(204,h),2):h<65536?(v.push(205,h>>8,h),3):h<4294967296?(v.push(206,h>>24,h>>16,h>>8,h),5):(z=h/Math.pow(2,32)>>0,N=h>>>0,v.push(207,z>>24,z>>16,z>>8,z,N>>24,N>>16,N>>8,N),9):h>=-32?(v.push(h),1):h>=-128?(v.push(208,h),2):h>=-32768?(v.push(209,h>>8,h),3):h>=-2147483648?(v.push(210,h>>24,h>>16,h>>8,h),5):(z=Math.floor(h/Math.pow(2,32)),N=h>>>0,v.push(211,z>>24,z>>16,z>>8,z,N>>24,N>>16,N>>8,N),9);if(b==="object"){if(h===null)return v.push(192),1;if(Array.isArray(h)){if(F=h.length,F<16)v.push(F|144),L=1;else if(F<65536)v.push(220,F>>8,F),L=3;else if(F<4294967296)v.push(221,F>>24,F>>16,F>>8,F),L=5;else throw new Error("Array too large");for(S=0;S<F;S++)L+=st(v,y,h[S]);return L}if(h instanceof Date){var ae=h.getTime();return z=Math.floor(ae/Math.pow(2,32)),N=ae>>>0,v.push(215,0,z>>24,z>>16,z>>8,z,N>>24,N>>16,N>>8,N),10}if(h instanceof ArrayBuffer){if(F=h.byteLength,F<256)v.push(196,F),L=2;else if(F<65536)v.push(197,F>>8,F),L=3;else if(F<4294967296)v.push(198,F>>24,F>>16,F>>8,F),L=5;else throw new Error("Buffer too large");return y.push({_bin:h,_length:F,_offset:v.length}),L+F}if(typeof h.toJSON=="function")return st(v,y,h.toJSON());var pe=[],ke="",Je=Object.keys(h);for(S=0,D=Je.length;S<D;S++)ke=Je[S],typeof h[ke]!="function"&&pe.push(ke);if(F=pe.length,F<16)v.push(F|128),L=1;else if(F<65536)v.push(222,F>>8,F),L=3;else if(F<4294967296)v.push(223,F>>24,F>>16,F>>8,F),L=5;else throw new Error("Object too large");for(S=0;S<F;S++)ke=pe[S],L+=st(v,y,ke),L+=st(v,y,h[ke]);return L}if(b==="boolean")return v.push(h?195:194),1;if(b==="undefined")return v.push(212,0,0),3;throw new Error("Could not encode")}function At(v){var y=[],h=[],b=st(y,h,v),S=new ArrayBuffer(b),D=new DataView(S),z=0,N=0,F=-1;h.length>0&&(F=h[0]._offset);for(var L,ae=0,pe=0,ke=0,Je=y.length;ke<Je;ke++)if(D.setUint8(N+ke,y[ke]),ke+1===F){if(L=h[z],ae=L._length,pe=N+F,L._bin)for(var Ft=new Uint8Array(L._bin),qe=0;qe<ae;qe++)D.setUint8(pe+qe,Ft[qe]);else L._str?yt(D,pe,L._str):L._float!==void 0&&D.setFloat64(pe,L._float);z++,N+=ae,h[z]&&(F=h[z]._offset)}return S}var rt=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},W=globalThis.WebSocket||rt,_e=function(){function v(y){this.events=y}return v.prototype.send=function(y){y instanceof ArrayBuffer?this.ws.send(y):Array.isArray(y)&&this.ws.send(new Uint8Array(y).buffer)},v.prototype.connect=function(y){this.ws=new W(y,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror},v.prototype.close=function(y,h){this.ws.close(y,h)},v}(),$n=function(){function v(){this.events={},this.transport=new _e(this.events)}return v.prototype.send=function(y){this.transport.send(y)},v.prototype.connect=function(y){this.transport.connect(y)},v.prototype.close=function(y,h){this.transport.close(y,h)},v}(),In={};function Wt(v,y){In[v]=y}function Tn(v){var y=In[v];if(!y)throw new Error("missing serializer: "+v);return y}e.Protocol=void 0,function(v){v[v.HANDSHAKE=9]="HANDSHAKE",v[v.JOIN_ROOM=10]="JOIN_ROOM",v[v.ERROR=11]="ERROR",v[v.LEAVE_ROOM=12]="LEAVE_ROOM",v[v.ROOM_DATA=13]="ROOM_DATA",v[v.ROOM_STATE=14]="ROOM_STATE",v[v.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",v[v.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA"}(e.Protocol||(e.Protocol={})),e.ErrorCode=void 0,function(v){v[v.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",v[v.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",v[v.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",v[v.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",v[v.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",v[v.AUTH_FAILED=4215]="AUTH_FAILED",v[v.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(e.ErrorCode||(e.ErrorCode={}));function ni(v,y){for(var h=v[y++],b="",S=0,D=y,z=y+h;D<z;D++){var N=v[D];if((N&128)===0){b+=String.fromCharCode(N);continue}if((N&224)===192){b+=String.fromCharCode((N&31)<<6|v[++D]&63);continue}if((N&240)===224){b+=String.fromCharCode((N&15)<<12|(v[++D]&63)<<6|(v[++D]&63)<<0);continue}if((N&248)===240){S=(N&7)<<18|(v[++D]&63)<<12|(v[++D]&63)<<6|(v[++D]&63)<<0,S>=65536?(S-=65536,b+=String.fromCharCode((S>>>10)+55296,(S&1023)+56320)):b+=String.fromCharCode(S);continue}throw new Error("Invalid byte "+N.toString(16))}return b}function ri(v){v===void 0&&(v="");for(var y=0,h=0,b=0,S=v.length;b<S;b++)y=v.charCodeAt(b),y<128?h+=1:y<2048?h+=2:y<55296||y>=57344?h+=3:(b++,h+=4);return h+1}let ii=()=>({events:{},emit(v,...y){(this.events[v]||[]).forEach(h=>h(...y))},on(v,y){return(this.events[v]=this.events[v]||[]).push(y),()=>this.events[v]=(this.events[v]||[]).filter(h=>h!==y)}});var oi=function(){function v(){this.handlers=[]}return v.prototype.register=function(y,h){return this.handlers.push(y),this},v.prototype.invoke=function(){for(var y=this,h=[],b=0;b<arguments.length;b++)h[b]=arguments[b];this.handlers.forEach(function(S){return S.apply(y,h)})},v.prototype.invokeAsync=function(){for(var y=this,h=[],b=0;b<arguments.length;b++)h[b]=arguments[b];return Promise.all(this.handlers.map(function(S){return S.apply(y,h)}))},v.prototype.remove=function(y){var h=this.handlers.indexOf(y);this.handlers[h]=this.handlers[this.handlers.length-1],this.handlers.pop()},v.prototype.clear=function(){this.handlers=[]},v}();function Lt(){var v=new oi;function y(h){return v.register(h,this===null)}return y.once=function(h){var b=function(){for(var S=[],D=0;D<arguments.length;D++)S[D]=arguments[D];h.apply(this,S),v.remove(b)};v.register(b)},y.remove=function(h){return v.remove(h)},y.invoke=function(){for(var h=[],b=0;b<arguments.length;b++)h[b]=arguments[b];return v.invoke.apply(v,h)},y.invokeAsync=function(){for(var h=[],b=0;b<arguments.length;b++)h[b]=arguments[b];return v.invokeAsync.apply(v,h)},y.clear=function(){return v.clear()},y}var si=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof ut!="undefined"?ut:typeof self!="undefined"?self:{};function ai(v){var y={exports:{}};return v(y,y.exports),y.exports}var it=ai(function(v,y){(function(h,b){b(y)})(si,function(h){/*! *****************************************************************************
        Copyright (c) Microsoft Corporation.

        Permission to use, copy, modify, and/or distribute this software for any
        purpose with or without fee is hereby granted.

        THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
        REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
        AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
        INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
        LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
        OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
        PERFORMANCE OF THIS SOFTWARE.
        ***************************************************************************** */var b=function(l,o){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,m){u.__proto__=m}||function(u,m){for(var E in m)Object.prototype.hasOwnProperty.call(m,E)&&(u[E]=m[E])},b(l,o)};function S(l,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");b(l,o);function u(){this.constructor=l}l.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}function D(l,o,u,m){var E=arguments.length,M=E<3?o:m===null?m=Object.getOwnPropertyDescriptor(o,u):m,J;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(l,o,u,m);else for(var B=l.length-1;B>=0;B--)(J=l[B])&&(M=(E<3?J(M):E>3?J(o,u,M):J(o,u))||M);return E>3&&M&&Object.defineProperty(o,u,M),M}function z(l,o){for(var u=0,m=o.length,E=l.length;u<m;u++,E++)l[E]=o[u];return l}var N=255,F=213;h.OPERATION=void 0,function(l){l[l.ADD=128]="ADD",l[l.REPLACE=0]="REPLACE",l[l.DELETE=64]="DELETE",l[l.DELETE_AND_ADD=192]="DELETE_AND_ADD",l[l.TOUCH=1]="TOUCH",l[l.CLEAR=10]="CLEAR"}(h.OPERATION||(h.OPERATION={}));var L=function(){function l(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return l.prototype.getNextUniqueId=function(){return this.nextUniqueId++},l.prototype.addRef=function(o,u,m){m===void 0&&(m=!0),this.refs.set(o,u),m&&(this.refCounts[o]=(this.refCounts[o]||0)+1)},l.prototype.removeRef=function(o){this.refCounts[o]=this.refCounts[o]-1,this.deletedRefs.add(o)},l.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},l.prototype.garbageCollectDeletedRefs=function(){var o=this;this.deletedRefs.forEach(function(u){if(o.refCounts[u]<=0){var m=o.refs.get(u);if(m instanceof He)for(var E in m._definition.schema)typeof m._definition.schema[E]!="string"&&m[E]&&m[E].$changes&&o.removeRef(m[E].$changes.refId);else{var M=m.$changes.parent._definition,J=M.schema[M.fieldsByIndex[m.$changes.parentIndex]];typeof Object.values(J)[0]=="function"&&Array.from(m.values()).forEach(function(B){return o.removeRef(B.$changes.refId)})}o.refs.delete(u),delete o.refCounts[u]}}),this.deletedRefs.clear()},l}(),ae=function(){function l(o,u,m){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=o,this.setParent(u,m)}return l.prototype.setParent=function(o,u,m){var E=this;if(this.indexes||(this.indexes=this.ref instanceof He?this.ref._definition.indexes:{}),this.parent=o,this.parentIndex=m,!!u)if(this.root=u,this.ref instanceof He){var M=this.ref._definition;for(var J in M.schema){var B=this.ref[J];if(B&&B.$changes){var oe=M.indexes[J];B.$changes.setParent(this.ref,u,oe)}}}else typeof this.ref=="object"&&this.ref.forEach(function(ee,q){if(ee instanceof He){var X=ee.$changes,ce=E.ref.$changes.indexes[q];X.setParent(E.ref,E.root,ce)}})},l.prototype.operation=function(o){this.changes.set(--this.currentCustomOperation,o)},l.prototype.change=function(o,u){u===void 0&&(u=h.OPERATION.ADD);var m=typeof o=="number"?o:this.indexes[o];this.assertValidIndex(m,o);var E=this.changes.get(m);(!E||E.op===h.OPERATION.DELETE||E.op===h.OPERATION.TOUCH)&&this.changes.set(m,{op:E&&E.op===h.OPERATION.DELETE?h.OPERATION.DELETE_AND_ADD:u,index:m}),this.allChanges.add(m),this.changed=!0,this.touchParents()},l.prototype.touch=function(o){var u=typeof o=="number"?o:this.indexes[o];this.assertValidIndex(u,o),this.changes.has(u)||this.changes.set(u,{op:h.OPERATION.TOUCH,index:u}),this.allChanges.add(u),this.touchParents()},l.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},l.prototype.getType=function(o){if(this.ref._definition){var u=this.ref._definition;return u.schema[u.fieldsByIndex[o]]}else{var u=this.parent._definition,m=u.schema[u.fieldsByIndex[this.parentIndex]];return Object.values(m)[0]}},l.prototype.getChildrenFilter=function(){var o=this.parent._definition.childFilters;return o&&o[this.parentIndex]},l.prototype.getValue=function(o){return this.ref.getByIndex(o)},l.prototype.delete=function(o){var u=typeof o=="number"?o:this.indexes[o];if(u===void 0){console.warn("@colyseus/schema "+this.ref.constructor.name+": trying to delete non-existing index: "+o+" ("+u+")");return}var m=this.getValue(u);this.changes.set(u,{op:h.OPERATION.DELETE,index:u}),this.allChanges.delete(u),delete this.caches[u],m&&m.$changes&&(m.$changes.parent=void 0),this.changed=!0,this.touchParents()},l.prototype.discard=function(o,u){var m=this;o===void 0&&(o=!1),u===void 0&&(u=!1),this.ref instanceof He||this.changes.forEach(function(E){if(E.op===h.OPERATION.DELETE){var M=m.ref.getIndex(E.index);delete m.indexes[M]}}),this.changes.clear(),this.changed=o,u&&this.allChanges.clear(),this.currentCustomOperation=0},l.prototype.discardAll=function(){var o=this;this.changes.forEach(function(u){var m=o.getValue(u.index);m&&m.$changes&&m.$changes.discardAll()}),this.discard()},l.prototype.cache=function(o,u){this.caches[o]=u},l.prototype.clone=function(){return new l(this.ref,this.parent,this.root)},l.prototype.ensureRefId=function(){this.refId===void 0&&(this.refId=this.root.getNextUniqueId())},l.prototype.assertValidIndex=function(o,u){if(o===void 0)throw new Error('ChangeTree: missing index for field "'+u+'"')},l}(),pe=function(l,o){var u=l.toString(),m=o.toString();return u<m?-1:u>m?1:0};function ke(l){return l.$proxy=!0,l=new Proxy(l,{get:function(o,u){return typeof u!="symbol"&&!isNaN(u)?o.at(u):o[u]},set:function(o,u,m){if(typeof u!="symbol"&&!isNaN(u)){var E=Array.from(o.$items.keys()),M=parseInt(E[u]||u);m==null?o.deleteAt(M):o.setAt(M,m)}else o[u]=m;return!0},deleteProperty:function(o,u){return typeof u=="number"?o.deleteAt(u):delete o[u],!0}}),l}var Je=function(){function l(){for(var o=[],u=0;u<arguments.length;u++)o[u]=arguments[u];this.$changes=new ae(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,o)}return l.is=function(o){return Array.isArray(o)||o.array!==void 0},Object.defineProperty(l.prototype,"length",{get:function(){return this.$items.size},set:function(o){o===0?this.clear():this.splice(o,this.length-o)},enumerable:!1,configurable:!0}),l.prototype.push=function(){for(var o=this,u=[],m=0;m<arguments.length;m++)u[m]=arguments[m];var E;return u.forEach(function(M){E=o.$refId++,o.setAt(E,M)}),E},l.prototype.pop=function(){var o=Array.from(this.$indexes.values()).pop();if(o!==void 0){this.$changes.delete(o),this.$indexes.delete(o);var u=this.$items.get(o);return this.$items.delete(o),u}},l.prototype.at=function(o){var u=Array.from(this.$items.keys())[o];return this.$items.get(u)},l.prototype.setAt=function(o,u){var m,E;u.$changes!==void 0&&u.$changes.setParent(this,this.$changes.root,o);var M=(E=(m=this.$changes.indexes[o])===null||m===void 0?void 0:m.op)!==null&&E!==void 0?E:h.OPERATION.ADD;this.$changes.indexes[o]=o,this.$indexes.set(o,o),this.$items.set(o,u),this.$changes.change(o,M)},l.prototype.deleteAt=function(o){var u=Array.from(this.$items.keys())[o];return u===void 0?!1:this.$deleteAt(u)},l.prototype.$deleteAt=function(o){return this.$changes.delete(o),this.$indexes.delete(o),this.$items.delete(o)},l.prototype.clear=function(o){var u=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),o&&typeof this.$changes.getType()!="string"&&this.$items.forEach(function(m){u.$changes.root.removeRef(m.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:h.OPERATION.CLEAR}),this.$changes.touchParents()},l.prototype.concat=function(){for(var o,u=[],m=0;m<arguments.length;m++)u[m]=arguments[m];return new(l.bind.apply(l,z([void 0],(o=Array.from(this.$items.values())).concat.apply(o,u))))},l.prototype.join=function(o){return Array.from(this.$items.values()).join(o)},l.prototype.reverse=function(){var o=this,u=Array.from(this.$items.keys()),m=Array.from(this.$items.values()).reverse();return m.forEach(function(E,M){o.setAt(u[M],E)}),this},l.prototype.shift=function(){var o=Array.from(this.$items.keys()),u=o.shift();if(u!==void 0){var m=this.$items.get(u);return this.$deleteAt(u),m}},l.prototype.slice=function(o,u){return new(l.bind.apply(l,z([void 0],Array.from(this.$items.values()).slice(o,u))))},l.prototype.sort=function(o){var u=this;o===void 0&&(o=pe);var m=Array.from(this.$items.keys()),E=Array.from(this.$items.values()).sort(o);return E.forEach(function(M,J){u.setAt(m[J],M)}),this},l.prototype.splice=function(o,u){u===void 0&&(u=this.length-o);for(var m=[],E=2;E<arguments.length;E++)m[E-2]=arguments[E];for(var M=Array.from(this.$items.keys()),J=[],B=o;B<o+u;B++)J.push(this.$items.get(M[B])),this.$deleteAt(M[B]);return J},l.prototype.unshift=function(){for(var o=this,u=[],m=0;m<arguments.length;m++)u[m]=arguments[m];var E=this.length,M=u.length,J=Array.from(this.$items.values());return u.forEach(function(B,oe){o.setAt(oe,B)}),J.forEach(function(B,oe){o.setAt(M+oe,B)}),E+M},l.prototype.indexOf=function(o,u){return Array.from(this.$items.values()).indexOf(o,u)},l.prototype.lastIndexOf=function(o,u){return u===void 0&&(u=this.length-1),Array.from(this.$items.values()).lastIndexOf(o,u)},l.prototype.every=function(o,u){return Array.from(this.$items.values()).every(o,u)},l.prototype.some=function(o,u){return Array.from(this.$items.values()).some(o,u)},l.prototype.forEach=function(o,u){Array.from(this.$items.values()).forEach(o,u)},l.prototype.map=function(o,u){return Array.from(this.$items.values()).map(o,u)},l.prototype.filter=function(o,u){return Array.from(this.$items.values()).filter(o,u)},l.prototype.reduce=function(o,u){return Array.from(this.$items.values()).reduce(o,u)},l.prototype.reduceRight=function(o,u){return Array.from(this.$items.values()).reduceRight(o,u)},l.prototype.find=function(o,u){return Array.from(this.$items.values()).find(o,u)},l.prototype.findIndex=function(o,u){return Array.from(this.$items.values()).findIndex(o,u)},l.prototype.fill=function(o,u,m){throw new Error("ArraySchema#fill() not implemented")},l.prototype.copyWithin=function(o,u,m){throw new Error("ArraySchema#copyWithin() not implemented")},l.prototype.toString=function(){return this.$items.toString()},l.prototype.toLocaleString=function(){return this.$items.toLocaleString()},l.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},l.prototype[Symbol.unscopables]=function(){return this.$items[Symbol.unscopables]()},l.prototype.entries=function(){return this.$items.entries()},l.prototype.keys=function(){return this.$items.keys()},l.prototype.values=function(){return this.$items.values()},l.prototype.includes=function(o,u){return Array.from(this.$items.values()).includes(o,u)},l.prototype.flatMap=function(o,u){throw new Error("ArraySchema#flatMap() is not supported.")},l.prototype.flat=function(o){throw new Error("ArraySchema#flat() is not supported.")},l.prototype.setIndex=function(o,u){this.$indexes.set(o,u)},l.prototype.getIndex=function(o){return this.$indexes.get(o)},l.prototype.getByIndex=function(o){return this.$items.get(this.$indexes.get(o))},l.prototype.deleteByIndex=function(o){var u=this.$indexes.get(o);this.$items.delete(u),this.$indexes.delete(o)},l.prototype.toArray=function(){return Array.from(this.$items.values())},l.prototype.toJSON=function(){return this.toArray().map(function(o){return typeof o.toJSON=="function"?o.toJSON():o})},l.prototype.clone=function(o){var u;return o?u=new(l.bind.apply(l,z([void 0],Array.from(this.$items.values())))):u=new(l.bind.apply(l,z([void 0],this.map(function(m){return m.$changes?m.clone():m})))),u},l.prototype.triggerAll=function(){He.prototype.triggerAll.apply(this)},l}();function Ft(l){return l.$proxy=!0,l=new Proxy(l,{get:function(o,u){return typeof u!="symbol"&&typeof o[u]=="undefined"?o.get(u):o[u]},set:function(o,u,m){return typeof u!="symbol"&&u.indexOf("$")===-1&&u!=="onAdd"&&u!=="onRemove"&&u!=="onChange"?o.set(u,m):o[u]=m,!0},deleteProperty:function(o,u){return o.delete(u),!0}}),l}var qe=function(){function l(o){var u=this;if(this.$changes=new ae(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,o)if(o instanceof Map)o.forEach(function(E,M){return u.set(M,E)});else for(var m in o)this.set(m,o[m])}return l.is=function(o){return o.map!==void 0},l.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(l.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),l.prototype.set=function(o,u){if(u==null)throw new Error("MapSchema#set('"+o+"', "+u+"): trying to set "+u+" value on '"+o+"'.");var m=typeof this.$changes.indexes[o]!="undefined",E=m?this.$changes.indexes[o]:this.$refId++,M=m?h.OPERATION.REPLACE:h.OPERATION.ADD,J=u.$changes!==void 0;return J&&u.$changes.setParent(this,this.$changes.root,E),m?J&&this.$items.get(o)!==u&&(M=h.OPERATION.ADD):(this.$changes.indexes[o]=E,this.$indexes.set(E,o)),this.$items.set(o,u),this.$changes.change(o,M),this},l.prototype.get=function(o){return this.$items.get(o)},l.prototype.delete=function(o){return this.$changes.delete(o),this.$items.delete(o)},l.prototype.clear=function(o){var u=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),o&&typeof this.$changes.getType()!="string"&&this.$items.forEach(function(m){u.$changes.root.removeRef(m.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:h.OPERATION.CLEAR}),this.$changes.touchParents()},l.prototype.has=function(o){return this.$items.has(o)},l.prototype.forEach=function(o){this.$items.forEach(o)},l.prototype.entries=function(){return this.$items.entries()},l.prototype.keys=function(){return this.$items.keys()},l.prototype.values=function(){return this.$items.values()},Object.defineProperty(l.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),l.prototype.setIndex=function(o,u){this.$indexes.set(o,u)},l.prototype.getIndex=function(o){return this.$indexes.get(o)},l.prototype.getByIndex=function(o){return this.$items.get(this.$indexes.get(o))},l.prototype.deleteByIndex=function(o){var u=this.$indexes.get(o);this.$items.delete(u),this.$indexes.delete(o)},l.prototype.toJSON=function(){var o={};return this.forEach(function(u,m){o[m]=typeof u.toJSON=="function"?u.toJSON():u}),o},l.prototype.clone=function(o){var u;return o?u=Object.assign(new l,this):(u=new l,this.forEach(function(m,E){m.$changes?u.set(E,m.clone()):u.set(E,m)})),u},l.prototype.triggerAll=function(){He.prototype.triggerAll.apply(this)},l}(),On={};function Et(l,o){On[l]=o}function Nt(l){return On[l]}var Zt=function(){function l(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return l.create=function(o){var u=new l;return u.schema=Object.assign({},o&&o.schema||{}),u.indexes=Object.assign({},o&&o.indexes||{}),u.fieldsByIndex=Object.assign({},o&&o.fieldsByIndex||{}),u.descriptors=Object.assign({},o&&o.descriptors||{}),u.deprecated=Object.assign({},o&&o.deprecated||{}),u},l.prototype.addField=function(o,u){var m=this.getNextFieldIndex();this.fieldsByIndex[m]=o,this.indexes[o]=m,this.schema[o]=Array.isArray(u)?{array:u[0]}:u},l.prototype.addFilter=function(o,u){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[o]]=u,this.indexesWithFilters.push(this.indexes[o]),!0},l.prototype.addChildrenFilter=function(o,u){var m=this.indexes[o],E=this.schema[o];if(Nt(Object.keys(E)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[m]=u,!0;console.warn("@filterChildren: field '"+o+"' can't have children. Ignoring filter.")},l.prototype.getChildrenFilter=function(o){return this.childFilters&&this.childFilters[this.indexes[o]]},l.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},l}();function pi(l){return l._context&&l._context.useFilters}var jt=function(){function l(){this.types={},this.schemas=new Map,this.useFilters=!1}return l.prototype.has=function(o){return this.schemas.has(o)},l.prototype.get=function(o){return this.types[o]},l.prototype.add=function(o,u){u===void 0&&(u=this.schemas.size),o._definition=Zt.create(o._definition),o._typeid=u,this.types[u]=o,this.schemas.set(o,u)},l.create=function(o){return o===void 0&&(o=new l),function(u){return Qe(u,o)}},l}(),Sn=new jt;function Qe(l,o){return o===void 0&&(o=Sn),function(u,m){var E=u.constructor;E._context=o,o.has(E)||o.add(E);var M=E._definition;if(M.addField(m,l),M.descriptors[m]){if(M.deprecated[m])return;try{throw new Error("@colyseus/schema: Duplicate '"+m+"' definition on '"+E.name+`'.
Check @type() annotation`)}catch(X){var J=X.stack.split(`
`)[4].trim();throw new Error(X.message+" "+J)}}var B=Je.is(l),oe=!B&&qe.is(l);if(typeof l!="string"&&!He.is(l)){var ee=Object.values(l)[0];typeof ee!="string"&&!o.has(ee)&&o.add(ee)}var q="_"+m;M.descriptors[q]={enumerable:!1,configurable:!1,writable:!0},M.descriptors[m]={get:function(){return this[q]},set:function(X){X!==this[q]&&(X!=null?(B&&!(X instanceof Je)&&(X=new(Je.bind.apply(Je,z([void 0],X)))),oe&&!(X instanceof qe)&&(X=new qe(X)),X.$proxy===void 0&&(oe?X=Ft(X):B&&(X=ke(X))),this.$changes.change(m),X.$changes&&X.$changes.setParent(this,this.$changes.root,this._definition.indexes[m])):this.$changes.delete(m),this[q]=X)},enumerable:!0,configurable:!0}}}function mi(l){return function(o,u){var m=o.constructor,E=m._definition;E.addFilter(u,l)&&(m._context.useFilters=!0)}}function vi(l){return function(o,u){var m=o.constructor,E=m._definition;E.addChildrenFilter(u,l)&&(m._context.useFilters=!0)}}function gi(l,o){return l===void 0&&(l=!0),function(u,m){var E=u.constructor,M=E._definition;M.deprecated[m]=!0,l&&(M.descriptors[m]={get:function(){throw new Error(m+" is deprecated.")},set:function(J){},enumerable:!1,configurable:!0})}}function yi(l,o,u){u===void 0&&(u=l._context||Sn);for(var m in o)Qe(o[m],u)(l.prototype,m);return l}function wi(l){for(var o=0,u=0,m=0,E=l.length;m<E;m++)o=l.charCodeAt(m),o<128?u+=1:o<2048?u+=2:o<55296||o>=57344?u+=3:(m++,u+=4);return u}function Rn(l,o,u){for(var m=0,E=0,M=u.length;E<M;E++)m=u.charCodeAt(E),m<128?l[o++]=m:m<2048?(l[o++]=192|m>>6,l[o++]=128|m&63):m<55296||m>=57344?(l[o++]=224|m>>12,l[o++]=128|m>>6&63,l[o++]=128|m&63):(E++,m=65536+((m&1023)<<10|u.charCodeAt(E)&1023),l[o++]=240|m>>18,l[o++]=128|m>>12&63,l[o++]=128|m>>6&63,l[o++]=128|m&63)}function Dn(l,o){l.push(o&255)}function Ge(l,o){l.push(o&255)}function Mn(l,o){l.push(o&255),l.push(o>>8&255)}function Qt(l,o){l.push(o&255),l.push(o>>8&255)}function xt(l,o){l.push(o&255),l.push(o>>8&255),l.push(o>>16&255),l.push(o>>24&255)}function ht(l,o){var u=o>>24,m=o>>16,E=o>>8,M=o;l.push(M&255),l.push(E&255),l.push(m&255),l.push(u&255)}function Pn(l,o){var u=Math.floor(o/Math.pow(2,32)),m=o>>>0;ht(l,m),ht(l,u)}function Cn(l,o){var u=o/Math.pow(2,32)>>0,m=o>>>0;ht(l,m),ht(l,u)}function Ai(l,o){Ln(l,o)}function bi(l,o){en(l,o)}var kt=new Int32Array(2),$i=new Float32Array(kt.buffer),Ii=new Float64Array(kt.buffer);function Ln(l,o){$i[0]=o,xt(l,kt[0])}function en(l,o){Ii[0]=o,xt(l,kt[0]),xt(l,kt[1])}function Ti(l,o){return Ge(l,o?1:0)}function Bt(l,o){o||(o="");var u=wi(o),m=0;if(u<32)l.push(u|160),m=1;else if(u<256)l.push(217),Ge(l,u),m=2;else if(u<65536)l.push(218),Qt(l,u),m=3;else if(u<4294967296)l.push(219),ht(l,u),m=5;else throw new Error("String too long");return Rn(l,l.length,o),m+u}function Ye(l,o){if(isNaN(o))return Ye(l,0);if(isFinite(o)){if(o!==(o|0))return l.push(203),en(l,o),9}else return Ye(l,o>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER);return o>=0?o<128?(Ge(l,o),1):o<256?(l.push(204),Ge(l,o),2):o<65536?(l.push(205),Qt(l,o),3):o<4294967296?(l.push(206),ht(l,o),5):(l.push(207),Cn(l,o),9):o>=-32?(l.push(224|o+32),1):o>=-128?(l.push(208),Dn(l,o),2):o>=-32768?(l.push(209),Mn(l,o),3):o>=-2147483648?(l.push(210),xt(l,o),5):(l.push(211),Pn(l,o),9)}var tn=Object.freeze({__proto__:null,utf8Write:Rn,int8:Dn,uint8:Ge,int16:Mn,uint16:Qt,int32:xt,uint32:ht,int64:Pn,uint64:Cn,float32:Ai,float64:bi,writeFloat32:Ln,writeFloat64:en,boolean:Ti,string:Bt,number:Ye});function Ei(l,o,u){for(var m="",E=0,M=o,J=o+u;M<J;M++){var B=l[M];if((B&128)===0){m+=String.fromCharCode(B);continue}if((B&224)===192){m+=String.fromCharCode((B&31)<<6|l[++M]&63);continue}if((B&240)===224){m+=String.fromCharCode((B&15)<<12|(l[++M]&63)<<6|(l[++M]&63)<<0);continue}if((B&248)===240){E=(B&7)<<18|(l[++M]&63)<<12|(l[++M]&63)<<6|(l[++M]&63)<<0,E>=65536?(E-=65536,m+=String.fromCharCode((E>>>10)+55296,(E&1023)+56320)):m+=String.fromCharCode(E);continue}console.error("Invalid byte "+B.toString(16))}return m}function Fn(l,o){return Ot(l,o)<<24>>24}function Ot(l,o){return l[o.offset++]}function Nn(l,o){return Ht(l,o)<<16>>16}function Ht(l,o){return l[o.offset++]|l[o.offset++]<<8}function _t(l,o){return l[o.offset++]|l[o.offset++]<<8|l[o.offset++]<<16|l[o.offset++]<<24}function bt(l,o){return _t(l,o)>>>0}function xi(l,o){return nn(l,o)}function ki(l,o){return rn(l,o)}function jn(l,o){var u=bt(l,o),m=_t(l,o)*Math.pow(2,32);return m+u}function Bn(l,o){var u=bt(l,o),m=bt(l,o)*Math.pow(2,32);return m+u}var St=new Int32Array(2),Oi=new Float32Array(St.buffer),Si=new Float64Array(St.buffer);function nn(l,o){return St[0]=_t(l,o),Oi[0]}function rn(l,o){return St[0]=_t(l,o),St[1]=_t(l,o),Si[0]}function Ri(l,o){return Ot(l,o)>0}function Hn(l,o){var u=l[o.offset++],m;u<192?m=u&31:u===217?m=Ot(l,o):u===218?m=Ht(l,o):u===219&&(m=bt(l,o));var E=Ei(l,o.offset,m);return o.offset+=m,E}function Di(l,o){var u=l[o.offset];return u<192&&u>160||u===217||u===218||u===219}function pt(l,o){var u=l[o.offset++];if(u<128)return u;if(u===202)return nn(l,o);if(u===203)return rn(l,o);if(u===204)return Ot(l,o);if(u===205)return Ht(l,o);if(u===206)return bt(l,o);if(u===207)return Bn(l,o);if(u===208)return Fn(l,o);if(u===209)return Nn(l,o);if(u===210)return _t(l,o);if(u===211)return jn(l,o);if(u>223)return(255-u+1)*-1}function Mi(l,o){var u=l[o.offset];return u<128||u>=202&&u<=211}function Pi(l,o){return l[o.offset]<160}function Un(l,o){return l[o.offset-1]===N&&(l[o.offset]<128||l[o.offset]>=202&&l[o.offset]<=211)}var Vn=Object.freeze({__proto__:null,int8:Fn,uint8:Ot,int16:Nn,uint16:Ht,int32:_t,uint32:bt,float32:xi,float64:ki,int64:jn,uint64:Bn,readFloat32:nn,readFloat64:rn,boolean:Ri,string:Hn,stringCheck:Di,number:pt,numberCheck:Mi,arrayCheck:Pi,switchStructureCheck:Un}),on=function(){function l(o){var u=this;this.$changes=new ae(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,o&&o.forEach(function(m){return u.add(m)})}return l.is=function(o){return o.collection!==void 0},l.prototype.add=function(o){var u=this.$refId++,m=o.$changes!==void 0;return m&&o.$changes.setParent(this,this.$changes.root,u),this.$changes.indexes[u]=u,this.$indexes.set(u,u),this.$items.set(u,o),this.$changes.change(u),u},l.prototype.at=function(o){var u=Array.from(this.$items.keys())[o];return this.$items.get(u)},l.prototype.entries=function(){return this.$items.entries()},l.prototype.delete=function(o){for(var u=this.$items.entries(),m,E;(E=u.next())&&!E.done;)if(o===E.value[1]){m=E.value[0];break}return m===void 0?!1:(this.$changes.delete(m),this.$indexes.delete(m),this.$items.delete(m))},l.prototype.clear=function(o){var u=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),o&&typeof this.$changes.getType()!="string"&&this.$items.forEach(function(m){u.$changes.root.removeRef(m.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:h.OPERATION.CLEAR}),this.$changes.touchParents()},l.prototype.has=function(o){return Array.from(this.$items.values()).some(function(u){return u===o})},l.prototype.forEach=function(o){var u=this;this.$items.forEach(function(m,E,M){return o(m,E,u)})},l.prototype.values=function(){return this.$items.values()},Object.defineProperty(l.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),l.prototype.setIndex=function(o,u){this.$indexes.set(o,u)},l.prototype.getIndex=function(o){return this.$indexes.get(o)},l.prototype.getByIndex=function(o){return this.$items.get(this.$indexes.get(o))},l.prototype.deleteByIndex=function(o){var u=this.$indexes.get(o);this.$items.delete(u),this.$indexes.delete(o)},l.prototype.toArray=function(){return Array.from(this.$items.values())},l.prototype.toJSON=function(){var o=[];return this.forEach(function(u,m){o.push(typeof u.toJSON=="function"?u.toJSON():u)}),o},l.prototype.clone=function(o){var u;return o?u=Object.assign(new l,this):(u=new l,this.forEach(function(m){m.$changes?u.add(m.clone()):u.add(m)})),u},l.prototype.triggerAll=function(){He.prototype.triggerAll.apply(this)},l}(),sn=function(){function l(o){var u=this;this.$changes=new ae(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,o&&o.forEach(function(m){return u.add(m)})}return l.is=function(o){return o.set!==void 0},l.prototype.add=function(o){var u,m;if(this.has(o))return!1;var E=this.$refId++;o.$changes!==void 0&&o.$changes.setParent(this,this.$changes.root,E);var M=(m=(u=this.$changes.indexes[E])===null||u===void 0?void 0:u.op)!==null&&m!==void 0?m:h.OPERATION.ADD;return this.$changes.indexes[E]=E,this.$indexes.set(E,E),this.$items.set(E,o),this.$changes.change(E,M),E},l.prototype.entries=function(){return this.$items.entries()},l.prototype.delete=function(o){for(var u=this.$items.entries(),m,E;(E=u.next())&&!E.done;)if(o===E.value[1]){m=E.value[0];break}return m===void 0?!1:(this.$changes.delete(m),this.$indexes.delete(m),this.$items.delete(m))},l.prototype.clear=function(o){var u=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),o&&typeof this.$changes.getType()!="string"&&this.$items.forEach(function(m){u.$changes.root.removeRef(m.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:h.OPERATION.CLEAR}),this.$changes.touchParents()},l.prototype.has=function(o){for(var u=this.$items.values(),m=!1,E;(E=u.next())&&!E.done;)if(o===E.value){m=!0;break}return m},l.prototype.forEach=function(o){var u=this;this.$items.forEach(function(m,E,M){return o(m,E,u)})},l.prototype.values=function(){return this.$items.values()},Object.defineProperty(l.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),l.prototype.setIndex=function(o,u){this.$indexes.set(o,u)},l.prototype.getIndex=function(o){return this.$indexes.get(o)},l.prototype.getByIndex=function(o){return this.$items.get(this.$indexes.get(o))},l.prototype.deleteByIndex=function(o){var u=this.$indexes.get(o);this.$items.delete(u),this.$indexes.delete(o)},l.prototype.toArray=function(){return Array.from(this.$items.values())},l.prototype.toJSON=function(){var o=[];return this.forEach(function(u,m){o.push(typeof u.toJSON=="function"?u.toJSON():u)}),o},l.prototype.clone=function(o){var u;return o?u=Object.assign(new l,this):(u=new l,this.forEach(function(m){m.$changes?u.add(m.clone()):u.add(m)})),u},l.prototype.triggerAll=function(){He.prototype.triggerAll.apply(this)},l}(),Ci=function(){function l(){this.handlers=[]}return l.prototype.register=function(o,u){return this.handlers.push(o),this},l.prototype.invoke=function(){for(var o=[],u=0;u<arguments.length;u++)o[u]=arguments[u];this.handlers.forEach(function(m){return m.apply(void 0,o)})},l.prototype.invokeAsync=function(){for(var o=[],u=0;u<arguments.length;u++)o[u]=arguments[u];return Promise.all(this.handlers.map(function(m){return m.apply(void 0,o)}))},l.prototype.remove=function(o){var u=this.handlers.indexOf(o);this.handlers[u]=this.handlers[this.handlers.length-1],this.handlers.pop()},l.prototype.clear=function(){this.handlers=[]},l}(),Li=function(){function l(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return l.prototype.addRefId=function(o){this.refIds.has(o)||(this.refIds.add(o),this.containerIndexes.set(o,new Set))},l.get=function(o){return o.$filterState===void 0&&(o.$filterState=new l),o.$filterState},l}(),an=function(l){S(o,l);function o(){return l!==null&&l.apply(this,arguments)||this}return o}(Error);function Fi(l,o,u,m){var E,M=!1;switch(o){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":E="number",isNaN(l)&&console.log('trying to encode "NaN" in '+u.constructor.name+"#"+m);break;case"string":E="string",M=!0;break;case"boolean":return}if(typeof l!==E&&(!M||M&&l!==null)){var J="'"+JSON.stringify(l)+"'"+(l&&l.constructor&&" ("+l.constructor.name+")"||"");throw new an("a '"+E+"' was expected, but "+J+" was provided in "+u.constructor.name+"#"+m)}}function qn(l,o,u,m){if(!(l instanceof o))throw new an("a '"+o.name+"' was expected, but '"+l.constructor.name+"' was provided in "+u.constructor.name+"#"+m)}function Ni(l,o,u,m,E){Fi(u,l,m,E);var M=tn[l];if(M)M(o,u);else throw new an("a '"+l+"' was expected, but "+u+" was provided in "+m.constructor.name+"#"+E)}function ji(l,o,u){return Vn[l](o,u)}var He=function(){function l(){for(var o=[],u=0;u<arguments.length;u++)o[u]=arguments[u];Object.defineProperties(this,{$changes:{value:new ae(this,void 0,new L),enumerable:!1,writable:!0},$listeners:{value:{},enumerable:!1,writable:!0}});var m=this._definition.descriptors;m&&Object.defineProperties(this,m),o[0]&&this.assign(o[0])}return l.onError=function(o){console.error(o)},l.is=function(o){return o._definition&&o._definition.schema!==void 0},l.prototype.assign=function(o){return Object.assign(this,o),this},Object.defineProperty(l.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),l.prototype.listen=function(o,u){var m=this;return this.$listeners[o]||(this.$listeners[o]=new Ci),this.$listeners[o].register(u),function(){return m.$listeners[o].remove(u)}},l.prototype.decode=function(o,u,m,E){u===void 0&&(u={offset:0}),m===void 0&&(m=this),E===void 0&&(E=new Map);var M=this.$changes.root,J=o.length,B=0,oe=[];for(M.refs.set(B,this),E.set(B,oe);u.offset<J;){var ee=o[u.offset++];if(ee==N){B=pt(o,u);var q=M.refs.get(B);if(!q)throw new Error('"refId" not found: '+B);m=q,oe=[],E.set(B,oe);continue}var X=m.$changes,ce=m._definition!==void 0,ie=ce?ee>>6<<6:ee;if(ie===h.OPERATION.CLEAR){m.clear(!0);continue}var Q=ce?ee%(ie||255):pt(o,u),re=ce?m._definition.fieldsByIndex[Q]:"",fe=X.getType(Q),K=void 0,se=void 0,Ue=void 0;if(ce?se=m["_"+re]:(se=m.getByIndex(Q),(ie&h.OPERATION.ADD)===h.OPERATION.ADD?(Ue=m instanceof qe?Hn(o,u):Q,m.setIndex(Q,Ue)):Ue=m.getIndex(Q)),(ie&h.OPERATION.DELETE)===h.OPERATION.DELETE&&(ie!==h.OPERATION.DELETE_AND_ADD&&m.deleteByIndex(Q),se&&se.$changes&&M.removeRef(se.$changes.refId),K=null),re===void 0){console.warn("@colyseus/schema: definition mismatch");for(var te={offset:u.offset};u.offset<J&&!(Un(o,u)&&(te.offset=u.offset+1,M.refs.has(pt(o,te))));)u.offset++;continue}else if(ie!==h.OPERATION.DELETE)if(l.is(fe)){var Me=pt(o,u);if(K=M.refs.get(Me),ie!==h.OPERATION.REPLACE){var et=this.getSchemaType(o,u,fe);K||(K=this.createTypeInstance(et),K.$changes.refId=Me,se&&(K.onChange=se.onChange,K.onRemove=se.onRemove,K.$listeners=se.$listeners,se.$changes.refId&&Me!==se.$changes.refId&&M.removeRef(se.$changes.refId))),M.addRef(Me,K,K!==se)}}else if(typeof fe=="string")K=ji(fe,o,u);else{var Rt=Nt(Object.keys(fe)[0]),Ke=pt(o,u),Fe=M.refs.has(Ke)?se||M.refs.get(Ke):new Rt.constructor;if(K=Fe.clone(!0),K.$changes.refId=Ke,se&&(K.onAdd=se.onAdd,K.onRemove=se.onRemove,K.onChange=se.onChange,se.$changes.refId&&Ke!==se.$changes.refId)){M.removeRef(se.$changes.refId);for(var Ne=[],un=se.entries(),at=void 0;(at=un.next())&&!at.done;){var Ut=at.value,vt=Ut[0],$t=Ut[1];Ne.push({op:h.OPERATION.DELETE,field:vt,value:void 0,previousValue:$t})}E.set(se.$changes.refId,Ne)}M.addRef(Ke,K,Fe!==se),Rt.getProxy&&(K=Rt.getProxy(K))}var Ui=se!==K;if(K!=null){if(K.$changes&&K.$changes.setParent(X.ref,X.root,Q),m instanceof l)m[re]=K;else if(m instanceof qe){var vt=Ue;m.$items.set(vt,K)}else if(m instanceof Je)m.setAt(Q,K);else if(m instanceof on){var Vt=m.add(K);m.setIndex(Q,Vt)}else if(m instanceof sn){var Vt=m.add(K);Vt!==!1&&m.setIndex(Q,Vt)}}Ui&&oe.push({op:ie,field:re,dynamicIndex:Ue,value:K,previousValue:se})}return this._triggerChanges(E),M.garbageCollectDeletedRefs(),E},l.prototype.encode=function(o,u,m){o===void 0&&(o=!1),u===void 0&&(u=[]),m===void 0&&(m=!1);for(var E=this.$changes,M=new WeakSet,J=[E],B=1,oe=0;oe<B;oe++){var ee=J[oe],q=ee.ref,X=q instanceof l;ee.ensureRefId(),M.add(ee),ee!==E&&(ee.changed||o)&&(Ge(u,N),Ye(u,ee.refId));for(var ce=o?Array.from(ee.allChanges):Array.from(ee.changes.values()),ie=0,Q=ce.length;ie<Q;ie++){var re=o?{op:h.OPERATION.ADD,index:ce[ie]}:ce[ie],fe=re.index,K=X?q._definition.fieldsByIndex&&q._definition.fieldsByIndex[fe]:fe,se=u.length;if(re.op!==h.OPERATION.TOUCH)if(X)Ge(u,fe|re.op);else{if(Ge(u,re.op),re.op===h.OPERATION.CLEAR)continue;Ye(u,fe)}if(!X&&(re.op&h.OPERATION.ADD)==h.OPERATION.ADD&&q instanceof qe){var Ue=ee.ref.$indexes.get(fe);Bt(u,Ue)}if(re.op!==h.OPERATION.DELETE){var te=ee.getType(fe),Me=ee.getValue(fe);if(Me&&Me.$changes&&!M.has(Me.$changes)&&(J.push(Me.$changes),Me.$changes.ensureRefId(),B++),re.op!==h.OPERATION.TOUCH){if(l.is(te))qn(Me,te,q,K),Ye(u,Me.$changes.refId),(re.op&h.OPERATION.ADD)===h.OPERATION.ADD&&this.tryEncodeTypeId(u,te,Me.constructor);else if(typeof te=="string")Ni(te,u,Me,q,K);else{var et=Nt(Object.keys(te)[0]);qn(q["_"+K],et.constructor,q,K),Ye(u,Me.$changes.refId)}m&&ee.cache(fe,u.slice(se))}}}!o&&!m&&ee.discard()}return u},l.prototype.encodeAll=function(o){return this.encode(!0,[],o)},l.prototype.applyFilters=function(o,u){var m,E;u===void 0&&(u=!1);for(var M=this,J=new Set,B=Li.get(o),oe=[this.$changes],ee=1,q=[],X=function(ie){var Q=oe[ie];if(J.has(Q.refId))return"continue";var re=Q.ref,fe=re instanceof l;Ge(q,N),Ye(q,Q.refId);var K=B.refIds.has(Q),se=u||!K;B.addRefId(Q);var Ue=B.containerIndexes.get(Q),te=se?Array.from(Q.allChanges):Array.from(Q.changes.values());if(!u&&fe&&re._definition.indexesWithFilters){var Me=re._definition.indexesWithFilters;Me.forEach(function($t){!Ue.has($t)&&Q.allChanges.has($t)&&(se?te.push($t):te.push({op:h.OPERATION.ADD,index:$t}))})}for(var et=0,Rt=te.length;et<Rt;et++){var Ke=se?{op:h.OPERATION.ADD,index:te[et]}:te[et];if(Ke.op===h.OPERATION.CLEAR){Ge(q,Ke.op);continue}var Fe=Ke.index;if(Ke.op===h.OPERATION.DELETE){fe?Ge(q,Ke.op|Fe):(Ge(q,Ke.op),Ye(q,Fe));continue}var Ne=Q.getValue(Fe),un=Q.getType(Fe);if(fe){var at=re._definition.filters&&re._definition.filters[Fe];if(at&&!at.call(re,o,Ne,M)){Ne&&Ne.$changes&&J.add(Ne.$changes.refId);continue}}else{var Ut=Q.parent,at=Q.getChildrenFilter();if(at&&!at.call(Ut,o,re.$indexes.get(Fe),Ne,M)){Ne&&Ne.$changes&&J.add(Ne.$changes.refId);continue}}if(Ne.$changes&&(oe.push(Ne.$changes),ee++),Ke.op!==h.OPERATION.TOUCH)if(Ke.op===h.OPERATION.ADD||fe)q.push.apply(q,(m=Q.caches[Fe])!==null&&m!==void 0?m:[]),Ue.add(Fe);else if(Ue.has(Fe))q.push.apply(q,(E=Q.caches[Fe])!==null&&E!==void 0?E:[]);else{if(Ue.add(Fe),Ge(q,h.OPERATION.ADD),Ye(q,Fe),re instanceof qe){var vt=Q.ref.$indexes.get(Fe);Bt(q,vt)}Ne.$changes?Ye(q,Ne.$changes.refId):tn[un](q,Ne)}else if(Ne.$changes&&!fe){if(Ge(q,h.OPERATION.ADD),Ye(q,Fe),re instanceof qe){var vt=Q.ref.$indexes.get(Fe);Bt(q,vt)}Ye(q,Ne.$changes.refId)}}},ce=0;ce<ee;ce++)X(ce);return q},l.prototype.clone=function(){var o=new this.constructor,u=this._definition.schema;for(var m in u)typeof this[m]=="object"&&typeof this[m].clone=="function"?o[m]=this[m].clone():o[m]=this[m];return o},l.prototype.triggerAll=function(){if(this.$changes.root.refs.size!==0){var o=new Map;l.prototype._triggerAllFillChanges.call(this,this,o);try{l.prototype._triggerChanges.call(this,o)}catch(u){l.onError(u)}}},l.prototype.toJSON=function(){var o=this._definition.schema,u=this._definition.deprecated,m={};for(var E in o)!u[E]&&this[E]!==null&&typeof this[E]!="undefined"&&(m[E]=typeof this[E].toJSON=="function"?this[E].toJSON():this["_"+E]);return m},l.prototype.discardAllChanges=function(){this.$changes.discardAll()},l.prototype.getByIndex=function(o){return this[this._definition.fieldsByIndex[o]]},l.prototype.deleteByIndex=function(o){this[this._definition.fieldsByIndex[o]]=void 0},l.prototype.tryEncodeTypeId=function(o,u,m){u._typeid!==m._typeid&&(Ge(o,F),Ye(o,m._typeid))},l.prototype.getSchemaType=function(o,u,m){var E;return o[u.offset]===F&&(u.offset++,E=this.constructor._context.get(pt(o,u))),E||m},l.prototype.createTypeInstance=function(o){var u=new o;return u.$changes.root=this.$changes.root,u},l.prototype._triggerAllFillChanges=function(o,u){if(!u.has(o.$changes.refId)){var m=[];if(u.set(o.$changes.refId||0,m),o instanceof l){var E=o._definition.schema;for(var M in E){var J="_"+M,B=o[J];B!==void 0&&(m.push({op:h.OPERATION.ADD,field:M,value:B,previousValue:void 0}),B.$changes!==void 0&&l.prototype._triggerAllFillChanges.call(this,B,u))}}else for(var oe=o.entries(),ee=void 0;(ee=oe.next())&&!ee.done;){var q=ee.value,X=q[0],B=q[1];m.push({op:h.OPERATION.ADD,field:X,dynamicIndex:X,value:B,previousValue:void 0}),B.$changes!==void 0&&l.prototype._triggerAllFillChanges.call(this,B,u)}}},l.prototype._triggerChanges=function(o){var u=this;o.forEach(function(m,E){var M,J,B,oe,ee,q,X,ce,ie,Q,re,fe;if(m.length>0){for(var K=u.$changes.root.refs.get(E),se=K instanceof l,Ue=0;Ue<m.length;Ue++){var te=m[Ue],Me=K.$listeners&&K.$listeners[te.field];if(se||(te.op===h.OPERATION.ADD&&te.previousValue===void 0?(J=(M=K).onAdd)===null||J===void 0||J.call(M,te.value,(B=te.dynamicIndex)!==null&&B!==void 0?B:te.field):te.op===h.OPERATION.DELETE?te.previousValue!==void 0&&((ee=(oe=K).onRemove)===null||ee===void 0||ee.call(oe,te.previousValue,(q=te.dynamicIndex)!==null&&q!==void 0?q:te.field)):te.op===h.OPERATION.DELETE_AND_ADD?(te.previousValue!==void 0&&((ce=(X=K).onRemove)===null||ce===void 0||ce.call(X,te.previousValue,te.dynamicIndex)),(Q=(ie=K).onAdd)===null||Q===void 0||Q.call(ie,te.value,te.dynamicIndex)):(te.op===h.OPERATION.REPLACE||te.value!==te.previousValue)&&((fe=(re=K).onChange)===null||fe===void 0||fe.call(re,te.value,te.dynamicIndex))),(te.op&h.OPERATION.DELETE)===h.OPERATION.DELETE&&te.previousValue instanceof l&&te.previousValue.onRemove&&te.previousValue.onRemove(),Me)try{Me.invoke(te.value,te.previousValue)}catch(et){l.onError(et)}}if(se&&K.onChange)try{K.onChange(m)}catch(et){l.onError(et)}}})},l._definition=Zt.create(),l}();function Bi(l){for(var o=[l.$changes],u=1,m={},E=m,M=function(B){var oe=o[B];oe.changes.forEach(function(ee){var q=oe.ref,X=ee.index,ce=q._definition?q._definition.fieldsByIndex[X]:q.$indexes.get(X);E[ce]=oe.getValue(X)})},J=0;J<u;J++)M(J);return m}var mt=new jt,fn=function(l){S(o,l);function o(){return l!==null&&l.apply(this,arguments)||this}return D([Qe("string",mt)],o.prototype,"name",void 0),D([Qe("string",mt)],o.prototype,"type",void 0),D([Qe("number",mt)],o.prototype,"referencedType",void 0),o}(He),ln=function(l){S(o,l);function o(){var u=l!==null&&l.apply(this,arguments)||this;return u.fields=new Je,u}return D([Qe("number",mt)],o.prototype,"id",void 0),D([Qe([fn],mt)],o.prototype,"fields",void 0),o}(He),Hi=function(l){S(o,l);function o(){var u=l!==null&&l.apply(this,arguments)||this;return u.types=new Je,u}return o.encode=function(u){var m=u.constructor,E=new o;E.rootType=m._typeid;var M=function(ee,q){for(var X in q){var ce=new fn;ce.name=X;var ie=void 0;if(typeof q[X]=="string")ie=q[X];else{var Q=q[X],re=void 0;He.is(Q)?(ie="ref",re=q[X]):(ie=Object.keys(Q)[0],typeof Q[ie]=="string"?ie+=":"+Q[ie]:re=Q[ie]),ce.referencedType=re?re._typeid:-1}ce.type=ie,ee.fields.push(ce)}E.types.push(ee)},J=m._context.types;for(var B in J){var oe=new ln;oe.id=Number(B),M(oe,J[B]._definition.schema)}return E.encodeAll()},o.decode=function(u,m){var E=new jt,M=new o;M.decode(u,m);var J=M.types.reduce(function(X,ce){var ie=function(re){S(fe,re);function fe(){return re!==null&&re.apply(this,arguments)||this}return fe}(He),Q=ce.id;return X[Q]=ie,E.add(ie,Q),X},{});M.types.forEach(function(X){var ce=J[X.id];X.fields.forEach(function(ie){var Q;if(ie.referencedType!==void 0){var re=ie.type,fe=J[ie.referencedType];if(!fe){var K=ie.type.split(":");re=K[0],fe=K[1]}re==="ref"?Qe(fe,E)(ce.prototype,ie.name):Qe((Q={},Q[re]=fe,Q),E)(ce.prototype,ie.name)}else Qe(ie.type,E)(ce.prototype,ie.name)})});var B=J[M.rootType],oe=new B;for(var ee in B._definition.schema){var q=B._definition.schema[ee];typeof q!="string"&&(oe[ee]=typeof q=="function"?new q:new(Nt(Object.keys(q)[0])).constructor)}return oe},D([Qe([ln],mt)],o.prototype,"types",void 0),D([Qe("number",mt)],o.prototype,"rootType",void 0),o}(He);Et("map",{constructor:qe,getProxy:Ft}),Et("array",{constructor:Je,getProxy:ke}),Et("set",{constructor:sn}),Et("collection",{constructor:on}),h.ArraySchema=Je,h.CollectionSchema=on,h.Context=jt,h.MapSchema=qe,h.Reflection=Hi,h.ReflectionField=fn,h.ReflectionType=ln,h.Schema=He,h.SchemaDefinition=Zt,h.SetSchema=sn,h.decode=Vn,h.defineTypes=yi,h.deprecated=gi,h.dumpChanges=Bi,h.encode=tn,h.filter=mi,h.filterChildren=vi,h.hasFilter=pi,h.registerType=Et,h.type=Qe,Object.defineProperty(h,"__esModule",{value:!0})})}),En=function(){function v(y,h){var b=this;this.onStateChange=Lt(),this.onError=Lt(),this.onLeave=Lt(),this.onJoin=Lt(),this.hasJoined=!1,this.onMessageHandlers=ii(),this.id=null,this.name=y,h&&(this.serializer=new(Tn("schema")),this.rootSchema=h,this.serializer.state=new h),this.onError(function(S,D){return console.warn("colyseus.js - onError => ("+S+") "+D)}),this.onLeave(function(){return b.removeAllListeners()})}return v.prototype.connect=function(y){var h=this;this.connection=new $n,this.connection.events.onmessage=this.onMessageCallback.bind(this),this.connection.events.onclose=function(b){if(!h.hasJoined){console.warn("Room connection was closed unexpectedly ("+b.code+"): "+b.reason),h.onError.invoke(b.code,b.reason);return}h.onLeave.invoke(b.code),h.destroy()},this.connection.events.onerror=function(b){console.warn("Room, onError ("+b.code+"): "+b.reason),h.onError.invoke(b.code,b.reason)},this.connection.connect(y)},v.prototype.leave=function(y){var h=this;return y===void 0&&(y=!0),new Promise(function(b){h.onLeave(function(S){return b(S)}),h.connection?y?h.connection.send([e.Protocol.LEAVE_ROOM]):h.connection.close():h.onLeave.invoke(4e3)})},v.prototype.onMessage=function(y,h){return this.onMessageHandlers.on(this.getMessageHandlerKey(y),h)},v.prototype.send=function(y,h){var b=[e.Protocol.ROOM_DATA];typeof y=="string"?it.encode.string(b,y):it.encode.number(b,y);var S;if(h!==void 0){var D=At(h);S=new Uint8Array(b.length+D.byteLength),S.set(new Uint8Array(b),0),S.set(new Uint8Array(D),b.length)}else S=new Uint8Array(b);this.connection.send(S.buffer)},Object.defineProperty(v.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:!1,configurable:!0}),v.prototype.removeAllListeners=function(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}},v.prototype.onMessageCallback=function(y){var h=Array.from(new Uint8Array(y.data)),b=h[0];if(b===e.Protocol.JOIN_ROOM){var S=1;if(this.serializerId=ni(h,S),S+=ri(this.serializerId),!this.serializer){var D=Tn(this.serializerId);this.serializer=new D}h.length>S&&this.serializer.handshake&&this.serializer.handshake(h,{offset:S}),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([e.Protocol.JOIN_ROOM])}else if(b===e.Protocol.ERROR){var z={offset:1},N=it.decode.number(h,z),F=it.decode.string(h,z);this.onError.invoke(N,F)}else if(b===e.Protocol.LEAVE_ROOM)this.leave();else if(b===e.Protocol.ROOM_DATA_SCHEMA){var L={offset:1},ae=this.serializer.getState().constructor._context,pe=ae.get(it.decode.number(h,L)),F=new pe;F.decode(h,L),this.dispatchMessage(pe,F)}else if(b===e.Protocol.ROOM_STATE)h.shift(),this.setState(h);else if(b===e.Protocol.ROOM_STATE_PATCH)h.shift(),this.patch(h);else if(b===e.Protocol.ROOM_DATA){var ke={offset:1},pe=it.decode.stringCheck(h,ke)?it.decode.string(h,ke):it.decode.number(h,ke),F=h.length>ke.offset?ue(y.data,ke.offset):void 0;this.dispatchMessage(pe,F)}},v.prototype.setState=function(y){this.serializer.setState(y),this.onStateChange.invoke(this.serializer.getState())},v.prototype.patch=function(y){this.serializer.patch(y),this.onStateChange.invoke(this.serializer.getState())},v.prototype.dispatchMessage=function(y,h){var b=this.getMessageHandlerKey(y);this.onMessageHandlers.events[b]?this.onMessageHandlers.emit(b,h):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",y,h):console.warn("colyseus.js: onMessage() not registered for type '"+y+"'.")},v.prototype.destroy=function(){this.serializer&&this.serializer.teardown()},v.prototype.getMessageHandlerKey=function(y){switch(typeof y){case"function":return"$"+y._typeid;case"string":return y;case"number":return"i"+y;default:throw new Error("invalid message type.")}},v}(),Xt;function Jt(){return Xt||(Xt=typeof cc!="undefined"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:typeof window!="undefined"&&window.localStorage?window.localStorage:{cache:{},setItem:function(v,y){this.cache[v]=y},getItem:function(v){this.cache[v]},removeItem:function(v){delete this.cache[v]}}),Xt}function fi(v,y){Jt().setItem(v,y)}function li(v){Jt().removeItem(v)}function ui(v,y){var h=Jt().getItem(v);typeof Promise=="undefined"||!(h instanceof Promise)?y(h):h.then(function(b){return y(b)})}var Yt="colyseus-auth-token";e.Platform=void 0,function(v){v.ios="ios",v.android="android"}(e.Platform||(e.Platform={}));var xn=function(){function v(y){var h=this;this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=y.replace("ws","http"),ui(Yt,function(b){return h.token=b})}return Object.defineProperty(v.prototype,"hasToken",{get:function(){return!!this.token},enumerable:!1,configurable:!0}),v.prototype.login=function(y){return y===void 0&&(y={}),s(this,void 0,void 0,function(){var h,b,S;return c(this,function(D){switch(D.label){case 0:return h=Object.assign({},y),this.hasToken&&(h.token=this.token),[4,this.request("post","/auth",h)];case 1:b=D.sent(),this.token=b.token,fi(Yt,this.token);for(S in b)this.hasOwnProperty(S)&&(this[S]=b[S]);return this.registerPingService(),[2,this]}})})},v.prototype.save=function(){return s(this,void 0,void 0,function(){return c(this,function(y){switch(y.label){case 0:return[4,this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone})];case 1:return y.sent(),[2,this]}})})},v.prototype.getFriends=function(){return s(this,void 0,void 0,function(){return c(this,function(y){switch(y.label){case 0:return[4,this.request("get","/friends/all")];case 1:return[2,y.sent()]}})})},v.prototype.getOnlineFriends=function(){return s(this,void 0,void 0,function(){return c(this,function(y){switch(y.label){case 0:return[4,this.request("get","/friends/online")];case 1:return[2,y.sent()]}})})},v.prototype.getFriendRequests=function(){return s(this,void 0,void 0,function(){return c(this,function(y){switch(y.label){case 0:return[4,this.request("get","/friends/requests")];case 1:return[2,y.sent()]}})})},v.prototype.sendFriendRequest=function(y){return s(this,void 0,void 0,function(){return c(this,function(h){switch(h.label){case 0:return[4,this.request("post","/friends/requests",{userId:y})];case 1:return[2,h.sent()]}})})},v.prototype.acceptFriendRequest=function(y){return s(this,void 0,void 0,function(){return c(this,function(h){switch(h.label){case 0:return[4,this.request("put","/friends/requests",{userId:y})];case 1:return[2,h.sent()]}})})},v.prototype.declineFriendRequest=function(y){return s(this,void 0,void 0,function(){return c(this,function(h){switch(h.label){case 0:return[4,this.request("del","/friends/requests",{userId:y})];case 1:return[2,h.sent()]}})})},v.prototype.blockUser=function(y){return s(this,void 0,void 0,function(){return c(this,function(h){switch(h.label){case 0:return[4,this.request("post","/friends/block",{userId:y})];case 1:return[2,h.sent()]}})})},v.prototype.unblockUser=function(y){return s(this,void 0,void 0,function(){return c(this,function(h){switch(h.label){case 0:return[4,this.request("put","/friends/block",{userId:y})];case 1:return[2,h.sent()]}})})},v.prototype.request=function(y,h,b,S,D){return b===void 0&&(b={}),D===void 0&&(D={}),s(this,void 0,void 0,function(){var z,N,F,L;return c(this,function(ae){switch(ae.label){case 0:D.Accept="application/json",this.hasToken&&(D.Authorization="Bearer "+this.token),z=[];for(N in b)z.push(N+"="+b[N]);return F=z.length>0?"?"+z.join("&"):"",L={headers:D},S&&(L.body=S),[4,Z[y](""+this.endpoint+h+F,L)];case 1:return[2,ae.sent().data]}})})},v.prototype.logout=function(){this.token=void 0,li(Yt),this.unregisterPingService()},v.prototype.registerPingService=function(y){var h=this;y===void 0&&(y=15e3),this.unregisterPingService(),this.keepOnlineInterval=setInterval(function(){return h.request("get","/auth")},y)},v.prototype.unregisterPingService=function(){clearInterval(this.keepOnlineInterval)},v}(),Kt,ci=function(v){i(y,v);function y(h,b){var S=v.call(this,h)||this;return S.code=b,Object.setPrototypeOf(S,y.prototype),S}return y}(Error),di=typeof window!="undefined"&&typeof((Kt=window==null?void 0:window.location)===null||Kt===void 0?void 0:Kt.hostname)!="undefined"?window.location.protocol.replace("http","ws")+"//"+window.location.hostname+(window.location.port&&":"+window.location.port):"ws://127.0.0.1:2567",hi=function(){function v(y){y===void 0&&(y=di),this.endpoint=y}return Object.defineProperty(v.prototype,"auth",{get:function(){return this._auth||(this._auth=new xn(this.endpoint)),this._auth},enumerable:!1,configurable:!0}),v.prototype.joinOrCreate=function(y,h,b){return h===void 0&&(h={}),s(this,void 0,void 0,function(){return c(this,function(S){switch(S.label){case 0:return[4,this.createMatchMakeRequest("joinOrCreate",y,h,b)];case 1:return[2,S.sent()]}})})},v.prototype.create=function(y,h,b){return h===void 0&&(h={}),s(this,void 0,void 0,function(){return c(this,function(S){switch(S.label){case 0:return[4,this.createMatchMakeRequest("create",y,h,b)];case 1:return[2,S.sent()]}})})},v.prototype.join=function(y,h,b){return h===void 0&&(h={}),s(this,void 0,void 0,function(){return c(this,function(S){switch(S.label){case 0:return[4,this.createMatchMakeRequest("join",y,h,b)];case 1:return[2,S.sent()]}})})},v.prototype.joinById=function(y,h,b){return h===void 0&&(h={}),s(this,void 0,void 0,function(){return c(this,function(S){switch(S.label){case 0:return[4,this.createMatchMakeRequest("joinById",y,h,b)];case 1:return[2,S.sent()]}})})},v.prototype.reconnect=function(y,h,b){return s(this,void 0,void 0,function(){return c(this,function(S){switch(S.label){case 0:return[4,this.createMatchMakeRequest("joinById",y,{sessionId:h},b)];case 1:return[2,S.sent()]}})})},v.prototype.getAvailableRooms=function(y){return y===void 0&&(y=""),s(this,void 0,void 0,function(){var h;return c(this,function(b){switch(b.label){case 0:return h=this.endpoint.replace("ws","http")+"/matchmake/"+y,[4,T(h,{headers:{Accept:"application/json"}})];case 1:return[2,b.sent().data]}})})},v.prototype.consumeSeatReservation=function(y,h){return s(this,void 0,void 0,function(){var b;return c(this,function(S){return b=this.createRoom(y.room.name,h),b.id=y.room.roomId,b.sessionId=y.sessionId,b.connect(this.buildEndpoint(y.room,{sessionId:b.sessionId})),[2,new Promise(function(D,z){var N=function(F,L){return z(new ne(F,L))};b.onError.once(N),b.onJoin.once(function(){b.onError.remove(N),D(b)})})]})})},v.prototype.createMatchMakeRequest=function(y,h,b,S){return b===void 0&&(b={}),s(this,void 0,void 0,function(){var D,z;return c(this,function(N){switch(N.label){case 0:return D=this.endpoint.replace("ws","http")+"/matchmake/"+y+"/"+h,this._auth&&this._auth.hasToken&&(b.token=this._auth.token),[4,w(D,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(b)})];case 1:if(z=N.sent().data,z.error)throw new ci(z.error,z.code);return[2,this.consumeSeatReservation(z,S)]}})})},v.prototype.createRoom=function(y,h){return new En(y,h)},v.prototype.buildEndpoint=function(y,h){h===void 0&&(h={});var b=[];for(var S in h)!h.hasOwnProperty(S)||b.push(S+"="+h[S]);return this.endpoint+"/"+y.processId+"/"+y.roomId+"?"+b.join("&")},v}(),kn=function(){function v(){}return v.prototype.setState=function(y){this.state.decode(y)},v.prototype.getState=function(){return this.state},v.prototype.patch=function(y){this.state.decode(y)},v.prototype.teardown=function(){var y,h;(h=(y=this.state)===null||y===void 0?void 0:y.$changes)===null||h===void 0||h.root.clearRefs()},v.prototype.handshake=function(y,h){if(this.state){var b=new it.Reflection;b.decode(y,h)}else this.state=it.Reflection.decode(y,h)},v}(),_i=function(){function v(){}return v.prototype.setState=function(y){},v.prototype.getState=function(){return null},v.prototype.patch=function(y){},v.prototype.teardown=function(){},v.prototype.handshake=function(y){},v}();Wt("schema",kn),Wt("none",_i),e.Auth=xn,e.Client=hi,e.Room=En,e.SchemaSerializer=kn,e.registerSerializer=Wt,Object.defineProperty(e,"__esModule",{value:!0})})})(mn,mn.exports);const Pe=ot({uuid:"",sessionId:"",name:"",profile:{}}),Ee=ot({}),An=ot([]),Yr=ot(!1),ta=ot(0),na=ot(0),ra="wss://open.eyebeam.dev";let bn={},Kr={},Zr={},Qr={},ei={};const ia=new mn.exports.Client(ra),oa=f=>new Promise((n,e)=>{ia.joinOrCreate("game",f).then(t=>{t.state.players.onRemove=(i,s)=>{Ee.update(c=>(delete c[i.uuid],c))},t.state.players.onAdd=(i,s)=>{Ee.update(c=>(c[i.uuid]={name:i.name,x:i.x,y:i.y,room:i.room,npc:i.npc,inTransit:!1,self:i.uuid===he(Pe).uuid},c)),i.uuid===he(Pe).uuid&&Pe.update(c=>(c.sessionId=s,c.name=i.name,c)),i.onChange=c=>{he(Ee)[i.uuid].room!==i.room?(Ee.update(d=>(d[i.uuid].name=i.name,d[i.uuid].shape=i.shape,d[i.uuid].room=i.room,d[i.uuid].inTransit=!0,d[i.uuid].viewing=i.viewing,d)),setTimeout(()=>{Ee.update(d=>(d[i.uuid].inTransit=!1,d))},1e3)):Ee.update(d=>(d[i.uuid].name=i.name,d[i.uuid].shape=i.shape,d[i.uuid].viewing=i.viewing,d)),!(i.uuid===he(Pe).uuid&&i.path.keyboardNavigation)&&Ee.update(d=>(d[i.uuid].x=i.x,d[i.uuid].y=i.y,d))}},t.onMessage("banned",i=>{}),bn=(i,s,c)=>{Yr.set(!1),c?t.send("go",{x:i,y:s,keyboardNavigation:!0}):t.send("go",{x:i,y:s,originX:he(Ee)[he(Pe).uuid].x,originY:he(Ee)[he(Pe).uuid].y,keyboardNavigation:!1})},Kr=i=>{t.send("changeRoom",{id:i.id,x:i.x,y:i.y})},Zr=i=>{t.send("enterArticle",{id:i._id})},Qr=()=>{t.send("leaveArticle")},t.state.messages.onAdd=i=>{An.update(s=>(s.push(i),s))},ei=(i,s)=>{try{t.send("submitChatMessage",{msgId:qr(),uuid:he(Pe).uuid,name:he(Ee)[he(Pe).uuid].name,text:i.detail.text,room:s._id})}catch(c){console.dir(c)}},t.onLeave(i=>{const s="Disconnected from server. Code: "+i;console.log(s)}),t.onError((i,s)=>{console.error("Gameserver error:",s)}),n()}).catch(t=>{console.dir(t),t.code==4215,e(t)})});function sa(f){let n,e,t,i,s,c,d;return{c(){n=U("div"),e=U("img"),this.h()},l(p){n=V(p,"DIV",{class:!0,id:!0,alt:!0,style:!0});var g=G(n);e=V(g,"IMG",{src:!0,class:!0}),g.forEach(R),this.h()},h(){xe(e.src,t=f[6]&&f[6].imageUrl?f[6].imageUrl:pn(f[1]).imageUrl)||k(e,"src",t),k(e,"class","svelte-zqf5vo"),k(n,"class","avatar svelte-zqf5vo"),k(n,"id",f[2]),k(n,"alt",i=f[0].name),k(n,"style",s="transform: translateY("+f[4]+"px) translateX("+f[5]+"px)"),Ve(n,"self",f[0].self)},m(p,g){j(p,n,g),Y(n,e),f[8](n),d=!0},p(p,[g]){(!d||g&2&&!xe(e.src,t=p[6]&&p[6].imageUrl?p[6].imageUrl:pn(p[1]).imageUrl))&&k(e,"src",t),(!d||g&4)&&k(n,"id",p[2]),(!d||g&1&&i!==(i=p[0].name))&&k(n,"alt",i),(!d||g&48&&s!==(s="transform: translateY("+p[4]+"px) translateX("+p[5]+"px)"))&&k(n,"style",s),g&1&&Ve(n,"self",p[0].self)},i(p){d||(nt(()=>{c||(c=je(n,Xn,{},!0)),c.run(1)}),d=!0)},o(p){c||(c=je(n,Xn,{},!1)),c.run(0),d=!1},d(p){p&&R(n),f[8](null),p&&c&&c.end()}}}function aa(f,n,e){let t;Oe(f,An,T=>e(7,t=T));let i={},s={};const c=T=>{i.popper&&(i.hide(),i.destroy(),clearTimeout(s)),I&&I.nodeName&&(i=tippy(I,{content:T.text,arrow:!1,offset:[0,5],sticky:!0,animation:"fade",inertia:!0,theme:"chat",popperOptions:{modifiers:[{name:"flip",enabled:!1},{name:"preventOverflow",enabled:!1}]}}),i.show(),s=setTimeout(()=>{i.hide(),setTimeout(()=>{i.destroy()},500)},4e3))};let{player:d={}}=n,{avatars:p=[]}=n,{key:g=""}=n,I={},r=p.find(T=>T._id===d.shape),a=d.y*ye,_=d.x*ye;gt(async()=>{d.self||tippy(I,{content:d.name,arrow:!1,offset:[0,5],theme:"name",hideOnClick:!1,placement:"bottom",popperOptions:{modifiers:[{name:"flip",enabled:!1},{name:"preventOverflow",enabled:!1}]}})});function A(T){Tt[T?"unshift":"push"](()=>{I=T,e(3,I)})}return f.$$set=T=>{"player"in T&&e(0,d=T.player),"avatars"in T&&e(1,p=T.avatars),"key"in T&&e(2,g=T.key)},f.$$.update=()=>{if(f.$$.dirty&132){let T=t[t.length-1];T&&T.uuid==g&&Date.now()-T.timestamp<5e3&&c(T)}f.$$.dirty&1&&(e(4,a=d.y*ye),e(5,_=d.x*ye))},[d,p,g,I,a,_,r,t,A]}class fa extends Se{constructor(n){super(),Re(this,n,aa,sa,De,{player:0,avatars:1,key:2})}}function ir(f,n,e){const t=f.slice();return t[3]=n[e][0],t[4]=n[e][1],t}function or(f){let n,e;return n=new fa({props:{player:f[4],key:f[3],avatars:f[2]}}),{c(){be(n.$$.fragment)},l(t){$e(n.$$.fragment,t)},m(t,i){Ie(n,t,i),e=!0},p(t,i){const s={};i&1&&(s.player=t[4]),i&1&&(s.key=t[3]),i&4&&(s.avatars=t[2]),n.$set(s)},i(t){e||(C(n.$$.fragment,t),e=!0)},o(t){H(n.$$.fragment,t),e=!1},d(t){Te(n,t)}}}function sr(f,n){let e,t,i,s=n[4].room===n[1]&&!n[4].inTransit&&or(n);return{key:f,first:null,c(){e=le(),s&&s.c(),t=le(),this.h()},l(c){e=le(),s&&s.l(c),t=le(),this.h()},h(){this.first=e},m(c,d){j(c,e,d),s&&s.m(c,d),j(c,t,d),i=!0},p(c,d){n=c,n[4].room===n[1]&&!n[4].inTransit?s?(s.p(n,d),d&3&&C(s,1)):(s=or(n),s.c(),C(s,1),s.m(t.parentNode,t)):s&&(we(),H(s,1,1,()=>{s=null}),Ae())},i(c){i||(C(s),i=!0)},o(c){H(s),i=!1},d(c){c&&R(e),s&&s.d(c),c&&R(t)}}}function la(f){let n=[],e=new Map,t,i,s=Object.entries(f[0]);const c=d=>d[3];for(let d=0;d<s.length;d+=1){let p=ir(f,s,d),g=c(p);e.set(g,n[d]=sr(g,p))}return{c(){for(let d=0;d<n.length;d+=1)n[d].c();t=le()},l(d){for(let p=0;p<n.length;p+=1)n[p].l(d);t=le()},m(d,p){for(let g=0;g<n.length;g+=1)n[g].m(d,p);j(d,t,p),i=!0},p(d,[p]){p&7&&(s=Object.entries(d[0]),we(),n=Gt(n,p,c,1,d,s,e,t.parentNode,zt,sr,t,ir),Ae())},i(d){if(!i){for(let p=0;p<s.length;p+=1)C(n[p]);i=!0}},o(d){for(let p=0;p<n.length;p+=1)H(n[p]);i=!1},d(d){for(let p=0;p<n.length;p+=1)n[p].d(d);d&&R(t)}}}function ua(f,n,e){let{players:t={}}=n,{currentRoomId:i=""}=n,{avatars:s=[]}=n;return f.$$set=c=>{"players"in c&&e(0,t=c.players),"currentRoomId"in c&&e(1,i=c.currentRoomId),"avatars"in c&&e(2,s=c.avatars)},[t,i,s]}class ca extends Se{constructor(n){super(),Re(this,n,ua,la,De,{players:0,currentRoomId:1,avatars:2})}}function ar(f){let n,e;return{c(){n=U("img"),this.h()},l(t){n=V(t,"IMG",{src:!0,class:!0}),this.h()},h(){xe(n.src,e=ct(f[0].iconImage).quality(100).height(300).url())||k(n,"src",e),k(n,"class","svelte-1qmh4za")},m(t,i){j(t,n,i)},p(t,i){i&1&&!xe(n.src,e=ct(t[0].iconImage).quality(100).height(300).url())&&k(n,"src",e)},d(t){t&&R(n)}}}function da(f){let n,e,t,i,s,c,d,p=f[0].iconImage&&ar(f);return{c(){n=U("div"),p&&p.c(),this.h()},l(g){n=V(g,"DIV",{class:!0,id:!0,alt:!0,style:!0});var I=G(n);p&&p.l(I),I.forEach(R),this.h()},h(){k(n,"class","object svelte-1qmh4za"),k(n,"id",e=f[0]._id),k(n,"alt",t=f[0].title),k(n,"style",f[2]),Ve(n,"static",f[0].static),Ve(n,"image",f[0].iconImage)},m(g,I){j(g,n,I),p&&p.m(n,null),f[5](n),s=!0,c||(d=tt(n,"click",f[6]),c=!0)},p(g,[I]){g[0].iconImage?p?p.p(g,I):(p=ar(g),p.c(),p.m(n,null)):p&&(p.d(1),p=null),(!s||I&1&&e!==(e=g[0]._id))&&k(n,"id",e),(!s||I&1&&t!==(t=g[0].title))&&k(n,"alt",t),I&1&&Ve(n,"static",g[0].static),I&1&&Ve(n,"image",g[0].iconImage)},i(g){s||(nt(()=>{i||(i=je(n,Le,{},!0)),i.run(1)}),s=!0)},o(g){i||(i=je(n,Le,{},!1)),i.run(0),s=!1},d(g){g&&R(n),p&&p.d(),f[5](null),g&&i&&i.end(),c=!1,d()}}}function ha(f,n,e){let t;Oe(f,Pt,A=>e(4,t=A));let{object:i={}}=n,s={},c={},d=i.y*ye,p=i.x*ye,g=Ce(i,"dimensions.width",1)*ye,I=Ce(i,"dimensions.height",1)*ye;const r=`transform: translateY(${d}px) translateX(${p}px); width: ${g}px; height: ${I}px;`;gt(async()=>{e(3,c=tippy(s,{content:i.title,arrow:!1,offset:[0,5],theme:i.static?"static":"name",hideOnClick:!1,sticky:!0,trigger:"manual",flip:!1,placement:"bottom",popperOptions:{modifiers:[{name:"flip",enabled:!1},{name:"preventOverflow",enabled:!1}]}}))});function a(A){Tt[A?"unshift":"push"](()=>{s=A,e(1,s)})}const _=()=>{yn.set(i)};return f.$$set=A=>{"object"in A&&e(0,i=A.object)},f.$$.update=()=>{f.$$.dirty&24&&c.popper&&(t?c.show():c.hide())},[i,s,r,c,t,a,_]}class _a extends Se{constructor(n){super(),Re(this,n,ha,da,De,{object:0})}}function fr(f,n,e){const t=f.slice();return t[1]=n[e],t}function lr(f,n){let e,t,i;return t=new _a({props:{object:n[1]}}),{key:f,first:null,c(){e=le(),be(t.$$.fragment),this.h()},l(s){e=le(),$e(t.$$.fragment,s),this.h()},h(){this.first=e},m(s,c){j(s,e,c),Ie(t,s,c),i=!0},p(s,c){n=s;const d={};c&1&&(d.object=n[1]),t.$set(d)},i(s){i||(C(t.$$.fragment,s),i=!0)},o(s){H(t.$$.fragment,s),i=!1},d(s){s&&R(e),Te(t,s)}}}function pa(f){let n=[],e=new Map,t,i,s=f[0];const c=d=>d[1]._id;for(let d=0;d<s.length;d+=1){let p=fr(f,s,d),g=c(p);e.set(g,n[d]=lr(g,p))}return{c(){for(let d=0;d<n.length;d+=1)n[d].c();t=le()},l(d){for(let p=0;p<n.length;p+=1)n[p].l(d);t=le()},m(d,p){for(let g=0;g<n.length;g+=1)n[g].m(d,p);j(d,t,p),i=!0},p(d,[p]){p&1&&(s=d[0],we(),n=Gt(n,p,c,1,d,s,e,t.parentNode,zt,lr,t,fr),Ae())},i(d){if(!i){for(let p=0;p<s.length;p+=1)C(n[p]);i=!0}},o(d){for(let p=0;p<n.length;p+=1)H(n[p]);i=!1},d(d){for(let p=0;p<n.length;p+=1)n[p].d(d);d&&R(t)}}}function ma(f,n,e){let{objects:t={}}=n;return f.$$set=i=>{"objects"in i&&e(0,t=i.objects)},[t]}class va extends Se{constructor(n){super(),Re(this,n,ma,pa,De,{objects:0})}}function ur(f){let n,e;return{c(){n=U("img"),this.h()},l(t){n=V(t,"IMG",{src:!0}),this.h()},h(){xe(n.src,e=ct(f[0].backgroundImage).quality(100).url())||k(n,"src",e)},m(t,i){j(t,n,i)},p(t,i){i&1&&!xe(n.src,e=ct(t[0].backgroundImage).quality(100).url())&&k(n,"src",e)},d(t){t&&R(n)}}}function ga(f){let n,e,t,i,s,c=f[0].backgroundImage&&ur(f);return{c(){n=U("div"),c&&c.c(),this.h()},l(d){n=V(d,"DIV",{class:!0,id:!0,alt:!0,style:!0});var p=G(n);c&&c.l(p),p.forEach(R),this.h()},h(){k(n,"class","zone svelte-1sqo6n0"),k(n,"id",e=f[0]._id),k(n,"alt",t=f[0].title),k(n,"style",f[2])},m(d,p){j(d,n,p),c&&c.m(n,null),f[5](n),s=!0},p(d,[p]){d[0].backgroundImage?c?c.p(d,p):(c=ur(d),c.c(),c.m(n,null)):c&&(c.d(1),c=null),(!s||p&1&&e!==(e=d[0]._id))&&k(n,"id",e),(!s||p&1&&t!==(t=d[0].title))&&k(n,"alt",t)},i(d){s||(nt(()=>{i||(i=je(n,Le,{},!0)),i.run(1)}),s=!0)},o(d){i||(i=je(n,Le,{},!1)),i.run(0),s=!1},d(d){d&&R(n),c&&c.d(),f[5](null),d&&i&&i.end()}}}function ya(f,n,e){let t;Oe(f,Pt,_=>e(4,t=_));let{zone:i={}}=n,s={},c={},d=i.y*ye,p=i.x*ye,g=Ce(i,"dimensions.width",1)*ye,I=Ce(i,"dimensions.height",1)*ye;const r=`transform: translateY(${d}px) translateX(${p}px); width: ${g}px; height: ${I}px;};`;gt(async()=>{e(3,c=tippy(s,{content:i.title,arrow:!1,offset:[0,5],theme:"name",hideOnClick:!1,sticky:!0,trigger:"manual",flip:!1,placement:"bottom",popperOptions:{modifiers:[{name:"flip",enabled:!1},{name:"preventOverflow",enabled:!1}]}}))});function a(_){Tt[_?"unshift":"push"](()=>{s=_,e(1,s)})}return f.$$set=_=>{"zone"in _&&e(0,i=_.zone)},f.$$.update=()=>{f.$$.dirty&24&&c.popper&&(t?c.show():c.hide())},[i,s,r,c,t,a]}class wa extends Se{constructor(n){super(),Re(this,n,ya,ga,De,{zone:0})}}function cr(f,n,e){const t=f.slice();return t[1]=n[e],t}function dr(f,n){let e,t,i;return t=new wa({props:{zone:n[1]}}),{key:f,first:null,c(){e=le(),be(t.$$.fragment),this.h()},l(s){e=le(),$e(t.$$.fragment,s),this.h()},h(){this.first=e},m(s,c){j(s,e,c),Ie(t,s,c),i=!0},p(s,c){n=s;const d={};c&1&&(d.zone=n[1]),t.$set(d)},i(s){i||(C(t.$$.fragment,s),i=!0)},o(s){H(t.$$.fragment,s),i=!1},d(s){s&&R(e),Te(t,s)}}}function Aa(f){let n=[],e=new Map,t,i,s=f[0];const c=d=>d[1]._id;for(let d=0;d<s.length;d+=1){let p=cr(f,s,d),g=c(p);e.set(g,n[d]=dr(g,p))}return{c(){for(let d=0;d<n.length;d+=1)n[d].c();t=le()},l(d){for(let p=0;p<n.length;p+=1)n[p].l(d);t=le()},m(d,p){for(let g=0;g<n.length;g+=1)n[g].m(d,p);j(d,t,p),i=!0},p(d,[p]){p&1&&(s=d[0],we(),n=Gt(n,p,c,1,d,s,e,t.parentNode,zt,dr,t,cr),Ae())},i(d){if(!i){for(let p=0;p<s.length;p+=1)C(n[p]);i=!0}},o(d){for(let p=0;p<n.length;p+=1)H(n[p]);i=!1},d(d){for(let p=0;p<n.length;p+=1)n[p].d(d);d&&R(t)}}}function ba(f,n,e){let{zones:t={}}=n;return f.$$set=i=>{"zones"in i&&e(0,t=i.zones)},[t]}class $a extends Se{constructor(n){super(),Re(this,n,ba,Aa,De,{zones:0})}}var ti={};/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(f){(function(){var n=function(){this.init()};n.prototype={init:function(){var r=this||e;return r._counter=1e3,r._html5AudioPool=[],r.html5PoolSize=10,r._codecs={},r._howls=[],r._muted=!1,r._volume=1,r._canPlayEvent="canplaythrough",r._navigator=typeof window!="undefined"&&window.navigator?window.navigator:null,r.masterGain=null,r.noAudio=!1,r.usingWebAudio=!0,r.autoSuspend=!0,r.ctx=null,r.autoUnlock=!0,r._setup(),r},volume:function(r){var a=this||e;if(r=parseFloat(r),a.ctx||I(),typeof r!="undefined"&&r>=0&&r<=1){if(a._volume=r,a._muted)return a;a.usingWebAudio&&a.masterGain.gain.setValueAtTime(r,e.ctx.currentTime);for(var _=0;_<a._howls.length;_++)if(!a._howls[_]._webAudio)for(var A=a._howls[_]._getSoundIds(),T=0;T<A.length;T++){var $=a._howls[_]._soundById(A[T]);$&&$._node&&($._node.volume=$._volume*r)}return a}return a._volume},mute:function(r){var a=this||e;a.ctx||I(),a._muted=r,a.usingWebAudio&&a.masterGain.gain.setValueAtTime(r?0:a._volume,e.ctx.currentTime);for(var _=0;_<a._howls.length;_++)if(!a._howls[_]._webAudio)for(var A=a._howls[_]._getSoundIds(),T=0;T<A.length;T++){var $=a._howls[_]._soundById(A[T]);$&&$._node&&($._node.muted=r?!0:$._muted)}return a},stop:function(){for(var r=this||e,a=0;a<r._howls.length;a++)r._howls[a].stop();return r},unload:function(){for(var r=this||e,a=r._howls.length-1;a>=0;a--)r._howls[a].unload();return r.usingWebAudio&&r.ctx&&typeof r.ctx.close!="undefined"&&(r.ctx.close(),r.ctx=null,I()),r},codecs:function(r){return(this||e)._codecs[r.replace(/^x-/,"")]},_setup:function(){var r=this||e;if(r.state=r.ctx&&r.ctx.state||"suspended",r._autoSuspend(),!r.usingWebAudio)if(typeof Audio!="undefined")try{var a=new Audio;typeof a.oncanplaythrough=="undefined"&&(r._canPlayEvent="canplay")}catch{r.noAudio=!0}else r.noAudio=!0;try{var a=new Audio;a.muted&&(r.noAudio=!0)}catch{}return r.noAudio||r._setupCodecs(),r},_setupCodecs:function(){var r=this||e,a=null;try{a=typeof Audio!="undefined"?new Audio:null}catch{return r}if(!a||typeof a.canPlayType!="function")return r;var _=a.canPlayType("audio/mpeg;").replace(/^no$/,""),A=r._navigator?r._navigator.userAgent:"",T=A.match(/OPR\/([0-6].)/g),$=T&&parseInt(T[0].split("/")[1],10)<33,w=A.indexOf("Safari")!==-1&&A.indexOf("Chrome")===-1,x=A.match(/Version\/(.*?) /),O=w&&x&&parseInt(x[1],10)<15;return r._codecs={mp3:!!(!$&&(_||a.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!_,opus:!!a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(a.canPlayType('audio/wav; codecs="1"')||a.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!a.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!a.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(a.canPlayType("audio/x-m4b;")||a.canPlayType("audio/m4b;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(a.canPlayType("audio/x-mp4;")||a.canPlayType("audio/mp4;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!O&&a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!O&&a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!a.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(a.canPlayType("audio/x-flac;")||a.canPlayType("audio/flac;")).replace(/^no$/,"")},r},_unlockAudio:function(){var r=this||e;if(!(r._audioUnlocked||!r.ctx)){r._audioUnlocked=!1,r.autoUnlock=!1,!r._mobileUnloaded&&r.ctx.sampleRate!==44100&&(r._mobileUnloaded=!0,r.unload()),r._scratchBuffer=r.ctx.createBuffer(1,1,22050);var a=function(_){for(;r._html5AudioPool.length<r.html5PoolSize;)try{var A=new Audio;A._unlocked=!0,r._releaseHtml5Audio(A)}catch{r.noAudio=!0;break}for(var T=0;T<r._howls.length;T++)if(!r._howls[T]._webAudio)for(var $=r._howls[T]._getSoundIds(),w=0;w<$.length;w++){var x=r._howls[T]._soundById($[w]);x&&x._node&&!x._node._unlocked&&(x._node._unlocked=!0,x._node.load())}r._autoResume();var O=r.ctx.createBufferSource();O.buffer=r._scratchBuffer,O.connect(r.ctx.destination),typeof O.start=="undefined"?O.noteOn(0):O.start(0),typeof r.ctx.resume=="function"&&r.ctx.resume(),O.onended=function(){O.disconnect(0),r._audioUnlocked=!0,document.removeEventListener("touchstart",a,!0),document.removeEventListener("touchend",a,!0),document.removeEventListener("click",a,!0),document.removeEventListener("keydown",a,!0);for(var P=0;P<r._howls.length;P++)r._howls[P]._emit("unlock")}};return document.addEventListener("touchstart",a,!0),document.addEventListener("touchend",a,!0),document.addEventListener("click",a,!0),document.addEventListener("keydown",a,!0),r}},_obtainHtml5Audio:function(){var r=this||e;if(r._html5AudioPool.length)return r._html5AudioPool.pop();var a=new Audio().play();return a&&typeof Promise!="undefined"&&(a instanceof Promise||typeof a.then=="function")&&a.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(r){var a=this||e;return r._unlocked&&a._html5AudioPool.push(r),a},_autoSuspend:function(){var r=this;if(!(!r.autoSuspend||!r.ctx||typeof r.ctx.suspend=="undefined"||!e.usingWebAudio)){for(var a=0;a<r._howls.length;a++)if(r._howls[a]._webAudio){for(var _=0;_<r._howls[a]._sounds.length;_++)if(!r._howls[a]._sounds[_]._paused)return r}return r._suspendTimer&&clearTimeout(r._suspendTimer),r._suspendTimer=setTimeout(function(){if(!!r.autoSuspend){r._suspendTimer=null,r.state="suspending";var A=function(){r.state="suspended",r._resumeAfterSuspend&&(delete r._resumeAfterSuspend,r._autoResume())};r.ctx.suspend().then(A,A)}},3e4),r}},_autoResume:function(){var r=this;if(!(!r.ctx||typeof r.ctx.resume=="undefined"||!e.usingWebAudio))return r.state==="running"&&r.ctx.state!=="interrupted"&&r._suspendTimer?(clearTimeout(r._suspendTimer),r._suspendTimer=null):r.state==="suspended"||r.state==="running"&&r.ctx.state==="interrupted"?(r.ctx.resume().then(function(){r.state="running";for(var a=0;a<r._howls.length;a++)r._howls[a]._emit("resume")}),r._suspendTimer&&(clearTimeout(r._suspendTimer),r._suspendTimer=null)):r.state==="suspending"&&(r._resumeAfterSuspend=!0),r}};var e=new n,t=function(r){var a=this;if(!r.src||r.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}a.init(r)};t.prototype={init:function(r){var a=this;return e.ctx||I(),a._autoplay=r.autoplay||!1,a._format=typeof r.format!="string"?r.format:[r.format],a._html5=r.html5||!1,a._muted=r.mute||!1,a._loop=r.loop||!1,a._pool=r.pool||5,a._preload=typeof r.preload=="boolean"||r.preload==="metadata"?r.preload:!0,a._rate=r.rate||1,a._sprite=r.sprite||{},a._src=typeof r.src!="string"?r.src:[r.src],a._volume=r.volume!==void 0?r.volume:1,a._xhr={method:r.xhr&&r.xhr.method?r.xhr.method:"GET",headers:r.xhr&&r.xhr.headers?r.xhr.headers:null,withCredentials:r.xhr&&r.xhr.withCredentials?r.xhr.withCredentials:!1},a._duration=0,a._state="unloaded",a._sounds=[],a._endTimers={},a._queue=[],a._playLock=!1,a._onend=r.onend?[{fn:r.onend}]:[],a._onfade=r.onfade?[{fn:r.onfade}]:[],a._onload=r.onload?[{fn:r.onload}]:[],a._onloaderror=r.onloaderror?[{fn:r.onloaderror}]:[],a._onplayerror=r.onplayerror?[{fn:r.onplayerror}]:[],a._onpause=r.onpause?[{fn:r.onpause}]:[],a._onplay=r.onplay?[{fn:r.onplay}]:[],a._onstop=r.onstop?[{fn:r.onstop}]:[],a._onmute=r.onmute?[{fn:r.onmute}]:[],a._onvolume=r.onvolume?[{fn:r.onvolume}]:[],a._onrate=r.onrate?[{fn:r.onrate}]:[],a._onseek=r.onseek?[{fn:r.onseek}]:[],a._onunlock=r.onunlock?[{fn:r.onunlock}]:[],a._onresume=[],a._webAudio=e.usingWebAudio&&!a._html5,typeof e.ctx!="undefined"&&e.ctx&&e.autoUnlock&&e._unlockAudio(),e._howls.push(a),a._autoplay&&a._queue.push({event:"play",action:function(){a.play()}}),a._preload&&a._preload!=="none"&&a.load(),a},load:function(){var r=this,a=null;if(e.noAudio){r._emit("loaderror",null,"No audio support.");return}typeof r._src=="string"&&(r._src=[r._src]);for(var _=0;_<r._src.length;_++){var A,T;if(r._format&&r._format[_])A=r._format[_];else{if(T=r._src[_],typeof T!="string"){r._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}A=/^data:audio\/([^;,]+);/i.exec(T),A||(A=/\.([^.]+)$/.exec(T.split("?",1)[0])),A&&(A=A[1].toLowerCase())}if(A||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),A&&e.codecs(A)){a=r._src[_];break}}if(!a){r._emit("loaderror",null,"No codec support for selected audio sources.");return}return r._src=a,r._state="loading",window.location.protocol==="https:"&&a.slice(0,5)==="http:"&&(r._html5=!0,r._webAudio=!1),new i(r),r._webAudio&&c(r),r},play:function(r,a){var _=this,A=null;if(typeof r=="number")A=r,r=null;else{if(typeof r=="string"&&_._state==="loaded"&&!_._sprite[r])return null;if(typeof r=="undefined"&&(r="__default",!_._playLock)){for(var T=0,$=0;$<_._sounds.length;$++)_._sounds[$]._paused&&!_._sounds[$]._ended&&(T++,A=_._sounds[$]._id);T===1?r=null:A=null}}var w=A?_._soundById(A):_._inactiveSound();if(!w)return null;if(A&&!r&&(r=w._sprite||"__default"),_._state!=="loaded"){w._sprite=r,w._ended=!1;var x=w._id;return _._queue.push({event:"play",action:function(){_.play(x)}}),x}if(A&&!w._paused)return a||_._loadQueue("play"),w._id;_._webAudio&&e._autoResume();var O=Math.max(0,w._seek>0?w._seek:_._sprite[r][0]/1e3),P=Math.max(0,(_._sprite[r][0]+_._sprite[r][1])/1e3-O),Z=P*1e3/Math.abs(w._rate),ne=_._sprite[r][0]/1e3,de=(_._sprite[r][0]+_._sprite[r][1])/1e3;w._sprite=r,w._ended=!1;var Be=function(){w._paused=!1,w._seek=O,w._start=ne,w._stop=de,w._loop=!!(w._loop||_._sprite[r][2])};if(O>=de){_._ended(w);return}var ue=w._node;if(_._webAudio){var yt=function(){_._playLock=!1,Be(),_._refreshBuffer(w);var rt=w._muted||_._muted?0:w._volume;ue.gain.setValueAtTime(rt,e.ctx.currentTime),w._playStart=e.ctx.currentTime,typeof ue.bufferSource.start=="undefined"?w._loop?ue.bufferSource.noteGrainOn(0,O,86400):ue.bufferSource.noteGrainOn(0,O,P):w._loop?ue.bufferSource.start(0,O,86400):ue.bufferSource.start(0,O,P),Z!==1/0&&(_._endTimers[w._id]=setTimeout(_._ended.bind(_,w),Z)),a||setTimeout(function(){_._emit("play",w._id),_._loadQueue()},0)};e.state==="running"&&e.ctx.state!=="interrupted"?yt():(_._playLock=!0,_.once("resume",yt),_._clearTimer(w._id))}else{var wt=function(){ue.currentTime=O,ue.muted=w._muted||_._muted||e._muted||ue.muted,ue.volume=w._volume*e.volume(),ue.playbackRate=w._rate;try{var rt=ue.play();if(rt&&typeof Promise!="undefined"&&(rt instanceof Promise||typeof rt.then=="function")?(_._playLock=!0,Be(),rt.then(function(){_._playLock=!1,ue._unlocked=!0,a?_._loadQueue():_._emit("play",w._id)}).catch(function(){_._playLock=!1,_._emit("playerror",w._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),w._ended=!0,w._paused=!0})):a||(_._playLock=!1,Be(),_._emit("play",w._id)),ue.playbackRate=w._rate,ue.paused){_._emit("playerror",w._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}r!=="__default"||w._loop?_._endTimers[w._id]=setTimeout(_._ended.bind(_,w),Z):(_._endTimers[w._id]=function(){_._ended(w),ue.removeEventListener("ended",_._endTimers[w._id],!1)},ue.addEventListener("ended",_._endTimers[w._id],!1))}catch(W){_._emit("playerror",w._id,W)}};ue.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(ue.src=_._src,ue.load());var st=window&&window.ejecta||!ue.readyState&&e._navigator.isCocoonJS;if(ue.readyState>=3||st)wt();else{_._playLock=!0,_._state="loading";var At=function(){_._state="loaded",wt(),ue.removeEventListener(e._canPlayEvent,At,!1)};ue.addEventListener(e._canPlayEvent,At,!1),_._clearTimer(w._id)}}return w._id},pause:function(r){var a=this;if(a._state!=="loaded"||a._playLock)return a._queue.push({event:"pause",action:function(){a.pause(r)}}),a;for(var _=a._getSoundIds(r),A=0;A<_.length;A++){a._clearTimer(_[A]);var T=a._soundById(_[A]);if(T&&!T._paused&&(T._seek=a.seek(_[A]),T._rateSeek=0,T._paused=!0,a._stopFade(_[A]),T._node))if(a._webAudio){if(!T._node.bufferSource)continue;typeof T._node.bufferSource.stop=="undefined"?T._node.bufferSource.noteOff(0):T._node.bufferSource.stop(0),a._cleanBuffer(T._node)}else(!isNaN(T._node.duration)||T._node.duration===1/0)&&T._node.pause();arguments[1]||a._emit("pause",T?T._id:null)}return a},stop:function(r,a){var _=this;if(_._state!=="loaded"||_._playLock)return _._queue.push({event:"stop",action:function(){_.stop(r)}}),_;for(var A=_._getSoundIds(r),T=0;T<A.length;T++){_._clearTimer(A[T]);var $=_._soundById(A[T]);$&&($._seek=$._start||0,$._rateSeek=0,$._paused=!0,$._ended=!0,_._stopFade(A[T]),$._node&&(_._webAudio?$._node.bufferSource&&(typeof $._node.bufferSource.stop=="undefined"?$._node.bufferSource.noteOff(0):$._node.bufferSource.stop(0),_._cleanBuffer($._node)):(!isNaN($._node.duration)||$._node.duration===1/0)&&($._node.currentTime=$._start||0,$._node.pause(),$._node.duration===1/0&&_._clearSound($._node))),a||_._emit("stop",$._id))}return _},mute:function(r,a){var _=this;if(_._state!=="loaded"||_._playLock)return _._queue.push({event:"mute",action:function(){_.mute(r,a)}}),_;if(typeof a=="undefined")if(typeof r=="boolean")_._muted=r;else return _._muted;for(var A=_._getSoundIds(a),T=0;T<A.length;T++){var $=_._soundById(A[T]);$&&($._muted=r,$._interval&&_._stopFade($._id),_._webAudio&&$._node?$._node.gain.setValueAtTime(r?0:$._volume,e.ctx.currentTime):$._node&&($._node.muted=e._muted?!0:r),_._emit("mute",$._id))}return _},volume:function(){var r=this,a=arguments,_,A;if(a.length===0)return r._volume;if(a.length===1||a.length===2&&typeof a[1]=="undefined"){var T=r._getSoundIds(),$=T.indexOf(a[0]);$>=0?A=parseInt(a[0],10):_=parseFloat(a[0])}else a.length>=2&&(_=parseFloat(a[0]),A=parseInt(a[1],10));var w;if(typeof _!="undefined"&&_>=0&&_<=1){if(r._state!=="loaded"||r._playLock)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,a)}}),r;typeof A=="undefined"&&(r._volume=_),A=r._getSoundIds(A);for(var x=0;x<A.length;x++)w=r._soundById(A[x]),w&&(w._volume=_,a[2]||r._stopFade(A[x]),r._webAudio&&w._node&&!w._muted?w._node.gain.setValueAtTime(_,e.ctx.currentTime):w._node&&!w._muted&&(w._node.volume=_*e.volume()),r._emit("volume",w._id))}else return w=A?r._soundById(A):r._sounds[0],w?w._volume:0;return r},fade:function(r,a,_,A){var T=this;if(T._state!=="loaded"||T._playLock)return T._queue.push({event:"fade",action:function(){T.fade(r,a,_,A)}}),T;r=Math.min(Math.max(0,parseFloat(r)),1),a=Math.min(Math.max(0,parseFloat(a)),1),_=parseFloat(_),T.volume(r,A);for(var $=T._getSoundIds(A),w=0;w<$.length;w++){var x=T._soundById($[w]);if(x){if(A||T._stopFade($[w]),T._webAudio&&!x._muted){var O=e.ctx.currentTime,P=O+_/1e3;x._volume=r,x._node.gain.setValueAtTime(r,O),x._node.gain.linearRampToValueAtTime(a,P)}T._startFadeInterval(x,r,a,_,$[w],typeof A=="undefined")}}return T},_startFadeInterval:function(r,a,_,A,T,$){var w=this,x=a,O=_-a,P=Math.abs(O/.01),Z=Math.max(4,P>0?A/P:A),ne=Date.now();r._fadeTo=_,r._interval=setInterval(function(){var de=(Date.now()-ne)/A;ne=Date.now(),x+=O*de,x=Math.round(x*100)/100,O<0?x=Math.max(_,x):x=Math.min(_,x),w._webAudio?r._volume=x:w.volume(x,r._id,!0),$&&(w._volume=x),(_<a&&x<=_||_>a&&x>=_)&&(clearInterval(r._interval),r._interval=null,r._fadeTo=null,w.volume(_,r._id),w._emit("fade",r._id))},Z)},_stopFade:function(r){var a=this,_=a._soundById(r);return _&&_._interval&&(a._webAudio&&_._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(_._interval),_._interval=null,a.volume(_._fadeTo,r),_._fadeTo=null,a._emit("fade",r)),a},loop:function(){var r=this,a=arguments,_,A,T;if(a.length===0)return r._loop;if(a.length===1)if(typeof a[0]=="boolean")_=a[0],r._loop=_;else return T=r._soundById(parseInt(a[0],10)),T?T._loop:!1;else a.length===2&&(_=a[0],A=parseInt(a[1],10));for(var $=r._getSoundIds(A),w=0;w<$.length;w++)T=r._soundById($[w]),T&&(T._loop=_,r._webAudio&&T._node&&T._node.bufferSource&&(T._node.bufferSource.loop=_,_&&(T._node.bufferSource.loopStart=T._start||0,T._node.bufferSource.loopEnd=T._stop,r.playing($[w])&&(r.pause($[w],!0),r.play($[w],!0)))));return r},rate:function(){var r=this,a=arguments,_,A;if(a.length===0)A=r._sounds[0]._id;else if(a.length===1){var T=r._getSoundIds(),$=T.indexOf(a[0]);$>=0?A=parseInt(a[0],10):_=parseFloat(a[0])}else a.length===2&&(_=parseFloat(a[0]),A=parseInt(a[1],10));var w;if(typeof _=="number"){if(r._state!=="loaded"||r._playLock)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,a)}}),r;typeof A=="undefined"&&(r._rate=_),A=r._getSoundIds(A);for(var x=0;x<A.length;x++)if(w=r._soundById(A[x]),w){r.playing(A[x])&&(w._rateSeek=r.seek(A[x]),w._playStart=r._webAudio?e.ctx.currentTime:w._playStart),w._rate=_,r._webAudio&&w._node&&w._node.bufferSource?w._node.bufferSource.playbackRate.setValueAtTime(_,e.ctx.currentTime):w._node&&(w._node.playbackRate=_);var O=r.seek(A[x]),P=(r._sprite[w._sprite][0]+r._sprite[w._sprite][1])/1e3-O,Z=P*1e3/Math.abs(w._rate);(r._endTimers[A[x]]||!w._paused)&&(r._clearTimer(A[x]),r._endTimers[A[x]]=setTimeout(r._ended.bind(r,w),Z)),r._emit("rate",w._id)}}else return w=r._soundById(A),w?w._rate:r._rate;return r},seek:function(){var r=this,a=arguments,_,A;if(a.length===0)r._sounds.length&&(A=r._sounds[0]._id);else if(a.length===1){var T=r._getSoundIds(),$=T.indexOf(a[0]);$>=0?A=parseInt(a[0],10):r._sounds.length&&(A=r._sounds[0]._id,_=parseFloat(a[0]))}else a.length===2&&(_=parseFloat(a[0]),A=parseInt(a[1],10));if(typeof A=="undefined")return 0;if(typeof _=="number"&&(r._state!=="loaded"||r._playLock))return r._queue.push({event:"seek",action:function(){r.seek.apply(r,a)}}),r;var w=r._soundById(A);if(w)if(typeof _=="number"&&_>=0){var x=r.playing(A);x&&r.pause(A,!0),w._seek=_,w._ended=!1,r._clearTimer(A),!r._webAudio&&w._node&&!isNaN(w._node.duration)&&(w._node.currentTime=_);var O=function(){x&&r.play(A,!0),r._emit("seek",A)};if(x&&!r._webAudio){var P=function(){r._playLock?setTimeout(P,0):O()};setTimeout(P,0)}else O()}else if(r._webAudio){var Z=r.playing(A)?e.ctx.currentTime-w._playStart:0,ne=w._rateSeek?w._rateSeek-w._seek:0;return w._seek+(ne+Z*Math.abs(w._rate))}else return w._node.currentTime;return r},playing:function(r){var a=this;if(typeof r=="number"){var _=a._soundById(r);return _?!_._paused:!1}for(var A=0;A<a._sounds.length;A++)if(!a._sounds[A]._paused)return!0;return!1},duration:function(r){var a=this,_=a._duration,A=a._soundById(r);return A&&(_=a._sprite[A._sprite][1]/1e3),_},state:function(){return this._state},unload:function(){for(var r=this,a=r._sounds,_=0;_<a.length;_++)a[_]._paused||r.stop(a[_]._id),r._webAudio||(r._clearSound(a[_]._node),a[_]._node.removeEventListener("error",a[_]._errorFn,!1),a[_]._node.removeEventListener(e._canPlayEvent,a[_]._loadFn,!1),a[_]._node.removeEventListener("ended",a[_]._endFn,!1),e._releaseHtml5Audio(a[_]._node)),delete a[_]._node,r._clearTimer(a[_]._id);var A=e._howls.indexOf(r);A>=0&&e._howls.splice(A,1);var T=!0;for(_=0;_<e._howls.length;_++)if(e._howls[_]._src===r._src||r._src.indexOf(e._howls[_]._src)>=0){T=!1;break}return s&&T&&delete s[r._src],e.noAudio=!1,r._state="unloaded",r._sounds=[],r=null,null},on:function(r,a,_,A){var T=this,$=T["_on"+r];return typeof a=="function"&&$.push(A?{id:_,fn:a,once:A}:{id:_,fn:a}),T},off:function(r,a,_){var A=this,T=A["_on"+r],$=0;if(typeof a=="number"&&(_=a,a=null),a||_)for($=0;$<T.length;$++){var w=_===T[$].id;if(a===T[$].fn&&w||!a&&w){T.splice($,1);break}}else if(r)A["_on"+r]=[];else{var x=Object.keys(A);for($=0;$<x.length;$++)x[$].indexOf("_on")===0&&Array.isArray(A[x[$]])&&(A[x[$]]=[])}return A},once:function(r,a,_){var A=this;return A.on(r,a,_,1),A},_emit:function(r,a,_){for(var A=this,T=A["_on"+r],$=T.length-1;$>=0;$--)(!T[$].id||T[$].id===a||r==="load")&&(setTimeout(function(w){w.call(this,a,_)}.bind(A,T[$].fn),0),T[$].once&&A.off(r,T[$].fn,T[$].id));return A._loadQueue(r),A},_loadQueue:function(r){var a=this;if(a._queue.length>0){var _=a._queue[0];_.event===r&&(a._queue.shift(),a._loadQueue()),r||_.action()}return a},_ended:function(r){var a=this,_=r._sprite;if(!a._webAudio&&r._node&&!r._node.paused&&!r._node.ended&&r._node.currentTime<r._stop)return setTimeout(a._ended.bind(a,r),100),a;var A=!!(r._loop||a._sprite[_][2]);if(a._emit("end",r._id),!a._webAudio&&A&&a.stop(r._id,!0).play(r._id),a._webAudio&&A){a._emit("play",r._id),r._seek=r._start||0,r._rateSeek=0,r._playStart=e.ctx.currentTime;var T=(r._stop-r._start)*1e3/Math.abs(r._rate);a._endTimers[r._id]=setTimeout(a._ended.bind(a,r),T)}return a._webAudio&&!A&&(r._paused=!0,r._ended=!0,r._seek=r._start||0,r._rateSeek=0,a._clearTimer(r._id),a._cleanBuffer(r._node),e._autoSuspend()),!a._webAudio&&!A&&a.stop(r._id,!0),a},_clearTimer:function(r){var a=this;if(a._endTimers[r]){if(typeof a._endTimers[r]!="function")clearTimeout(a._endTimers[r]);else{var _=a._soundById(r);_&&_._node&&_._node.removeEventListener("ended",a._endTimers[r],!1)}delete a._endTimers[r]}return a},_soundById:function(r){for(var a=this,_=0;_<a._sounds.length;_++)if(r===a._sounds[_]._id)return a._sounds[_];return null},_inactiveSound:function(){var r=this;r._drain();for(var a=0;a<r._sounds.length;a++)if(r._sounds[a]._ended)return r._sounds[a].reset();return new i(r)},_drain:function(){var r=this,a=r._pool,_=0,A=0;if(!(r._sounds.length<a)){for(A=0;A<r._sounds.length;A++)r._sounds[A]._ended&&_++;for(A=r._sounds.length-1;A>=0;A--){if(_<=a)return;r._sounds[A]._ended&&(r._webAudio&&r._sounds[A]._node&&r._sounds[A]._node.disconnect(0),r._sounds.splice(A,1),_--)}}},_getSoundIds:function(r){var a=this;if(typeof r=="undefined"){for(var _=[],A=0;A<a._sounds.length;A++)_.push(a._sounds[A]._id);return _}else return[r]},_refreshBuffer:function(r){var a=this;return r._node.bufferSource=e.ctx.createBufferSource(),r._node.bufferSource.buffer=s[a._src],r._panner?r._node.bufferSource.connect(r._panner):r._node.bufferSource.connect(r._node),r._node.bufferSource.loop=r._loop,r._loop&&(r._node.bufferSource.loopStart=r._start||0,r._node.bufferSource.loopEnd=r._stop||0),r._node.bufferSource.playbackRate.setValueAtTime(r._rate,e.ctx.currentTime),a},_cleanBuffer:function(r){var a=this,_=e._navigator&&e._navigator.vendor.indexOf("Apple")>=0;if(e._scratchBuffer&&r.bufferSource&&(r.bufferSource.onended=null,r.bufferSource.disconnect(0),_))try{r.bufferSource.buffer=e._scratchBuffer}catch{}return r.bufferSource=null,a},_clearSound:function(r){var a=/MSIE |Trident\//.test(e._navigator&&e._navigator.userAgent);a||(r.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var i=function(r){this._parent=r,this.init()};i.prototype={init:function(){var r=this,a=r._parent;return r._muted=a._muted,r._loop=a._loop,r._volume=a._volume,r._rate=a._rate,r._seek=0,r._paused=!0,r._ended=!0,r._sprite="__default",r._id=++e._counter,a._sounds.push(r),r.create(),r},create:function(){var r=this,a=r._parent,_=e._muted||r._muted||r._parent._muted?0:r._volume;return a._webAudio?(r._node=typeof e.ctx.createGain=="undefined"?e.ctx.createGainNode():e.ctx.createGain(),r._node.gain.setValueAtTime(_,e.ctx.currentTime),r._node.paused=!0,r._node.connect(e.masterGain)):e.noAudio||(r._node=e._obtainHtml5Audio(),r._errorFn=r._errorListener.bind(r),r._node.addEventListener("error",r._errorFn,!1),r._loadFn=r._loadListener.bind(r),r._node.addEventListener(e._canPlayEvent,r._loadFn,!1),r._endFn=r._endListener.bind(r),r._node.addEventListener("ended",r._endFn,!1),r._node.src=a._src,r._node.preload=a._preload===!0?"auto":a._preload,r._node.volume=_*e.volume(),r._node.load()),r},reset:function(){var r=this,a=r._parent;return r._muted=a._muted,r._loop=a._loop,r._volume=a._volume,r._rate=a._rate,r._seek=0,r._rateSeek=0,r._paused=!0,r._ended=!0,r._sprite="__default",r._id=++e._counter,r},_errorListener:function(){var r=this;r._parent._emit("loaderror",r._id,r._node.error?r._node.error.code:0),r._node.removeEventListener("error",r._errorFn,!1)},_loadListener:function(){var r=this,a=r._parent;a._duration=Math.ceil(r._node.duration*10)/10,Object.keys(a._sprite).length===0&&(a._sprite={__default:[0,a._duration*1e3]}),a._state!=="loaded"&&(a._state="loaded",a._emit("load"),a._loadQueue()),r._node.removeEventListener(e._canPlayEvent,r._loadFn,!1)},_endListener:function(){var r=this,a=r._parent;a._duration===1/0&&(a._duration=Math.ceil(r._node.duration*10)/10,a._sprite.__default[1]===1/0&&(a._sprite.__default[1]=a._duration*1e3),a._ended(r)),r._node.removeEventListener("ended",r._endFn,!1)}};var s={},c=function(r){var a=r._src;if(s[a]){r._duration=s[a].duration,g(r);return}if(/^data:[^;]+;base64,/.test(a)){for(var _=atob(a.split(",")[1]),A=new Uint8Array(_.length),T=0;T<_.length;++T)A[T]=_.charCodeAt(T);p(A.buffer,r)}else{var $=new XMLHttpRequest;$.open(r._xhr.method,a,!0),$.withCredentials=r._xhr.withCredentials,$.responseType="arraybuffer",r._xhr.headers&&Object.keys(r._xhr.headers).forEach(function(w){$.setRequestHeader(w,r._xhr.headers[w])}),$.onload=function(){var w=($.status+"")[0];if(w!=="0"&&w!=="2"&&w!=="3"){r._emit("loaderror",null,"Failed loading audio file with status: "+$.status+".");return}p($.response,r)},$.onerror=function(){r._webAudio&&(r._html5=!0,r._webAudio=!1,r._sounds=[],delete s[a],r.load())},d($)}},d=function(r){try{r.send()}catch{r.onerror()}},p=function(r,a){var _=function(){a._emit("loaderror",null,"Decoding audio data failed.")},A=function(T){T&&a._sounds.length>0?(s[a._src]=T,g(a,T)):_()};typeof Promise!="undefined"&&e.ctx.decodeAudioData.length===1?e.ctx.decodeAudioData(r).then(A).catch(_):e.ctx.decodeAudioData(r,A,_)},g=function(r,a){a&&!r._duration&&(r._duration=a.duration),Object.keys(r._sprite).length===0&&(r._sprite={__default:[0,r._duration*1e3]}),r._state!=="loaded"&&(r._state="loaded",r._emit("load"),r._loadQueue())},I=function(){if(!!e.usingWebAudio){try{typeof AudioContext!="undefined"?e.ctx=new AudioContext:typeof webkitAudioContext!="undefined"?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch{e.usingWebAudio=!1}e.ctx||(e.usingWebAudio=!1);var r=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),a=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),_=a?parseInt(a[1],10):null;if(r&&_&&_<9){var A=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase());e._navigator&&!A&&(e.usingWebAudio=!1)}e.usingWebAudio&&(e.masterGain=typeof e.ctx.createGain=="undefined"?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.setValueAtTime(e._muted?0:e._volume,e.ctx.currentTime),e.masterGain.connect(e.ctx.destination)),e._setup()}};f.Howler=e,f.Howl=t,typeof ut!="undefined"?(ut.HowlerGlobal=n,ut.Howler=e,ut.Howl=t,ut.Sound=i):typeof window!="undefined"&&(window.HowlerGlobal=n,window.Howler=e,window.Howl=t,window.Sound=i)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var i=t._howls.length-1;i>=0;i--)t._howls[i].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,i){var s=this;if(!s.ctx||!s.ctx.listener)return s;if(t=typeof t!="number"?s._pos[1]:t,i=typeof i!="number"?s._pos[2]:i,typeof e=="number")s._pos=[e,t,i],typeof s.ctx.listener.positionX!="undefined"?(s.ctx.listener.positionX.setTargetAtTime(s._pos[0],Howler.ctx.currentTime,.1),s.ctx.listener.positionY.setTargetAtTime(s._pos[1],Howler.ctx.currentTime,.1),s.ctx.listener.positionZ.setTargetAtTime(s._pos[2],Howler.ctx.currentTime,.1)):s.ctx.listener.setPosition(s._pos[0],s._pos[1],s._pos[2]);else return s._pos;return s},HowlerGlobal.prototype.orientation=function(e,t,i,s,c,d){var p=this;if(!p.ctx||!p.ctx.listener)return p;var g=p._orientation;if(t=typeof t!="number"?g[1]:t,i=typeof i!="number"?g[2]:i,s=typeof s!="number"?g[3]:s,c=typeof c!="number"?g[4]:c,d=typeof d!="number"?g[5]:d,typeof e=="number")p._orientation=[e,t,i,s,c,d],typeof p.ctx.listener.forwardX!="undefined"?(p.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),p.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),p.ctx.listener.forwardZ.setTargetAtTime(i,Howler.ctx.currentTime,.1),p.ctx.listener.upX.setTargetAtTime(s,Howler.ctx.currentTime,.1),p.ctx.listener.upY.setTargetAtTime(c,Howler.ctx.currentTime,.1),p.ctx.listener.upZ.setTargetAtTime(d,Howler.ctx.currentTime,.1)):p.ctx.listener.setOrientation(e,t,i,s,c,d);else return g;return p},Howl.prototype.init=function(e){return function(t){var i=this;return i._orientation=t.orientation||[1,0,0],i._stereo=t.stereo||null,i._pos=t.pos||null,i._pannerAttr={coneInnerAngle:typeof t.coneInnerAngle!="undefined"?t.coneInnerAngle:360,coneOuterAngle:typeof t.coneOuterAngle!="undefined"?t.coneOuterAngle:360,coneOuterGain:typeof t.coneOuterGain!="undefined"?t.coneOuterGain:0,distanceModel:typeof t.distanceModel!="undefined"?t.distanceModel:"inverse",maxDistance:typeof t.maxDistance!="undefined"?t.maxDistance:1e4,panningModel:typeof t.panningModel!="undefined"?t.panningModel:"HRTF",refDistance:typeof t.refDistance!="undefined"?t.refDistance:1,rolloffFactor:typeof t.rolloffFactor!="undefined"?t.rolloffFactor:1},i._onstereo=t.onstereo?[{fn:t.onstereo}]:[],i._onpos=t.onpos?[{fn:t.onpos}]:[],i._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}}(Howl.prototype.init),Howl.prototype.stereo=function(e,t){var i=this;if(!i._webAudio)return i;if(i._state!=="loaded")return i._queue.push({event:"stereo",action:function(){i.stereo(e,t)}}),i;var s=typeof Howler.ctx.createStereoPanner=="undefined"?"spatial":"stereo";if(typeof t=="undefined")if(typeof e=="number")i._stereo=e,i._pos=[e,0,0];else return i._stereo;for(var c=i._getSoundIds(t),d=0;d<c.length;d++){var p=i._soundById(c[d]);if(p)if(typeof e=="number")p._stereo=e,p._pos=[e,0,0],p._node&&(p._pannerAttr.panningModel="equalpower",(!p._panner||!p._panner.pan)&&n(p,s),s==="spatial"?typeof p._panner.positionX!="undefined"?(p._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),p._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),p._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):p._panner.setPosition(e,0,0):p._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),i._emit("stereo",p._id);else return p._stereo}return i},Howl.prototype.pos=function(e,t,i,s){var c=this;if(!c._webAudio)return c;if(c._state!=="loaded")return c._queue.push({event:"pos",action:function(){c.pos(e,t,i,s)}}),c;if(t=typeof t!="number"?0:t,i=typeof i!="number"?-.5:i,typeof s=="undefined")if(typeof e=="number")c._pos=[e,t,i];else return c._pos;for(var d=c._getSoundIds(s),p=0;p<d.length;p++){var g=c._soundById(d[p]);if(g)if(typeof e=="number")g._pos=[e,t,i],g._node&&((!g._panner||g._panner.pan)&&n(g,"spatial"),typeof g._panner.positionX!="undefined"?(g._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),g._panner.positionY.setValueAtTime(t,Howler.ctx.currentTime),g._panner.positionZ.setValueAtTime(i,Howler.ctx.currentTime)):g._panner.setPosition(e,t,i)),c._emit("pos",g._id);else return g._pos}return c},Howl.prototype.orientation=function(e,t,i,s){var c=this;if(!c._webAudio)return c;if(c._state!=="loaded")return c._queue.push({event:"orientation",action:function(){c.orientation(e,t,i,s)}}),c;if(t=typeof t!="number"?c._orientation[1]:t,i=typeof i!="number"?c._orientation[2]:i,typeof s=="undefined")if(typeof e=="number")c._orientation=[e,t,i];else return c._orientation;for(var d=c._getSoundIds(s),p=0;p<d.length;p++){var g=c._soundById(d[p]);if(g)if(typeof e=="number")g._orientation=[e,t,i],g._node&&(g._panner||(g._pos||(g._pos=c._pos||[0,0,-.5]),n(g,"spatial")),typeof g._panner.orientationX!="undefined"?(g._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),g._panner.orientationY.setValueAtTime(t,Howler.ctx.currentTime),g._panner.orientationZ.setValueAtTime(i,Howler.ctx.currentTime)):g._panner.setOrientation(e,t,i)),c._emit("orientation",g._id);else return g._orientation}return c},Howl.prototype.pannerAttr=function(){var e=this,t=arguments,i,s,c;if(!e._webAudio)return e;if(t.length===0)return e._pannerAttr;if(t.length===1)if(typeof t[0]=="object")i=t[0],typeof s=="undefined"&&(i.pannerAttr||(i.pannerAttr={coneInnerAngle:i.coneInnerAngle,coneOuterAngle:i.coneOuterAngle,coneOuterGain:i.coneOuterGain,distanceModel:i.distanceModel,maxDistance:i.maxDistance,refDistance:i.refDistance,rolloffFactor:i.rolloffFactor,panningModel:i.panningModel}),e._pannerAttr={coneInnerAngle:typeof i.pannerAttr.coneInnerAngle!="undefined"?i.pannerAttr.coneInnerAngle:e._coneInnerAngle,coneOuterAngle:typeof i.pannerAttr.coneOuterAngle!="undefined"?i.pannerAttr.coneOuterAngle:e._coneOuterAngle,coneOuterGain:typeof i.pannerAttr.coneOuterGain!="undefined"?i.pannerAttr.coneOuterGain:e._coneOuterGain,distanceModel:typeof i.pannerAttr.distanceModel!="undefined"?i.pannerAttr.distanceModel:e._distanceModel,maxDistance:typeof i.pannerAttr.maxDistance!="undefined"?i.pannerAttr.maxDistance:e._maxDistance,refDistance:typeof i.pannerAttr.refDistance!="undefined"?i.pannerAttr.refDistance:e._refDistance,rolloffFactor:typeof i.pannerAttr.rolloffFactor!="undefined"?i.pannerAttr.rolloffFactor:e._rolloffFactor,panningModel:typeof i.pannerAttr.panningModel!="undefined"?i.pannerAttr.panningModel:e._panningModel});else return c=e._soundById(parseInt(t[0],10)),c?c._pannerAttr:e._pannerAttr;else t.length===2&&(i=t[0],s=parseInt(t[1],10));for(var d=e._getSoundIds(s),p=0;p<d.length;p++)if(c=e._soundById(d[p]),c){var g=c._pannerAttr;g={coneInnerAngle:typeof i.coneInnerAngle!="undefined"?i.coneInnerAngle:g.coneInnerAngle,coneOuterAngle:typeof i.coneOuterAngle!="undefined"?i.coneOuterAngle:g.coneOuterAngle,coneOuterGain:typeof i.coneOuterGain!="undefined"?i.coneOuterGain:g.coneOuterGain,distanceModel:typeof i.distanceModel!="undefined"?i.distanceModel:g.distanceModel,maxDistance:typeof i.maxDistance!="undefined"?i.maxDistance:g.maxDistance,refDistance:typeof i.refDistance!="undefined"?i.refDistance:g.refDistance,rolloffFactor:typeof i.rolloffFactor!="undefined"?i.rolloffFactor:g.rolloffFactor,panningModel:typeof i.panningModel!="undefined"?i.panningModel:g.panningModel};var I=c._panner;I?(I.coneInnerAngle=g.coneInnerAngle,I.coneOuterAngle=g.coneOuterAngle,I.coneOuterGain=g.coneOuterGain,I.distanceModel=g.distanceModel,I.maxDistance=g.maxDistance,I.refDistance=g.refDistance,I.rolloffFactor=g.rolloffFactor,I.panningModel=g.panningModel):(c._pos||(c._pos=e._pos||[0,0,-.5]),n(c,"spatial"))}return e},Sound.prototype.init=function(e){return function(){var t=this,i=t._parent;t._orientation=i._orientation,t._stereo=i._stereo,t._pos=i._pos,t._pannerAttr=i._pannerAttr,e.call(this),t._stereo?i.stereo(t._stereo):t._pos&&i.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,i=t._parent;return t._orientation=i._orientation,t._stereo=i._stereo,t._pos=i._pos,t._pannerAttr=i._pannerAttr,t._stereo?i.stereo(t._stereo):t._pos?i.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,i._refreshBuffer(t)),e.call(this)}}(Sound.prototype.reset);var n=function(e,t){t=t||"spatial",t==="spatial"?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,typeof e._panner.positionX!="undefined"?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),typeof e._panner.orientationX!="undefined"?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}})()})(ti);function Ia(f,n,e){let{soundFile:t=!1}=n,i=!1,s={};const c=()=>{s&&s.playing&&(s.stop(),s.unload(),s={})};return Nr(async()=>{c()}),f.$$set=d=>{"soundFile"in d&&e(0,t=d.soundFile)},f.$$.update=()=>{f.$$.dirty&3&&t&&(e(1,i="https://cdn.sanity.io/files/58ueii0w/production/"+Ce(t,"asset._ref","").replace("file-","").replace("-mp3",".mp3")),c(),s=new ti.Howl({src:[i],loop:!0,autoplay:!0}))},[t,i]}class Ta extends Se{constructor(n){super(),Re(this,n,Ia,null,De,{soundFile:0})}}function hr(f){let n,e;return{c(){n=U("img"),this.h()},l(t){n=V(t,"IMG",{src:!0}),this.h()},h(){xe(n.src,e=ct(f[0].iconImage).quality(100).height(100).url())||k(n,"src",e)},m(t,i){j(t,n,i)},p(t,i){i&1&&!xe(n.src,e=ct(t[0].iconImage).quality(100).height(100).url())&&k(n,"src",e)},d(t){t&&R(n)}}}function Ea(f){let n,e,t,i,s,c=f[0].iconImage&&hr(f);return{c(){n=U("div"),c&&c.c(),this.h()},l(d){n=V(d,"DIV",{class:!0,id:!0,alt:!0,style:!0});var p=G(n);c&&c.l(p),p.forEach(R),this.h()},h(){k(n,"class","portal svelte-1ulo7kp"),k(n,"id",e=f[0]._id),k(n,"alt",t=f[0].title),k(n,"style",f[2])},m(d,p){j(d,n,p),c&&c.m(n,null),f[5](n),s=!0},p(d,[p]){d[0].iconImage?c?c.p(d,p):(c=hr(d),c.c(),c.m(n,null)):c&&(c.d(1),c=null),(!s||p&1&&e!==(e=d[0]._id))&&k(n,"id",e),(!s||p&1&&t!==(t=d[0].title))&&k(n,"alt",t)},i(d){s||(nt(()=>{i||(i=je(n,Le,{},!0)),i.run(1)}),s=!0)},o(d){i||(i=je(n,Le,{},!1)),i.run(0),s=!1},d(d){d&&R(n),c&&c.d(),f[5](null),d&&i&&i.end()}}}function xa(f,n,e){let t;Oe(f,Pt,r=>e(4,t=r));let{portal:i={}}=n,s={},c={},d=i.y*ye,p=i.x*ye;const g=`transform: translateY(${d}px) translateX(${p}px); width: ${ye}px; height: ${ye}px; background-color: ${Ce(i,"backgroundColor.hex","")}; background-image: url("${Ce(i,"bgImageUrl","")}");"`;gt(async()=>{e(3,c=tippy(s,{content:"door to "+Ce(i,"targetArea.title",""),arrow:!1,offset:[0,5],theme:"name",hideOnClick:!1,sticky:!0,trigger:"manual",flip:!1,placement:"bottom",popperOptions:{modifiers:[{name:"flip",enabled:!1},{name:"preventOverflow",enabled:!1}]}}))});function I(r){Tt[r?"unshift":"push"](()=>{s=r,e(1,s)})}return f.$$set=r=>{"portal"in r&&e(0,i=r.portal)},f.$$.update=()=>{f.$$.dirty&24&&c.popper&&(t?c.show():c.hide())},[i,s,g,c,t,I]}class ka extends Se{constructor(n){super(),Re(this,n,xa,Ea,De,{portal:0})}}function _r(f,n,e){const t=f.slice();return t[1]=n[e],t}function pr(f,n){let e,t,i;return t=new ka({props:{portal:n[1]}}),{key:f,first:null,c(){e=le(),be(t.$$.fragment),this.h()},l(s){e=le(),$e(t.$$.fragment,s),this.h()},h(){this.first=e},m(s,c){j(s,e,c),Ie(t,s,c),i=!0},p(s,c){n=s;const d={};c&1&&(d.portal=n[1]),t.$set(d)},i(s){i||(C(t.$$.fragment,s),i=!0)},o(s){H(t.$$.fragment,s),i=!1},d(s){s&&R(e),Te(t,s)}}}function Oa(f){let n=[],e=new Map,t,i,s=f[0];const c=d=>d[1]._id;for(let d=0;d<s.length;d+=1){let p=_r(f,s,d),g=c(p);e.set(g,n[d]=pr(g,p))}return{c(){for(let d=0;d<n.length;d+=1)n[d].c();t=le()},l(d){for(let p=0;p<n.length;p+=1)n[p].l(d);t=le()},m(d,p){for(let g=0;g<n.length;g+=1)n[g].m(d,p);j(d,t,p),i=!0},p(d,[p]){p&1&&(s=d[0],we(),n=Gt(n,p,c,1,d,s,e,t.parentNode,zt,pr,t,_r),Ae())},i(d){if(!i){for(let p=0;p<s.length;p+=1)C(n[p]);i=!0}},o(d){for(let p=0;p<n.length;p+=1)H(n[p]);i=!1},d(d){for(let p=0;p<n.length;p+=1)n[p].d(d);d&&R(t)}}}function Sa(f,n,e){let{portals:t={}}=n;return f.$$set=i=>{"portals"in i&&e(0,t=i.portals)},[t]}class Ra extends Se{constructor(n){super(),Re(this,n,Sa,Oa,De,{portals:0})}}function Da(f){let n,e;return{c(){n=U("div"),this.h()},l(t){n=V(t,"DIV",{class:!0,style:!0}),G(n).forEach(R),this.h()},h(){k(n,"class","target svelte-sfd7q3"),k(n,"style",e="top: "+f[1]+"px; left: "+f[0]+"px;")},m(t,i){j(t,n,i)},p(t,[i]){i&3&&e!==(e="top: "+t[1]+"px; left: "+t[0]+"px;")&&k(n,"style",e)},i:Xe,o:Xe,d(t){t&&R(n)}}}function Ma(f,n,e){let{x:t=0}=n,{y:i=0}=n;return f.$$set=s=>{"x"in s&&e(0,t=s.x),"y"in s&&e(1,i=s.y)},[t,i]}class Pa extends Se{constructor(n){super(),Re(this,n,Ma,Da,De,{x:0,y:1})}}function Ca(f){let n,e,t;return{c(){n=U("div"),e=U("iframe"),this.h()},l(i){n=V(i,"DIV",{class:!0});var s=G(n);e=V(s,"IFRAME",{width:!0,height:!0,src:!0,frameborder:!0,color:!0,allow:!0,sandbox:!0,class:!0}),G(e).forEach(R),s.forEach(R),this.h()},h(){k(e,"width","720"),k(e,"height","480"),xe(e.src,t=f[0])||k(e,"src",t),k(e,"frameborder","no"),k(e,"color","#ffffff"),k(e,"allow","autoplay; fullscreen"),k(e,"sandbox","allow-same-origin allow-scripts allow-popups"),e.allowFullscreen=!0,k(e,"class","svelte-ldmhir"),k(n,"class","peertube-container svelte-ldmhir")},m(i,s){j(i,n,s),Y(n,e)},p(i,s){s&1&&!xe(e.src,t=i[0])&&k(e,"src",t)},d(i){i&&R(n)}}}function La(f){let n,e,t;return{c(){n=U("div"),e=U("iframe"),this.h()},l(i){n=V(i,"DIV",{class:!0});var s=G(n);e=V(s,"IFRAME",{width:!0,height:!0,src:!0,frameborder:!0,scrolling:!0,byline:!0,color:!0,allow:!0,class:!0}),G(e).forEach(R),s.forEach(R),this.h()},h(){k(e,"width","720"),k(e,"height","480"),xe(e.src,t="https://player.vimeo.com/video/"+dt(f[0]).id+"?autoplay=1")||k(e,"src",t),k(e,"frameborder","no"),k(e,"scrolling","no"),k(e,"byline","false"),k(e,"color","#ffffff"),k(e,"allow","autoplay; fullscreen"),e.allowFullscreen=!0,k(e,"class","svelte-ldmhir"),k(n,"class","vimeo-container svelte-ldmhir")},m(i,s){j(i,n,s),Y(n,e)},p(i,s){s&1&&!xe(e.src,t="https://player.vimeo.com/video/"+dt(i[0]).id+"?autoplay=1")&&k(e,"src",t)},d(i){i&&R(n)}}}function Fa(f){let n,e,t;return{c(){n=U("div"),e=U("iframe"),this.h()},l(i){n=V(i,"DIV",{class:!0});var s=G(n);e=V(s,"IFRAME",{width:!0,height:!0,src:!0,frameborder:!0,allow:!0,class:!0}),G(e).forEach(R),s.forEach(R),this.h()},h(){k(e,"width","1920"),k(e,"height","1280"),xe(e.src,t="https://www.youtube.com/embed/"+dt(f[0]).id+"?autoplay=1&rel=0&color=white")||k(e,"src",t),k(e,"frameborder","no"),k(e,"allow","autoplay; fullscreen"),e.allowFullscreen=!0,k(e,"class","svelte-ldmhir"),k(n,"class","youtube-container svelte-ldmhir")},m(i,s){j(i,n,s),Y(n,e)},p(i,s){s&1&&!xe(e.src,t="https://www.youtube.com/embed/"+dt(i[0]).id+"?autoplay=1&rel=0&color=white")&&k(e,"src",t)},d(i){i&&R(n)}}}function Na(f){let n,e,t,i,s,c,d;function p(r,a){if(a&1&&(t=null),a&1&&(i=null),a&1&&(s=null),t==null&&(t=!!(r[0].includes("youtube")||r[0].includes("youtu.be"))),t)return Fa;if(i==null&&(i=!!r[0].includes("vimeo")),i)return La;if(s==null&&(s=!!r[0].includes("undersco.re")),s)return Ca}let g=p(f,-1),I=g&&g(f);return{c(){n=U("div"),e=U("div"),I&&I.c(),this.h()},l(r){n=V(r,"DIV",{class:!0});var a=G(n);e=V(a,"DIV",{class:!0});var _=G(e);I&&I.l(_),_.forEach(R),a.forEach(R),this.h()},h(){k(e,"class","embed svelte-ldmhir"),k(n,"class","stream-container svelte-ldmhir")},m(r,a){j(r,n,a),Y(n,e),I&&I.m(e,null),d=!0},p(r,[a]){f=r,g===(g=p(f,a))&&I?I.p(f,a):(I&&I.d(1),I=g&&g(f),I&&(I.c(),I.m(e,null)))},i(r){d||(nt(()=>{c||(c=je(n,Le,{duration:300,easing:dn},!0)),c.run(1)}),d=!0)},o(r){c||(c=je(n,Le,{duration:300,easing:dn},!1)),c.run(0),d=!1},d(r){r&&R(n),I&&I.d(),r&&c&&c.end()}}}function ja(f,n,e){let{streamUrl:t=""}=n;return f.$$set=i=>{"streamUrl"in i&&e(0,t=i.streamUrl)},[t]}class Ba extends Se{constructor(n){super(),Re(this,n,ja,Na,De,{streamUrl:0})}}function Ha(f){let n,e,t;return{c(){n=U("div"),e=U("iframe"),this.h()},l(i){n=V(i,"DIV",{class:!0});var s=G(n);e=V(s,"IFRAME",{width:!0,height:!0,src:!0,frameborder:!0,color:!0,allow:!0,sandbox:!0,class:!0}),G(e).forEach(R),s.forEach(R),this.h()},h(){k(e,"width","720"),k(e,"height","480"),xe(e.src,t=f[0])||k(e,"src",t),k(e,"frameborder","no"),k(e,"color","#ffffff"),k(e,"allow","autoplay; fullscreen"),k(e,"sandbox","allow-same-origin allow-scripts allow-popups"),e.allowFullscreen=!0,k(e,"class","svelte-174tb22"),k(n,"class","peertube-container svelte-174tb22")},m(i,s){j(i,n,s),Y(n,e)},p(i,s){s&1&&!xe(e.src,t=i[0])&&k(e,"src",t)},d(i){i&&R(n)}}}function Ua(f){let n,e,t;return{c(){n=U("div"),e=U("iframe"),this.h()},l(i){n=V(i,"DIV",{class:!0});var s=G(n);e=V(s,"IFRAME",{width:!0,height:!0,src:!0,frameborder:!0,scrolling:!0,byline:!0,color:!0,allow:!0,class:!0}),G(e).forEach(R),s.forEach(R),this.h()},h(){k(e,"width","720"),k(e,"height","480"),xe(e.src,t="https://player.vimeo.com/video/"+dt(f[0]).id)||k(e,"src",t),k(e,"frameborder","no"),k(e,"scrolling","no"),k(e,"byline","false"),k(e,"color","#ffffff"),k(e,"allow","autoplay; fullscreen"),e.allowFullscreen=!0,k(e,"class","svelte-174tb22"),k(n,"class","vimeo-container svelte-174tb22")},m(i,s){j(i,n,s),Y(n,e)},p(i,s){s&1&&!xe(e.src,t="https://player.vimeo.com/video/"+dt(i[0]).id)&&k(e,"src",t)},d(i){i&&R(n)}}}function Va(f){let n,e,t;return{c(){n=U("div"),e=U("iframe"),this.h()},l(i){n=V(i,"DIV",{class:!0});var s=G(n);e=V(s,"IFRAME",{width:!0,height:!0,src:!0,frameborder:!0,allow:!0,class:!0}),G(e).forEach(R),s.forEach(R),this.h()},h(){k(e,"width","1920"),k(e,"height","1280"),xe(e.src,t="https://www.youtube.com/embed/"+dt(f[0]).id+"?rel=0&color=white")||k(e,"src",t),k(e,"frameborder","no"),k(e,"allow","autoplay; fullscreen"),e.allowFullscreen=!0,k(e,"class","svelte-174tb22"),k(n,"class","youtube-container svelte-174tb22")},m(i,s){j(i,n,s),Y(n,e)},p(i,s){s&1&&!xe(e.src,t="https://www.youtube.com/embed/"+dt(i[0]).id+"?rel=0&color=white")&&k(e,"src",t)},d(i){i&&R(n)}}}function qa(f){let n,e,t,i,s,c;function d(I,r){if(r&1&&(t=null),r&1&&(i=null),r&1&&(s=null),t==null&&(t=!!(I[0].includes("youtube")||I[0].includes("youtu.be"))),t)return Va;if(i==null&&(i=!!I[0].includes("vimeo")),i)return Ua;if(s==null&&(s=!!I[0].includes("undersco.re")),s)return Ha}let p=d(f,-1),g=p&&p(f);return{c(){n=U("div"),e=U("div"),g&&g.c(),this.h()},l(I){n=V(I,"DIV",{class:!0});var r=G(n);e=V(r,"DIV",{class:!0});var a=G(e);g&&g.l(a),a.forEach(R),r.forEach(R),this.h()},h(){k(e,"class","embed svelte-174tb22"),k(n,"class","stream-container svelte-174tb22")},m(I,r){j(I,n,r),Y(n,e),g&&g.m(e,null)},p(I,[r]){f=I,p===(p=d(f,r))&&g?g.p(f,r):(g&&g.d(1),g=p&&p(f),g&&(g.c(),g.m(e,null)))},i(I){c||nt(()=>{c=gn(n,Le,{duration:300,easing:dn}),c.start()})},o:Xe,d(I){I&&R(n),g&&g.d()}}}function Ga(f,n,e){let{streamUrl:t=""}=n;return f.$$set=i=>{"streamUrl"in i&&e(0,t=i.streamUrl)},[t]}class za extends Se{constructor(n){super(),Re(this,n,Ga,qa,De,{streamUrl:0})}}function mr(f){let n,e,t,i,s,c,d,p=Yn(f[1].startDate)+"",g,I,r,a=f[1].title+"",_,A,T=Ze(f[1],"content.content"),$,w=T&&vr(f);return{c(){n=U("div"),e=U("img"),s=ve(),c=U("div"),d=U("div"),g=ze(p),I=ve(),r=U("div"),_=ze(a),A=ve(),w&&w.c(),this.h()},l(x){n=V(x,"DIV",{class:!0});var O=G(n);e=V(O,"IMG",{class:!0,alt:!0,src:!0}),O.forEach(R),s=ge(x),c=V(x,"DIV",{class:!0});var P=G(c);d=V(P,"DIV",{class:!0});var Z=G(d);g=We(Z,p),Z.forEach(R),I=ge(P),r=V(P,"DIV",{class:!0});var ne=G(r);_=We(ne,a),ne.forEach(R),A=ge(P),w&&w.l(P),P.forEach(R),this.h()},h(){k(e,"class","image svelte-1unfe15"),k(e,"alt",t=f[1].title),xe(e.src,i=f[0].importEvent?Jn(f[1].mainImage).quality(90).saturation(-100).width(500).height(500).url():ct(f[1].mainImage).quality(90).saturation(-100).width(500).height(500).url())||k(e,"src",i),k(n,"class","image-container svelte-1unfe15"),k(d,"class","date svelte-1unfe15"),k(r,"class","title svelte-1unfe15"),k(c,"class","text-container svelte-1unfe15")},m(x,O){j(x,n,O),Y(n,e),j(x,s,O),j(x,c,O),Y(c,d),Y(d,g),Y(c,I),Y(c,r),Y(r,_),Y(c,A),w&&w.m(c,null),$=!0},p(x,O){(!$||O&2&&t!==(t=x[1].title))&&k(e,"alt",t),(!$||O&3&&!xe(e.src,i=x[0].importEvent?Jn(x[1].mainImage).quality(90).saturation(-100).width(500).height(500).url():ct(x[1].mainImage).quality(90).saturation(-100).width(500).height(500).url()))&&k(e,"src",i),(!$||O&2)&&p!==(p=Yn(x[1].startDate)+"")&&It(g,p),(!$||O&2)&&a!==(a=x[1].title+"")&&It(_,a),O&2&&(T=Ze(x[1],"content.content")),T?w?(w.p(x,O),O&2&&C(w,1)):(w=vr(x),w.c(),C(w,1),w.m(c,null)):w&&(we(),H(w,1,1,()=>{w=null}),Ae())},i(x){$||(C(w),$=!0)},o(x){H(w),$=!1},d(x){x&&R(n),x&&R(s),x&&R(c),w&&w.d()}}}function vr(f){let n,e,t;return e=new wn({props:{blocks:f[1].content.content,mainSite:f[0].importEvent}}),{c(){n=U("div"),be(e.$$.fragment),this.h()},l(i){n=V(i,"DIV",{class:!0});var s=G(n);$e(e.$$.fragment,s),s.forEach(R),this.h()},h(){k(n,"class","description")},m(i,s){j(i,n,s),Ie(e,n,null),t=!0},p(i,s){const c={};s&2&&(c.blocks=i[1].content.content),s&1&&(c.mainSite=i[0].importEvent),e.$set(c)},i(i){t||(C(e.$$.fragment,i),t=!0)},o(i){H(e.$$.fragment,i),t=!1},d(i){i&&R(n),Te(e)}}}function Wa(f){let n,e,t=f[1]&&mr(f);return{c(){n=U("div"),t&&t.c(),this.h()},l(i){n=V(i,"DIV",{class:!0});var s=G(n);t&&t.l(s),s.forEach(R),this.h()},h(){k(n,"class","event svelte-1unfe15")},m(i,s){j(i,n,s),t&&t.m(n,null),e=!0},p(i,[s]){i[1]?t?(t.p(i,s),s&2&&C(t,1)):(t=mr(i),t.c(),C(t,1),t.m(n,null)):t&&(we(),H(t,1,1,()=>{t=null}),Ae())},i(i){e||(C(t),e=!0)},o(i){H(t),e=!1},d(i){i&&R(n),t&&t.d()}}}function Xa(f,n,e){let{event:t={}}=n,i=!1;return gt(async()=>{t.importEvent?e(1,i=await Gr("*[_id == '"+t.importedEvent+"'][0]")):e(1,i=t)}),f.$$set=s=>{"event"in s&&e(0,t=s.event)},[t,i]}class Ja extends Se{constructor(n){super(),Re(this,n,Xa,Wa,De,{event:0})}}function gr(f,n,e){const t=f.slice();return t[7]=n[e],t}function yr(f){let n,e;return{c(){n=U("div"),e=ze(f[1]),this.h()},l(t){n=V(t,"DIV",{class:!0});var i=G(n);e=We(i,f[1]),i.forEach(R),this.h()},h(){k(n,"class","viewer-count svelte-at985a")},m(t,i){j(t,n,i),Y(n,e)},p(t,i){i&2&&It(e,t[1])},d(t){t&&R(n)}}}function Ya(f){let n,e,t,i,s,c,d,p,g,I,r,a,_=f[0].events,A=[];for(let $=0;$<_.length;$+=1)A[$]=wr(gr(f,_,$));const T=$=>H(A[$],1,1,()=>{A[$]=null});return{c(){n=U("div"),e=U("div"),t=U("h1"),i=ze("Welcome to the Bulletin Board"),s=ve(),c=U("div"),d=U("div"),p=ze("Subscribe to Calendar"),g=ve(),I=U("div");for(let $=0;$<A.length;$+=1)A[$].c();this.h()},l($){n=V($,"DIV",{class:!0});var w=G(n);e=V(w,"DIV",{class:!0});var x=G(e);t=V(x,"H1",{});var O=G(t);i=We(O,"Welcome to the Bulletin Board"),O.forEach(R),s=ge(x),c=V(x,"DIV",{class:!0});var P=G(c);d=V(P,"DIV",{class:!0});var Z=G(d);p=We(Z,"Subscribe to Calendar"),Z.forEach(R),P.forEach(R),g=ge(x),I=V(x,"DIV",{class:!0});var ne=G(I);for(let de=0;de<A.length;de+=1)A[de].l(ne);ne.forEach(R),x.forEach(R),w.forEach(R),this.h()},h(){k(d,"class","action svelte-at985a"),k(c,"class","bulletin-board-actions svelte-at985a"),k(I,"class","bulletin-board-events"),k(e,"class","inner svelte-at985a"),k(n,"class","bulletin-board svelte-at985a"),Ve(n,"pushed",f[3])},m($,w){j($,n,w),Y(n,e),Y(e,t),Y(t,i),Y(e,s),Y(e,c),Y(c,d),Y(d,p),Y(e,g),Y(e,I);for(let x=0;x<A.length;x+=1)A[x].m(I,null);a=!0},p($,w){if(w&1){_=$[0].events;let x;for(x=0;x<_.length;x+=1){const O=gr($,_,x);A[x]?(A[x].p(O,w),C(A[x],1)):(A[x]=wr(O),A[x].c(),C(A[x],1),A[x].m(I,null))}for(we(),x=_.length;x<A.length;x+=1)T(x);Ae()}w&8&&Ve(n,"pushed",$[3])},i($){if(!a){for(let w=0;w<_.length;w+=1)C(A[w]);nt(()=>{r||(r=je(n,Le,{},!0)),r.run(1)}),a=!0}},o($){A=A.filter(Boolean);for(let w=0;w<A.length;w+=1)H(A[w]);r||(r=je(n,Le,{},!1)),r.run(0),a=!1},d($){$&&R(n),jr(A,$),$&&r&&r.end()}}}function Ka(f){let n,e,t,i,s=f[2]&&f[2].title&&Ar(f);return{c(){n=U("div"),e=U("div"),s&&s.c(),this.h()},l(c){n=V(c,"DIV",{class:!0});var d=G(n);e=V(d,"DIV",{class:!0});var p=G(e);s&&s.l(p),p.forEach(R),d.forEach(R),this.h()},h(){k(e,"class","inner svelte-at985a"),k(n,"class","article svelte-at985a"),Ve(n,"pushed",f[3])},m(c,d){j(c,n,d),Y(n,e),s&&s.m(e,null),i=!0},p(c,d){c[2]&&c[2].title?s?(s.p(c,d),d&4&&C(s,1)):(s=Ar(c),s.c(),C(s,1),s.m(e,null)):s&&(we(),H(s,1,1,()=>{s=null}),Ae()),d&8&&Ve(n,"pushed",c[3])},i(c){i||(C(s),nt(()=>{t||(t=je(n,Le,{},!0)),t.run(1)}),i=!0)},o(c){H(s),t||(t=je(n,Le,{},!1)),t.run(0),i=!1},d(c){c&&R(n),s&&s.d(),c&&t&&t.end()}}}function Za(f){let n=Ze(f[0],"content.content"),e,t,i=n&&$r(f);return{c(){i&&i.c(),e=le()},l(s){i&&i.l(s),e=le()},m(s,c){i&&i.m(s,c),j(s,e,c),t=!0},p(s,c){c&1&&(n=Ze(s[0],"content.content")),n?i?(i.p(s,c),c&1&&C(i,1)):(i=$r(s),i.c(),C(i,1),i.m(e.parentNode,e)):i&&(we(),H(i,1,1,()=>{i=null}),Ae())},i(s){t||(C(i),t=!0)},o(s){H(i),t=!1},d(s){i&&i.d(s),s&&R(e)}}}function Qa(f){let n,e,t,i;return e=new za({props:{streamUrl:f[0].videoUrl}}),{c(){n=U("div"),be(e.$$.fragment),this.h()},l(s){n=V(s,"DIV",{class:!0});var c=G(n);$e(e.$$.fragment,c),c.forEach(R),this.h()},h(){k(n,"class","video svelte-at985a"),Ve(n,"pushed",f[3])},m(s,c){j(s,n,c),Ie(e,n,null),i=!0},p(s,c){const d={};c&1&&(d.streamUrl=s[0].videoUrl),e.$set(d),c&8&&Ve(n,"pushed",s[3])},i(s){i||(C(e.$$.fragment,s),nt(()=>{t||(t=je(n,Le,{},!0)),t.run(1)}),i=!0)},o(s){H(e.$$.fragment,s),t||(t=je(n,Le,{},!1)),t.run(0),i=!1},d(s){s&&R(n),Te(e),s&&t&&t.end()}}}function wr(f){let n,e;return n=new Ja({props:{event:f[7]}}),{c(){be(n.$$.fragment)},l(t){$e(n.$$.fragment,t)},m(t,i){Ie(n,t,i),e=!0},p(t,i){const s={};i&1&&(s.event=t[7]),n.$set(s)},i(t){e||(C(n.$$.fragment,t),e=!0)},o(t){H(n.$$.fragment,t),e=!1},d(t){Te(n,t)}}}function Ar(f){let n=f[2].title+"",e,t,i=Ze(f[2],"content.content"),s,c,d=i&&br(f);return{c(){e=ze(n),t=ve(),d&&d.c(),s=le()},l(p){e=We(p,n),t=ge(p),d&&d.l(p),s=le()},m(p,g){j(p,e,g),j(p,t,g),d&&d.m(p,g),j(p,s,g),c=!0},p(p,g){(!c||g&4)&&n!==(n=p[2].title+"")&&It(e,n),g&4&&(i=Ze(p[2],"content.content")),i?d?(d.p(p,g),g&4&&C(d,1)):(d=br(p),d.c(),C(d,1),d.m(s.parentNode,s)):d&&(we(),H(d,1,1,()=>{d=null}),Ae())},i(p){c||(C(d),c=!0)},o(p){H(d),c=!1},d(p){p&&R(e),p&&R(t),d&&d.d(p),p&&R(s)}}}function br(f){let n,e;return n=new wn({props:{blocks:f[2].content.content,mainSite:!0}}),{c(){be(n.$$.fragment)},l(t){$e(n.$$.fragment,t)},m(t,i){Ie(n,t,i),e=!0},p(t,i){const s={};i&4&&(s.blocks=t[2].content.content),n.$set(s)},i(t){e||(C(n.$$.fragment,t),e=!0)},o(t){H(n.$$.fragment,t),e=!1},d(t){Te(n,t)}}}function $r(f){let n,e,t,i,s;return t=new wn({props:{blocks:f[0].content.content}}),{c(){n=U("div"),e=U("div"),be(t.$$.fragment),this.h()},l(c){n=V(c,"DIV",{class:!0});var d=G(n);e=V(d,"DIV",{class:!0});var p=G(e);$e(t.$$.fragment,p),p.forEach(R),d.forEach(R),this.h()},h(){k(e,"class","inner svelte-at985a"),k(n,"class","article svelte-at985a"),Ve(n,"pushed",f[3])},m(c,d){j(c,n,d),Y(n,e),Ie(t,e,null),s=!0},p(c,d){const p={};d&1&&(p.blocks=c[0].content.content),t.$set(p),d&8&&Ve(n,"pushed",c[3])},i(c){s||(C(t.$$.fragment,c),nt(()=>{i||(i=je(n,Le,{},!0)),i.run(1)}),s=!0)},o(c){H(t.$$.fragment,c),i||(i=je(n,Le,{},!1)),i.run(0),s=!1},d(c){c&&R(n),Te(t),c&&i&&i.end()}}}function Ir(f){let n,e=f[0].infoText+"",t;return{c(){n=U("div"),t=ze(e),this.h()},l(i){n=V(i,"DIV",{class:!0});var s=G(n);t=We(s,e),s.forEach(R),this.h()},h(){k(n,"class","info-text svelte-at985a")},m(i,s){j(i,n,s),Y(n,t)},p(i,s){s&1&&e!==(e=i[0].infoText+"")&&It(t,e)},d(i){i&&R(n)}}}function ef(f){let n,e,t,i,s,c,d,p,g,I,r,a=f[0].contentType==="video"&&yr(f);const _=[Qa,Za,Ka,Ya],A=[];function T(w,x){return w[0].contentType==="video"?0:w[0].contentType==="text"?1:w[0].contentType==="importedPost"?2:w[0].isBulletinBoard?3:-1}~(s=T(f))&&(c=A[s]=_[s](f));let $=f[0].infoText&&Ir(f);return{c(){a&&a.c(),n=ve(),e=U("div"),t=ze("Return"),i=ve(),c&&c.c(),d=ve(),$&&$.c(),p=le(),this.h()},l(w){a&&a.l(w),n=ge(w),e=V(w,"DIV",{class:!0});var x=G(e);t=We(x,"Return"),x.forEach(R),i=ge(w),c&&c.l(w),d=ge(w),$&&$.l(w),p=le(),this.h()},h(){k(e,"class","return-button svelte-at985a")},m(w,x){a&&a.m(w,x),j(w,n,x),j(w,e,x),Y(e,t),j(w,i,x),~s&&A[s].m(w,x),j(w,d,x),$&&$.m(w,x),j(w,p,x),g=!0,I||(r=tt(e,"click",f[6]),I=!0)},p(w,[x]){w[0].contentType==="video"?a?a.p(w,x):(a=yr(w),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null);let O=s;s=T(w),s===O?~s&&A[s].p(w,x):(c&&(we(),H(A[O],1,1,()=>{A[O]=null}),Ae()),~s?(c=A[s],c?c.p(w,x):(c=A[s]=_[s](w),c.c()),C(c,1),c.m(d.parentNode,d)):c=null),w[0].infoText?$?$.p(w,x):($=Ir(w),$.c(),$.m(p.parentNode,p)):$&&($.d(1),$=null)},i(w){g||(C(c),g=!0)},o(w){H(c),g=!1},d(w){a&&a.d(w),w&&R(n),w&&R(e),w&&R(i),~s&&A[s].d(w),w&&R(d),$&&$.d(w),w&&R(p),I=!1,r()}}}function tf(f,n,e){let t,i;Oe(f,Ee,I=>e(5,t=I)),Oe(f,zr,I=>e(3,i=I));let{article:s={}}=n,c=0,d="",p;gt(async()=>{Zr(s),s.contentType==="importedPost"&&s.importedPost&&e(2,p=await Gr("*[_id == '"+s.importedPost+"'][0]"))}),Nr(async()=>{Qr()});const g=()=>{yn.set(!1)};return f.$$set=I=>{"article"in I&&e(0,s=I.article)},f.$$.update=()=>{if(f.$$.dirty&49){e(4,c=0);for(const[I,r]of Object.entries(t))r.viewing===s._id&&e(4,c++,c)}f.$$.dirty&16&&e(1,d=c===1?"You are the only one here.":`${c} people are here.`)},[s,d,p,i,c,t,g]}class nf extends Se{constructor(n){super(),Re(this,n,tf,ef,De,{article:0})}}function rf(f){let n,e,t,i,s,c,d,p,g,I,r,a,_,A,T,$;return{c(){n=U("div"),e=U("div"),t=ze(f[0]),i=ve(),s=U("div"),c=U("div"),d=U("div"),p=ze("\u25B8"),g=ze(`
      Yes`),I=ve(),r=U("div"),a=U("div"),_=ze("\u25B8"),A=ze(`
      No`),this.h()},l(w){n=V(w,"DIV",{class:!0});var x=G(n);e=V(x,"DIV",{});var O=G(e);t=We(O,f[0]),O.forEach(R),i=ge(x),s=V(x,"DIV",{class:!0});var P=G(s);c=V(P,"DIV",{class:!0,tabindex:!0,autofocus:!0});var Z=G(c);d=V(Z,"DIV",{class:!0});var ne=G(d);p=We(ne,"\u25B8"),ne.forEach(R),g=We(Z,`
      Yes`),Z.forEach(R),I=ge(P),r=V(P,"DIV",{class:!0,tabindex:!0});var de=G(r);a=V(de,"DIV",{class:!0});var Be=G(a);_=We(Be,"\u25B8"),Be.forEach(R),A=We(de,`
      No`),de.forEach(R),P.forEach(R),x.forEach(R),this.h()},h(){k(d,"class","marker svelte-pi72xu"),k(c,"class","choice svelte-pi72xu"),k(c,"tabindex","0"),k(c,"autofocus",""),k(a,"class","marker svelte-pi72xu"),k(r,"class","choice svelte-pi72xu"),k(r,"tabindex","0"),k(s,"class","multiple-choice"),k(n,"class","room-dialog-box svelte-pi72xu")},m(w,x){j(w,n,x),Y(n,e),Y(e,t),Y(n,i),Y(n,s),Y(s,c),Y(c,d),Y(d,p),Y(c,g),Y(s,I),Y(s,r),Y(r,a),Y(a,_),Y(r,A),c.focus(),T||($=[tt(c,"click",f[3]),tt(c,"keydown",f[4]),tt(r,"click",f[5]),tt(r,"keydown",f[6])],T=!0)},p(w,[x]){x&1&&It(t,w[0])},i:Xe,o:Xe,d(w){w&&R(n),T=!1,Br($)}}}function of(f,n,e){const t=Ct();let{text:i=""}=n,{roomId:s=""}=n;const c=I=>{t("room",{roomId:s})},d=I=>{I.code==="Enter"&&t("room",{roomId:s})},p=I=>{t("room",{roomId:!1})},g=I=>{I.code==="Enter"&&t("room",{roomId:!1})};return f.$$set=I=>{"text"in I&&e(0,i=I.text),"roomId"in I&&e(1,s=I.roomId)},[i,s,t,c,d,p,g]}class sf extends Se{constructor(n){super(),Re(this,n,of,rf,De,{text:0,roomId:1})}}function af(f){let n,e,t,i;return e=new sf({props:{text:`Go to ${f[1]}?`,roomId:f[0]}}),e.$on("room",f[3]),{c(){n=U("div"),be(e.$$.fragment),this.h()},l(s){n=V(s,"DIV",{class:!0});var c=G(n);$e(e.$$.fragment,c),c.forEach(R),this.h()},h(){k(n,"class","caption-container svelte-ukizaq")},m(s,c){j(s,n,c),Ie(e,n,null),i=!0},p(s,[c]){const d={};c&2&&(d.text=`Go to ${s[1]}?`),c&1&&(d.roomId=s[0]),e.$set(d)},i(s){i||(C(e.$$.fragment,s),t||nt(()=>{t=gn(n,Le,{}),t.start()}),i=!0)},o(s){H(e.$$.fragment,s),i=!1},d(s){s&&R(n),Te(e)}}}function ff(f,n,e){const t=Ct();let{roomIntent:i=""}=n,{roomTitle:s=""}=n;const c=d=>{console.log(d),t("room",{roomId:d.detail.roomId})};return f.$$set=d=>{"roomIntent"in d&&e(0,i=d.roomIntent),"roomTitle"in d&&e(1,s=d.roomTitle)},[i,s,t,c]}class lf extends Se{constructor(n){super(),Re(this,n,ff,af,De,{roomIntent:0,roomTitle:1})}}function uf(f){let n,e;return{c(){n=Gn("svg"),e=Gn("path"),this.h()},l(t){n=zn(t,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0,class:!0});var i=G(n);e=zn(i,"path",{d:!0,class:!0}),G(e).forEach(R),i.forEach(R),this.h()},h(){k(e,"d","M4.8474 7.78418L0.703963 0.607532L8.99084 0.607531L4.8474 7.78418Z"),k(e,"class","svelte-fiesz8"),k(n,"width","9"),k(n,"height","8"),k(n,"viewBox","0 0 9 8"),k(n,"fill","none"),k(n,"xmlns","http://www.w3.org/2000/svg"),k(n,"class","svelte-fiesz8")},m(t,i){j(t,n,i),Y(n,e)},p:Xe,i:Xe,o:Xe,d(t){t&&R(n)}}}class cf extends Se{constructor(n){super(),Re(this,n,null,uf,De,{})}}function Tr(f){let n,e,t,i,s;return e=new cf({}),{c(){n=U("div"),be(e.$$.fragment),this.h()},l(c){n=V(c,"DIV",{class:!0});var d=G(n);$e(e.$$.fragment,d),d.forEach(R),this.h()},h(){k(n,"class","next-caption svelte-10yrac0")},m(c,d){j(c,n,d),Ie(e,n,null),t=!0,i||(s=tt(n,"click",f[6]),i=!0)},p:Xe,i(c){t||(C(e.$$.fragment,c),t=!0)},o(c){H(e.$$.fragment,c),t=!1},d(c){c&&R(n),Te(e),i=!1,s()}}}function df(f){let n,e,t=Kn(f[2].text.content)+"",i,s,c,d,p,g,I=f[1]<f[0].length-1&&Tr(f);return{c(){n=U("div"),e=U("div"),c=ve(),I&&I.c(),this.h()},l(r){n=V(r,"DIV",{class:!0});var a=G(n);e=V(a,"DIV",{class:!0});var _=G(e);_.forEach(R),c=ge(a),I&&I.l(a),a.forEach(R),this.h()},h(){k(e,"class","caption-box svelte-10yrac0"),k(n,"class","caption-container svelte-10yrac0")},m(r,a){j(r,n,a),Y(n,e),e.innerHTML=t,Y(n,c),I&&I.m(n,null),d=!0,p||(g=tt(e,"click",f[5]),p=!0)},p(r,[a]){f=r,(!d||a&4)&&t!==(t=Kn(f[2].text.content)+"")&&(e.innerHTML=t),f[1]<f[0].length-1?I?(I.p(f,a),a&3&&C(I,1)):(I=Tr(f),I.c(),C(I,1),I.m(n,null)):I&&(we(),H(I,1,1,()=>{I=null}),Ae())},i(r){d||(nt(()=>{s&&s.end(1),i=gn(e,Le,f[4]),i.start()}),C(I),d=!0)},o(r){i&&i.invalidate(),s=Wi(e,Le,{duration:100}),H(I),d=!1},d(r){r&&R(n),r&&s&&s.end(),I&&I.d(),p=!1,g()}}}function hf(f,n,e){const t=Ct(),i={duration:500};let{text:s=[]}=n,c=0,d=!1;s.length>0&&(d=s[c]);const p=I=>{c<s.length-1?(e(1,c++,c),e(2,d=s[c])):t("close")},g=I=>{e(1,c++,c),e(2,d=s[c])};return f.$$set=I=>{"text"in I&&e(0,s=I.text)},[s,c,d,t,i,p,g]}class _f extends Se{constructor(n){super(),Re(this,n,hf,df,De,{text:0})}}function pf(f){let n,e,t,i,s,c,d,p;return{c(){n=U("div"),e=U("div"),t=U("input"),i=ve(),s=U("button"),c=ze("Send"),this.h()},l(g){n=V(g,"DIV",{class:!0});var I=G(n);e=V(I,"DIV",{class:!0});var r=G(e);t=V(r,"INPUT",{placeholder:!0,type:!0,maxlength:!0,class:!0}),i=ge(r),s=V(r,"BUTTON",{class:!0});var a=G(s);c=We(a,"Send"),a.forEach(R),r.forEach(R),I.forEach(R),this.h()},h(){k(t,"placeholder","Write a message..."),k(t,"type","[text]"),k(t,"maxlength","600"),k(t,"class","svelte-oqrtp3"),k(s,"class","svelte-oqrtp3"),k(e,"class","chat-input svelte-oqrtp3"),k(n,"class","chat-container svelte-oqrtp3")},m(g,I){j(g,n,I),Y(n,e),Y(e,t),Wn(t,f[0]),Y(e,i),Y(e,s),Y(s,c),d||(p=[tt(t,"input",f[3]),tt(t,"keydown",f[4]),tt(s,"click",f[1])],d=!0)},p(g,[I]){I&1&&Wn(t,g[0])},i:Xe,o:Xe,d(g){g&&R(n),d=!1,Br(p)}}}function mf(f,n,e){const t=Ct();let i="";const s=()=>{t("submit",{text:i}),e(0,i="")};let{chatMessages:c=[]}=n;function d(){i=this.value,e(0,i)}const p=g=>{g.keyCode==13&&s()};return f.$$set=g=>{"chatMessages"in g&&e(2,c=g.chatMessages)},[i,s,c,d,p]}class vf extends Se{constructor(n){super(),Re(this,n,mf,pf,De,{chatMessages:2})}}var gf=Hr,yf=function(){return gf.Date.now()},wf=yf,Af=Wr,cn=wf,Er=no,bf="Expected a function",$f=Math.max,If=Math.min;function Tf(f,n,e){var t,i,s,c,d,p,g=0,I=!1,r=!1,a=!0;if(typeof f!="function")throw new TypeError(bf);n=Er(n)||0,Af(e)&&(I=!!e.leading,r="maxWait"in e,s=r?$f(Er(e.maxWait)||0,n):s,a="trailing"in e?!!e.trailing:a);function _(ne){var de=t,Be=i;return t=i=void 0,g=ne,c=f.apply(Be,de),c}function A(ne){return g=ne,d=setTimeout(w,n),I?_(ne):c}function T(ne){var de=ne-p,Be=ne-g,ue=n-de;return r?If(ue,s-Be):ue}function $(ne){var de=ne-p,Be=ne-g;return p===void 0||de>=n||de<0||r&&Be>=s}function w(){var ne=cn();if($(ne))return x(ne);d=setTimeout(w,T(ne))}function x(ne){return d=void 0,a&&t?_(ne):(t=i=void 0,c)}function O(){d!==void 0&&clearTimeout(d),g=0,t=p=i=d=void 0}function P(){return d===void 0?c:x(cn())}function Z(){var ne=cn(),de=$(ne);if(t=arguments,i=this,p=ne,de){if(d===void 0)return A(p);if(r)return clearTimeout(d),d=setTimeout(w,n),_(p)}return d===void 0&&(d=setTimeout(w,n)),c}return Z.cancel=O,Z.flush=P,Z}var Ef=Tf,xf=Ef,kf=Wr,Of="Expected a function";function Sf(f,n,e){var t=!0,i=!0;if(typeof f!="function")throw new TypeError(Of);return kf(e)&&(t="leading"in e?!!e.leading:t,i="trailing"in e?!!e.trailing:i),xf(f,n,{leading:t,maxWait:n,trailing:i})}var Rf=Sf;const Dt=ot(!0),Df=()=>new Promise((f,n)=>{document.addEventListener("keydown",Rf(e=>{e.keyCode===38&&(Dt.set(!1),he(Ee)[he(Pe).uuid].y>0&&Ee.update(t=>(t[he(Pe).uuid].y-=1,t))),e.keyCode===40&&(Dt.set(!1),he(Ee)[he(Pe).uuid].y*ye<he(Mt).dimensions.height*ye-60&&Ee.update(t=>(t[he(Pe).uuid].y+=1,t))),e.keyCode===37&&(Dt.set(!1),he(Ee)[he(Pe).uuid].x>0&&Ee.update(t=>(t[he(Pe).uuid].x-=1,t))),e.keyCode===39&&(Dt.set(!1),he(Ee)[he(Pe).uuid].x*ye<he(Mt).dimensions.width*ye-60&&Ee.update(t=>(t[he(Pe).uuid].x+=1,t))),bn(he(Ee)[he(Pe).uuid].x,he(Ee)[he(Pe).uuid].y,!0)},100)),document.addEventListener("keyup",e=>{Dt.set(!0)}),f()}),Mf=f=>new Promise((n,e)=>{let t=gsap.timeline();t.to(f,.5,{css:{opacity:0}}),t.play(),t.eventCallback("onComplete",()=>{n()})}),Pf=f=>new Promise((n,e)=>{let t=gsap.timeline();t.to(f,.5,{css:{opacity:0}}),t.to(f,.5,{css:{opacity:1}}),t.play(),t.eventCallback("onComplete",()=>{n()})}),vn=ot([]),Cf=async()=>{const f='*[_id == "streams"][0]';let n=await lt(f);vn.set(n.activeStreams),ro.listen(f).subscribe(e=>{vn.set(e.result.activeStreams)})};function xr(f,n,e){const t=f.slice();return t[28]=n[e],t}function kr(f){let n,e,t;return e=new ea({props:{room:f[7],x:Ce(f[2][f[1].uuid],"x",100),y:Ce(f[2][f[1].uuid],"y",100),$$slots:{default:[Lf]},$$scope:{ctx:f}}}),e.$on("move",f[19]),{c(){n=U("div"),be(e.$$.fragment),this.h()},l(i){n=V(i,"DIV",{class:!0});var s=G(n);$e(e.$$.fragment,s),s.forEach(R),this.h()},h(){k(n,"class","viewport"),Ve(n,"pushed",f[9])},m(i,s){j(i,n,s),Ie(e,n,null),f[20](n),t=!0},p(i,s){const c={};s[0]&128&&(c.room=i[7]),s[0]&6&&(c.x=Ce(i[2][i[1].uuid],"x",100)),s[0]&6&&(c.y=Ce(i[2][i[1].uuid],"y",100)),s[0]&7316|s[1]&1&&(c.$$scope={dirty:s,ctx:i}),e.$set(c),s[0]&512&&Ve(n,"pushed",i[9])},i(i){t||(C(e.$$.fragment,i),t=!0)},o(i){H(e.$$.fragment,i),t=!1},d(i){i&&R(n),Te(e),f[20](null)}}}function Or(f){let n,e;return n=new Pa({props:{x:f[11],y:f[12]}}),{c(){be(n.$$.fragment)},l(t){$e(n.$$.fragment,t)},m(t,i){Ie(n,t,i),e=!0},p(t,i){const s={};i[0]&2048&&(s.x=t[11]),i[0]&4096&&(s.y=t[12]),n.$set(s)},i(t){e||(C(n.$$.fragment,t),e=!0)},o(t){H(n.$$.fragment,t),e=!1},d(t){Te(n,t)}}}function Lf(f){let n,e,t,i,s,c,d,p,g,I;n=new ca({props:{players:f[2],currentRoomId:f[7]._id,avatars:f[4]}}),t=new va({props:{objects:Ce(f[7],"objects",[])}}),s=new $a({props:{zones:Ce(f[7],"zones",[])}}),d=new Ra({props:{portals:Ce(f[7],"portals",[])}});let r=f[10]&&Or(f);return{c(){be(n.$$.fragment),e=ve(),be(t.$$.fragment),i=ve(),be(s.$$.fragment),c=ve(),be(d.$$.fragment),p=ve(),r&&r.c(),g=le()},l(a){$e(n.$$.fragment,a),e=ge(a),$e(t.$$.fragment,a),i=ge(a),$e(s.$$.fragment,a),c=ge(a),$e(d.$$.fragment,a),p=ge(a),r&&r.l(a),g=le()},m(a,_){Ie(n,a,_),j(a,e,_),Ie(t,a,_),j(a,i,_),Ie(s,a,_),j(a,c,_),Ie(d,a,_),j(a,p,_),r&&r.m(a,_),j(a,g,_),I=!0},p(a,_){const A={};_[0]&4&&(A.players=a[2]),_[0]&128&&(A.currentRoomId=a[7]._id),_[0]&16&&(A.avatars=a[4]),n.$set(A);const T={};_[0]&128&&(T.objects=Ce(a[7],"objects",[])),t.$set(T);const $={};_[0]&128&&($.zones=Ce(a[7],"zones",[])),s.$set($);const w={};_[0]&128&&(w.portals=Ce(a[7],"portals",[])),d.$set(w),a[10]?r?(r.p(a,_),_[0]&1024&&C(r,1)):(r=Or(a),r.c(),C(r,1),r.m(g.parentNode,g)):r&&(we(),H(r,1,1,()=>{r=null}),Ae())},i(a){I||(C(n.$$.fragment,a),C(t.$$.fragment,a),C(s.$$.fragment,a),C(d.$$.fragment,a),C(r),I=!0)},o(a){H(n.$$.fragment,a),H(t.$$.fragment,a),H(s.$$.fragment,a),H(d.$$.fragment,a),H(r),I=!1},d(a){Te(n,a),a&&R(e),Te(t,a),a&&R(i),Te(s,a),a&&R(c),Te(d,a),a&&R(p),r&&r.d(a),a&&R(g)}}}function Sr(f){let n,e;return n=new Ta({props:{soundFile:f[7].backgroundSound}}),{c(){be(n.$$.fragment)},l(t){$e(n.$$.fragment,t)},m(t,i){Ie(n,t,i),e=!0},p(t,i){const s={};i[0]&128&&(s.soundFile=t[7].backgroundSound),n.$set(s)},i(t){e||(C(n.$$.fragment,t),e=!0)},o(t){H(n.$$.fragment,t),e=!1},d(t){Te(n,t)}}}function Rr(f){let n,e;return n=new Ba({props:{streamUrl:f[28].videoUrl}}),{c(){be(n.$$.fragment)},l(t){$e(n.$$.fragment,t)},m(t,i){Ie(n,t,i),e=!0},p(t,i){const s={};i[0]&16384&&(s.streamUrl=t[28].videoUrl),n.$set(s)},i(t){e||(C(n.$$.fragment,t),e=!0)},o(t){H(n.$$.fragment,t),e=!1},d(t){Te(n,t)}}}function Dr(f){let n,e,t=(f[7]._id==f[28].parentArea._ref||f[6]._id==f[28].parentArea._ref)&&Rr(f);return{c(){t&&t.c(),n=le()},l(i){t&&t.l(i),n=le()},m(i,s){t&&t.m(i,s),j(i,n,s),e=!0},p(i,s){i[7]._id==i[28].parentArea._ref||i[6]._id==i[28].parentArea._ref?t?(t.p(i,s),s[0]&16576&&C(t,1)):(t=Rr(i),t.c(),C(t,1),t.m(n.parentNode,n)):t&&(we(),H(t,1,1,()=>{t=null}),Ae())},i(i){e||(C(t),e=!0)},o(i){H(t),e=!1},d(i){t&&t.d(i),i&&R(n)}}}function Mr(f){let n,e;return n=new lf({props:{roomIntent:f[0],roomTitle:f[8][f[0]].title}}),n.$on("room",f[21]),{c(){be(n.$$.fragment)},l(t){$e(n.$$.fragment,t)},m(t,i){Ie(n,t,i),e=!0},p(t,i){const s={};i[0]&1&&(s.roomIntent=t[0]),i[0]&257&&(s.roomTitle=t[8][t[0]].title),n.$set(s)},i(t){e||(C(n.$$.fragment,t),e=!0)},o(t){H(n.$$.fragment,t),e=!1},d(t){Te(n,t)}}}function Pr(f){let n,e,t=f[5]&&Cr(f);return{c(){t&&t.c(),n=le()},l(i){t&&t.l(i),n=le()},m(i,s){t&&t.m(i,s),j(i,n,s),e=!0},p(i,s){i[5]?t?(t.p(i,s),s[0]&32&&C(t,1)):(t=Cr(i),t.c(),C(t,1),t.m(n.parentNode,n)):t&&(we(),H(t,1,1,()=>{t=null}),Ae())},i(i){e||(C(t),e=!0)},o(i){H(t),e=!1},d(i){t&&t.d(i),i&&R(n)}}}function Cr(f){let n,e;return n=new _f({props:{text:f[5]}}),n.$on("close",f[22]),{c(){be(n.$$.fragment)},l(t){$e(n.$$.fragment,t)},m(t,i){Ie(n,t,i),e=!0},p(t,i){const s={};i[0]&32&&(s.text=t[5]),n.$set(s)},i(t){e||(C(n.$$.fragment,t),e=!0)},o(t){H(n.$$.fragment,t),e=!1},d(t){Te(n,t)}}}function Lr(f){let n,e;return n=new nf({props:{article:f[15]}}),{c(){be(n.$$.fragment)},l(t){$e(n.$$.fragment,t)},m(t,i){Ie(n,t,i),e=!0},p(t,i){const s={};i[0]&32768&&(s.article=t[15]),n.$set(s)},i(t){e||(C(n.$$.fragment,t),e=!0)},o(t){H(n.$$.fragment,t),e=!1},d(t){Te(n,t)}}}function Fr(f){let n,e;return n=new vf({props:{chatMessages:f[16].filter(f[23])}}),n.$on("submit",f[24]),{c(){be(n.$$.fragment)},l(t){$e(n.$$.fragment,t)},m(t,i){Ie(n,t,i),e=!0},p(t,i){const s={};i[0]&65664&&(s.chatMessages=t[16].filter(t[23])),n.$set(s)},i(t){e||(C(n.$$.fragment,t),e=!0)},o(t){H(n.$$.fragment,t),e=!1},d(t){Te(n,t)}}}function Ff(f){let n,e=Ze(f[7],"backgroundSound.asset")&&f[13],t,i,s,c,d,p,g,I=f[7]&&kr(f),r=e&&Sr(f),a=f[14],_=[];for(let O=0;O<a.length;O+=1)_[O]=Dr(xr(f,a,O));const A=O=>H(_[O],1,1,()=>{_[O]=null});let T=f[0]&&Mr(f),$=!f[9]&&!f[15]&&!f[0]&&Pr(f),w=f[15]&&Lr(f),x=!f[9]&&!f[15]&&Fr(f);return{c(){I&&I.c(),n=ve(),r&&r.c(),t=ve();for(let O=0;O<_.length;O+=1)_[O].c();i=ve(),T&&T.c(),s=ve(),$&&$.c(),c=ve(),w&&w.c(),d=ve(),x&&x.c(),p=le()},l(O){I&&I.l(O),n=ge(O),r&&r.l(O),t=ge(O);for(let P=0;P<_.length;P+=1)_[P].l(O);i=ge(O),T&&T.l(O),s=ge(O),$&&$.l(O),c=ge(O),w&&w.l(O),d=ge(O),x&&x.l(O),p=le()},m(O,P){I&&I.m(O,P),j(O,n,P),r&&r.m(O,P),j(O,t,P);for(let Z=0;Z<_.length;Z+=1)_[Z].m(O,P);j(O,i,P),T&&T.m(O,P),j(O,s,P),$&&$.m(O,P),j(O,c,P),w&&w.m(O,P),j(O,d,P),x&&x.m(O,P),j(O,p,P),g=!0},p(O,P){if(O[7]?I?(I.p(O,P),P[0]&128&&C(I,1)):(I=kr(O),I.c(),C(I,1),I.m(n.parentNode,n)):I&&(we(),H(I,1,1,()=>{I=null}),Ae()),P[0]&8320&&(e=Ze(O[7],"backgroundSound.asset")&&O[13]),e?r?(r.p(O,P),P[0]&8320&&C(r,1)):(r=Sr(O),r.c(),C(r,1),r.m(t.parentNode,t)):r&&(we(),H(r,1,1,()=>{r=null}),Ae()),P[0]&16576){a=O[14];let Z;for(Z=0;Z<a.length;Z+=1){const ne=xr(O,a,Z);_[Z]?(_[Z].p(ne,P),C(_[Z],1)):(_[Z]=Dr(ne),_[Z].c(),C(_[Z],1),_[Z].m(i.parentNode,i))}for(we(),Z=a.length;Z<_.length;Z+=1)A(Z);Ae()}O[0]?T?(T.p(O,P),P[0]&1&&C(T,1)):(T=Mr(O),T.c(),C(T,1),T.m(s.parentNode,s)):T&&(we(),H(T,1,1,()=>{T=null}),Ae()),!O[9]&&!O[15]&&!O[0]?$?($.p(O,P),P[0]&33281&&C($,1)):($=Pr(O),$.c(),C($,1),$.m(c.parentNode,c)):$&&(we(),H($,1,1,()=>{$=null}),Ae()),O[15]?w?(w.p(O,P),P[0]&32768&&C(w,1)):(w=Lr(O),w.c(),C(w,1),w.m(d.parentNode,d)):w&&(we(),H(w,1,1,()=>{w=null}),Ae()),!O[9]&&!O[15]?x?(x.p(O,P),P[0]&33280&&C(x,1)):(x=Fr(O),x.c(),C(x,1),x.m(p.parentNode,p)):x&&(we(),H(x,1,1,()=>{x=null}),Ae())},i(O){if(!g){C(I),C(r);for(let P=0;P<a.length;P+=1)C(_[P]);C(T),C($),C(w),C(x),g=!0}},o(O){H(I),H(r),_=_.filter(Boolean);for(let P=0;P<_.length;P+=1)H(_[P]);H(T),H($),H(w),H(x),g=!1},d(O){I&&I.d(O),O&&R(n),r&&r.d(O),O&&R(t),jr(_,O),O&&R(i),T&&T.d(O),O&&R(s),$&&$.d(O),O&&R(c),w&&w.d(O),O&&R(d),x&&x.d(O),O&&R(p)}}}function Nf(f,n,e){let t,i,s,c,d,p,g,I,r,a,_,A,T,$;Oe(f,Qn,W=>e(18,t=W)),Oe(f,Mt,W=>e(7,i=W)),Oe(f,so,W=>e(25,s=W)),Oe(f,Pe,W=>e(1,c=W)),Oe(f,Jr,W=>e(8,d=W)),Oe(f,Ee,W=>e(2,p=W)),Oe(f,zr,W=>e(9,g=W)),Oe(f,Yr,W=>e(10,I=W)),Oe(f,ta,W=>e(11,r=W)),Oe(f,na,W=>e(12,a=W)),Oe(f,ao,W=>e(13,_=W)),Oe(f,vn,W=>e(14,A=W)),Oe(f,yn,W=>e(15,T=W)),Oe(f,An,W=>e(16,$=W));let w={},x=!1,O=[],P=!1,Z=!1;const ne=()=>{if(i.portals&&Array.isArray(i.portals)){let W=!1;i.portals.forEach(_e=>{p[c.uuid].x===_e.x&&p[c.uuid].y===_e.y&&(W=_e.targetArea._id)}),W?e(0,x=W):e(0,x=!1)}},de=()=>{let W=!1;i.zones.forEach(_e=>{er(p[c.uuid].x,_e.x,_e.x+_e.dimensions.width)&&er(p[c.uuid].y,_e.y,_e.y+_e.dimensions.height)&&(W=_e)}),W?e(6,Z=W):e(6,Z=!1)},Be=async W=>{let _e=d[W];Pt.set(!1),await Mf(w),Mt.set(_e),Kr({id:_e._id,x:qt(4,6),y:qt(4,6)}),await Pf(w),Pt.set(!0),Ze(_e,"introductionTexts")?e(5,P=_e.introductionTexts):e(5,P=!1)};gt(async()=>{ft("__ => App starting...");try{await io()}catch(_e){oo("Error in authentication:",_e)}ft("\u2713 (1) Auth client configured "),await Js(),ft("\u2713 (2) World built");for(const[_e,$n]of Object.entries(d))if(d[_e].mainArea){Mt.set(d[_e]);break}e(4,O=await Ys()),ft("\u2713 (3) Avatars loaded"),Pe.update(_e=>(_e.uuid=qr(),_e));let W={uuid:c.uuid,name:s&&s.name?s.name:"Test player",shape:Ze(s,"avatar._ref")?s.avatar._ref:pn(O)._id,onboarded:!0,room:i._id,x:qt(10,30),y:qt(5,15)};await oa(W),ft("\u2713 (4) Game server connected"),await Df(),ft("\u2713 (5) Keyboard initialized"),Cf(),ft("\u2713 (6) Stream listener initialized"),Ze(i,"introductionTexts")&&e(5,P=i.introductionTexts),ft("\u2713 (7) Show main room introduction"),ft("__ => App loaded"),console.log("STATE",Zn),console.log("$uiState",t),Qn.set(Zn.READY),console.log("$uiState",t)});const ue=W=>{bn(W.detail.x,W.detail.y,!1)};function yt(W){Tt[W?"unshift":"push"](()=>{w=W,e(3,w)})}const wt=W=>{W.detail.roomId&&Be(x),e(0,x=!1)},st=W=>{e(5,P=!1)},At=W=>W.room===i._id,rt=W=>{ei(W,i)};return f.$$.update=()=>{f.$$.dirty[0]&262144&&console.log(t),f.$$.dirty[0]&1&&x&&e(5,P=!1),f.$$.dirty[0]&6&&p[c.uuid]&&(p[c.uuid].x||p[c.uuid].x)&&(ne(),de())},[x,c,p,w,O,P,Z,i,d,g,I,r,a,_,A,T,$,Be,t,ue,yt,wt,st,At,rt]}class Uf extends Se{constructor(n){super(),Re(this,n,Nf,Ff,De,{},null,[-1,-1])}}export{Uf as default};
